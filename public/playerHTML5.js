!function(e,t){"function"==typeof define&&define.amd?define(t):e.playerHTML5=t()}(this,function(){var e,t,n;return function(r){function a(e,t){return T.call(e,t)}function i(e,t){var n,r,a,i,o,s,u,l,c,d,f=t&&t.split("/"),m=S.map,g=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(t){for(f=f.slice(0,f.length-1),e=f.concat(e.split("/")),l=0;l<e.length;l+=1)if(d=e[l],"."===d)e.splice(l,1),l-=1;else if(".."===d){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||g)&&m){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),f)for(c=f.length;c>0;c-=1)if(a=m[f.slice(0,c).join("/")],a&&(a=a[r])){i=a,o=l;break}if(i)break;!s&&g&&g[r]&&(s=g[r],u=l)}!i&&s&&(i=s,o=u),i&&(n.splice(0,o,i),e=n.join("/"))}return e}function o(e,t){return function(){return m.apply(r,v.call(arguments,0).concat([e,t]))}}function s(e){return function(t){return i(t,e)}}function u(e){return function(t){E[e]=t}}function l(e){if(a(_,e)){var t=_[e];delete _[e],h[e]=!0,f.apply(r,t)}if(!a(E,e)&&!a(h,e))throw new Error("No "+e);return E[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return S&&S.config&&S.config[e]||{}}}var f,m,g,p,E={},_={},S={},h={},T=Object.prototype.hasOwnProperty,v=[].slice;g=function(e,t){var n,r=c(e),a=r[0];return e=r[1],a&&(a=i(a,t),n=l(a)),a?e=n&&n.normalize?n.normalize(e,s(t)):i(e,t):(e=i(e,t),r=c(e),a=r[0],e=r[1],a&&(n=l(a))),{f:a?a+"!"+e:e,n:e,pr:a,p:n}},p={require:function(e){return o(e)},exports:function(e){var t=E[e];return"undefined"!=typeof t?t:E[e]={}},module:function(e){return{id:e,uri:"",exports:E[e],config:d(e)}}},f=function(e,t,n,i){var s,c,d,f,m,S,T=[];if(i=i||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,m=0;m<t.length;m+=1)if(f=g(t[m],i),c=f.f,"require"===c)T[m]=p.require(e);else if("exports"===c)T[m]=p.exports(e),S=!0;else if("module"===c)s=T[m]=p.module(e);else if(a(E,c)||a(_,c)||a(h,c))T[m]=l(c);else{if(!f.p)throw new Error(e+" missing "+c);f.p.load(f.n,o(i,!0),u(c),{}),T[m]=E[c]}d=n.apply(E[e],T),e&&(s&&s.exports!==r&&s.exports!==E[e]?E[e]=s.exports:d===r&&S||(E[e]=d))}else e&&(E[e]=n)},e=t=m=function(e,t,n,a,i){return"string"==typeof e?p[e]?p[e](t):l(g(e,t).f):(e.splice||(S=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},"function"==typeof n&&(n=a,a=i),a?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},4),m)},m.config=function(e){return S=e,S.deps&&m(S.deps,S.callback),m},n=function(e,t,n){t.splice||(n=t,t=[]),a(E,e)||a(_,e)||(_[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../lib/almond",function(){}),n("log/LogLine",[],function(){return function(e,t,n){return{category:t,enabled:n,critical:function(){e.log(e.LEVEL.CRITICAL,t,this.enabled,arguments)},error:function(){e.log(e.LEVEL.ERROR,t,this.enabled,arguments)},warn:function(){e.log(e.LEVEL.WARNING,t,this.enabled,arguments)},info:function(){e.log(e.LEVEL.INFO,t,this.enabled,arguments)},debug:function(){e.log(e.LEVEL.DEBUG,t,this.enabled,arguments)}}}}),n("util/StringUtil",[],function(){return{isEmpty:function(e){return null==e||0==e.length},isEqual:function(e,t,n){return n?e==t:e.toLowerCase()==t.toLowerCase()},hasSubStr:function(e,t,n){return n?e.indexOf(t)!=-1:e.toLowerCase().indexOf(t.toLowerCase())!=-1},hasPrefix:function(e,t,n){return this.isEqual(e.substring(0,t.length),t,n)},hasSuffix:function(e,t,n){return this.isEqual(e.substring(e.length-t.length),t,n)},isNumeric:function(e){var t=/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?$/;return t.test(e)},isMobId:function(e){var t=/^[\da-f]{26}-[\da-f]{6}-[\da-f]{16}-[\da-f]{12}-[\da-f]{4}$/;return t.test(e)},isAbsolutePath:function(e){var t=/^\/.*/;return t.test(e)},isXmlTimeline:function(e){var t=/^[\s]*<timeline>.*<\/timeline>[\s]*$/g;return t.test(e)},isPerlTimeline:function(e){var t=/^[\s]*timeline[\s]*=[\s]*\{.*\}[\s]*$/g;return t.test(e)},isJSONTimeline:function(e){var t=/^[\s]*\{[\s]*"timeline":[\s]*\{.*\}[\s]*$/g;return t.test(e)},isSMIL:function(e){var t=/^[\s]*<smil.*<\/smil>[\s]*$/g;return t.test(e)},isSMILURL:function(e){var t=/^http.*\.xml$/g;return t.test(e)},isMorpheusURL:function(e){var t=/^morpheus:\/\//g;return t.test(e)},isBoolean:function(e){if(null==e||void 0==e)return!1;switch(e.toUpperCase()){case"1":case"TRUE":case"0":case"FALSE":return!0;default:return!1}},repeat:function(e,t){for(var n="",r=0;r<t;r++)n+=e;return n},replaceApostrophe:function(e){return e.replace(RegExp(/%27/g),"'")},getParentPath:function(e){var t=e.lastIndexOf("/");if(t<0)return"";if(t!=e.length-1)return e.substr(0,t+1);if(0==t)return"";var n=e.lastIndexOf("/",t-1);return n<0?"":e.substr(0,n+1)},getPath:function(e){var t=e.lastIndexOf("/");return t<0?"":e.substr(0,t+1)},getName:function(e){var t=e.lastIndexOf("/");return t<0?e:e.substr(t+1,e.length-t-1)},getExtension:function(e){var t=e.lastIndexOf(".");if(n<0)return"";var n=e.lastIndexOf("/");return n>t?"":e.substr(t+1)},httpStr:function(e){return this.replaceApostrophe(escape(e))},indent:function(e){return repeat("\t",e)},getUuid:function(){const e=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),t=new Array;for(var n=0;n<36;n++)8==n||13==n||18==n||23==n?t.push("-"):14==n?t.push("4"):19==n?t.push(e[Math.round(4*Math.random()+8)]):t.push(e[Math.round(Math.random()*e.length-1)]);return t.join("")},parseBoolean:function(e,t){if(null==e||void 0==e)return t;if("boolean"==typeof e)return e;switch(e.toLocaleUpperCase()){case"1":case"TRUE":return!0;case"0":case"FALSE":return!1;default:return t}},parseInteger:function(e,t){if("number"==typeof e)return e;var n=parseInt(e,10);return isNaN(n)?t:n},parseNumber:function(e){return"number"==typeof e?e:parseFloat(e)},parseRational:function(e,t){if(null==e||void 0==e)return t;var n=/[:\/]/,r=e.split(n);if(2==r.length){var a=parseInt(r[1],10);if(0!=a)return parseInt(r[0],10)/a}var i=parseFloat(e);return isNaN(i)?t:i},padDigit:function(e){return(e>9?"":"0")+e},simpleKeyValueEncoding:function(e){var t="";for(var n in e)t+=n.toString()+"="+e[n].toString()+",";return t},getTimestamp:function(e){var t=e.getUTCFullYear()+"-";return t+=this.padDigit(e.getUTCMonth()+1)+"-",t+=this.padDigit(e.getUTCDate())+"_",t+=this.padDigit(e.getUTCHours())+":",t+=this.padDigit(e.getUTCMinutes())+":",t+=this.padDigit(e.getUTCSeconds())+".",t+=this.padRight(e.getUTCMilliseconds().toString(),"0",3)},getTime:function(e){var t=e.split(":"),n=0;return n+=60*parseInt(t[0])*60,n+=60*parseInt(t[1]),n+=parseFloat(t[2])},trim:function(e){return this.trimRight(this.trimLeft(e))},trimLeft:function(e){return e.replace(/^\s+/,"")},trimRight:function(e){return e.replace(/\s+$/,"")},padLeft:function(e,t,n){return e.length>=n?e:this.repeat(t,n-e.length)+e},padRight:function(e,t,n){return e.length>=n?e:e+this.repeat(t,n-e.length)},isNullString:function(e){return null==e||""==e},replaceAll:function(e,t,n){return e.replace(new RegExp(t,"g"),n)},getNumberFromSvnRevison:function(e){if(isEmpty(e))return"";var t=/\d+/g,n=e.match(t);return 0==n.length?"":n[0]}}}),n("util/XMLUtil",[],function(){function e(t){var n,r,a,i=t.attributes,o=t.childNodes,s=t.nodeType,u={},l=-1;if(1===s&&i.length){for(u[s="@attributes"]={};n=i.item(++l);)a=n.value,"true"===a?a=!0:"false"===a&&(a=!1),u[s][n.nodeName]=a;l=-1}else 3===s&&(u=t.nodeValue);for(;r=o.item(++l);)s=r.nodeName,"#text"===s?/\S/.test(r.nodeValue)&&(u=r.nodeValue):"#cdata-section"===s?u=r.data:u.hasOwnProperty(s)?("[object Array]"!==u.toString.call(u[s])&&(u[s]=[u[s]]),u[s].push(e(r))):u[s]=e(r);return u}function t(e){var t="";if("object"==typeof e)for(var n in e)t+=" "+n+'="'+e[n]+'"';return t}function n(e){var t="";for(var n in e)"@attributes"!==n&&(t+=a(n,e[n]));return t}function r(e,r){return"<"+e+t(r["@attributes"])+">"+n(r)+"</"+e+">"}function a(e,t){var n="";if(null===t)return"<"+e+"></"+e+">";switch(typeof t){case"object":if(void 0!==t[0])for(var a=0,i=t.length;a<i;a++)n+=r(e,t[a]);else n=r(e,t);break;case"function":break;default:n="<"+e+">"+t+"</"+e+">"}return n}return function(e){"use strict";var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var r=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?r.documentElement.innerHTML=e:r.body.innerHTML=e,r}return n.apply(this,arguments)}}(DOMParser),{getValueAt:function(e,t){for(var n=t.split("."),r=this.StringToXML(e),a=r.first();n.length;)a=a.children(n.shift()).first();return a.data},XMLToObject:function(t){return e(t.firstChild)},objectToXML:function(e,t){return this.StringToXML(a(e,t))},XMLToString:function(e){return(new XMLSerializer).serializeToString(e)},StringToXML:function(e){return(new DOMParser).parseFromString(e,"text/xml")}}}),n("util/JavascriptUtil",["util/XMLUtil"],function(e){return{defaultValue:function(e,t){return void 0===e?t:e},ajax:function(t){function n(){200===r.status||0===r.status&&null!=r.responseText?"xml"===t.dataType?r.responseXML?t.callback(null,r.responseXML):t.callback(null,e.StringToXML(r.responseText)):t.callback(null,r.responseText):t.callback(r.statusText,null)}var r,a={method:"GET",async:!0,url:"",dataType:"text",callback:null,postData:null,withCredentials:!1};t=this.extend(a,t),r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r.open(t.method,t.url,t.async),"GET"===t.method?r.send():(r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(this.serializeData(t.postData))),t.async?r.onreadystatechange=function(){4===r.readyState&&n()}:n()},loadScript:function(e,t){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",e),(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(n),n.readyState?n.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||t(null)}:n.onload=t},loadLink:function(e,t){function n(){for(a=0;a<document.styleSheets.length;a++)i=document.styleSheets[a].href,null!==i&&i.substr(i.length-e.length)===e&&(clearInterval(r),t(null))}var r,a,i,o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",e),(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(o),o.readyState?o.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||t(null)}:r=setInterval(n,50)},extend:function(e,t){var n;for(n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},arguments.callee(e[n],t[n])):e[n]=t[n];return e},serializeData:function(e){var t,n;if("object"==typeof e){n=[];for(t in e)n.push(t+"="+e[t]);return n.join("&")}return"string"==typeof e?e:void console.error("Can't parse data for serialization.")},without:function(e,t){var n=[];return e.forEach(function(e){e!=t&&n.push(e)}),n},deepCopy:function(e){return JSON.parse(JSON.stringify(e))},forceArray:function(e){return Array.isArray(e)?e:[e]}}}),n("log/Log",["log/LogLine","util/StringUtil","util/JavascriptUtil"],function(e,t,n){function r(e){if(e.length>1){for(var t="",n=0;n<e.length;n++)t+=e[n]+" ";return t}return e[0]}var a=!1,i={LEVEL:{CRITICAL:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4,ALL:5},logLines:{}};i.log=function(e,n,o,s){if(a&&o){var u=t.getTimestamp(new Date)+"  "+t.padRight(n," ",20)+"  "+r(s);switch(e){case i.LEVEL.CRITICAL:console.error(u);break;case i.LEVEL.ERROR:console.error(u);break;case i.LEVEL.WARNING:console.warn(u);break;case i.LEVEL.INFO:console.info(u);break;case i.LEVEL.DEBUG:console.log(u)}}},i.getLogLine=function(t,r){r=n.defaultValue(r,!0);var a=i.logLines[t];return null==a&&(a=e(i,t,r),i.logLines[t]=a),a},i.setDebug=function(e){a=e};var o=i.getLogLine("General",!0);return i.critical=o.critical,i.error=o.error,i.warn=o.warn,i.info=o.info,i.debug=o.debug,i}),n("appbase/Version",[],function(){return{MAXPLAYER_BUILD_VERSION:"%BUILD_VERSION%",MAXPLAYER_BUILD_REVISION:"%BUILD_REVISION%",getVersionString:function(){return this.MAXPLAYER_BUILD_VERSION+"."+this.MAXPLAYER_BUILD_REVISION}}}),n("net/Comm",["log/Log","util/JavascriptUtil","util/XMLUtil","util/StringUtil","appbase/Version"],function(e,t,n,r,a){return function(i){var o=e.getLogLine("Comm");return{loadUrlXml:function(e,r,a,i){o.info("Getting: "+e),t.ajax({method:a,url:e,dataType:"xml",postData:r,callback:function(e,t){if(e)return i(e);var r=n.XMLToObject(t);return r.xmd_status&&"ok"===r.xmd_status.status?i(null,r):void i(r)}})},loadUrlXmlDirect:function(e,t){return void o.error("loadUrlXmlDirect not implemented...")},loadUrl:function(e,n){o.info("Loading URL: "+e),t.ajax({method:"GET",url:e,dataType:"text",callback:n})},ping:function(e){var t=i.getUrlHost()+"_wrapper/index.php?sess="+i.userSession+"&cmd=ping&m=1&s=9876&v="+encodeURI(a.getVersionString());this.loadUrlXml(t,null,"GET",e)},openFolder:function(e,t){var n=i.getUrlHost()+"_wrapper/index.php?sess="+i.userSession+"&cmd=opendir&s="+r.httpStr(e);this.loadUrlXml(n,null,"GET",t)},getFlash:function(e){var t=i.getUrlHost()+"_wrapper/index.php?sess="+i.userSession+"&cmd=getflash";this.loadUrlXml(t,null,"GET",e)},getClipInfo:function(e,t){var n=i.getUrlHost()+"_wrapper/index.php?sess="+i.userSession+"&cmd=clipinfo&s="+r.httpStr(e);this.loadUrlXml(n,null,"GET",t)},getProxy:function(e,t,n,a,s,u,l,c,d){var f=i.getUrlHost()+"_wrapper/index.php?sess="+i.userSession+"&cmd=clipproxy&m=323&s="+r.httpStr(e)+"&w="+n+"&h="+a+"&f="+t+"&c=jpeg&q="+s;r.isEmpty(u)||(f+="&p="+r.httpStr(u));var m=new URLRequest(f),g=new URLLoader;g.dataFormat=URLLoaderDataFormat.BINARY,g.addEventListener(Event.COMPLETE,function(n){o.info("comm trace: \n\t complete: "+f);var r=new Loader;g.data.length>0?r.loadBytes(g.data):(o.info("proxy size too small: ",g.data.length),c(e,t,"NO_PROXY_DATA")),r.contentLoaderInfo.addEventListener(Event.COMPLETE,function(n){o.info("comm trace: \n\t loader: "+r,"content: "+r.content),null!=l&&l(e,t,r)})}),g.addEventListener(ProgressEvent.PROGRESS,function(n){o.info("comm trace: \n\t progress: "+n.bytesLoaded+"/"+n.bytesTotal),null!=d&&d(e,t,n.bytesLoaded,n.bytesTotal)}),g.addEventListener(SecurityErrorEvent.SECURITY_ERROR,function(n){o.info("comm trace: \n\t SECURITY_ERROR: "+f+": "+n),null!=c&&c(e,t,"SECURITY_ERROR")}),g.addEventListener(IOErrorEvent.IO_ERROR,function(n){o.info("comm trace: \n\t IO_ERROR: "+f+": "+n),null!=c&&c(e,t,"IO_ERROR")}),g.load(m)},getStreamInfoUrl:function(e){return e+"&c=1"},getStreamInfo:function(e,t){this.loadUrlXml(e,null,"POST",t)},getStreamUrl:function(e,t,n,a,o,s,u,l,c,d){return i.getUrlHost()+"_wrapper/redirect.php?sess="+i.userSession+"&cmd=render&m=323&r="+r.httpStr(e)+"&w="+t+"&h="+n+"&s="+a+"&e="+o+"&f="+u+"&q="+s+"&b="+l+"&a="+c+"&d="+d+"&t=flv"},getStreamReloadUrl:function(e,t,n){return e+"&z="+t+"&l="+n.toString()},getXmdService:function(e){var t=i.getUrlHost()+"api/xlb/nodes/less/?service=xmd";this.loadUrl(t,e)}}}}),n("event/EventStatus",["util/JavascriptUtil"],function(e){return function(t,n,r){return t=e.defaultValue(t,200),n=e.defaultValue(n,""),r=e.defaultValue(r,""),{STATUS:{OK:200,NO_CONTENT:204,BAD_REQUEST:400,LOGIN_FAILED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,VALUE_OUT_OF_RANGE:1101,ERROR_FROM_SERVER:1102,COMMUNICATION_ERROR:1103,DISCONNECTED:1104,SWITCH_TO_INVALID_PLAYBACK:1105,ABORTED_MESSAGE:1106,WARNING_FROM_SERVER:1201},code:t,message:n,details:r,isSuccessful:function(){return this.code>=200&&this.code<300},hasError:function(){return this.code>=400&&this.code<600||this.code>=1100&&this.code<1200},hasWarning:function(){return this.code>=1200&&this.code<1300}}}}),n("net/Message",["appbase/Version","event/EventStatus"],function e(t,n){function r(){return s++,s.toString()}function a(e,t){i(e,t),t.is_loop=e.isLoop,t.speed=e.speed,t.first=e.first,t.last=e.last,t.streaming=e.streamingMode,t.is_audio_compressed=e.isAudioCompressed,t.sample_rate=e.audioSampleRate,t.bit_per_sample=e.audioBitPerSample,t.audible_channels_mask=e.audibleChannelsMask}function i(e,t){t.frame=e.frame,t.width=e.width,t.height=e.height,t.raster_width=e.rasterWidth,t.raster_height=e.rasterHeight,t.raster_fps=e.rasterFps,t.is_video_compressed=e.isVideoCompressed,t.is_compressed=e.isVideoCompressed,t.compress_quality=e.compressionQuality,t.dominance=e.dominance,t.layer=e.layer,t.is_field_based_render=e.isFieldBasedRender,t.eye_selection_mask=e.eyeSelectionMask,t.audible_channels_mask=e.audibleChannelsMask,t.is_direct_io=e.directIO,t.is_use_cache=e.useCache}function e(e,t){this.message=e,this.data=t}var o={PING:"ping",LOGIN_USER:"login_user",GET_CLIP_INFO:"get_clip_info",GET_CLIP_PROXY:"get_clip_proxy",LOAD_TIMELINE_URL:"load_timeline_url",UNLOAD_TIMELINE:"unload_timeline",MODIFY_TIMELINE:"modify_timeline",PLAY_TIMELINE:"play_timeline",STOP_TIMELINE:"stop_timeline",PAUSE_TIMELINE:"pause_timeline",RESUME_TIMELINE:"resume_timeline",SET_TIMELINE_OPTION:"set_timeline_option",SET_PLAYING_OPTION:"set_playing_option",GET_PLAYING_IMAGE:"get_playing_image",GET_PLAYING_AUDIO:"get_playing_audio",ADJUST_PLAYING:"adjust_playing",GET_TIMELINE_IMAGE_AUDIO:"get_timeline_image_audio",GET_TIMELINE_IMAGE:"get_timeline_image",GET_TIMELINE_AUDIO:"get_timeline_audio",GET_TIMELINE_AUDIO_PEAKS:"get_timeline_audio_peaks",RECORD_START:"record_start",RECORD_AUDIO:"record_audio",RECORD_STOP:"record_stop",RECORD_CONFIRM:"record_confirm",RSS_SUBSCRIBE:"rss_subscribe",RSS_UNSUBSCRIBE:"rss_unsubscribe",RSS_NOTIFY:"rss_notify",START_RENDER_TO_CACHE_TASK:"start_render_to_cache_task",SET_USER_OPTION:"set_user_option",EXEC_XCORE_COMMAND:"exec_xcore_command"},s=0;return e.prototype={message:null,data:null,isError:function(){return"error"===this.message.xmd_status.status},isWarning:function(){return"warning"===this.message.xmd_status.status},isOK:function(){return"ok"===this.message.xmd_status.status},getStatusMessageDetails:function(){return this.message.xmd_status.message},getStatusErrorString:function(){return this.message.xmd_status.error_string},getStatusErrorConstant:function(){return this.message.xmd_status.error_constant},getStatusEvent:function(){return this.isError()?n(n().STATUS.ERROR_FROM_SERVER,this.getStatusErrorString(),this.getStatusMessageDetails()):this.isWarning()?n(n().STATUS.WARNING_FROM_SERVER,this.getStatusErrorString(),this.getStatusMessageDetails()):null},hasData:function(){return null!==this.data},getCommand:function(){return this.message.xmd_message},getId:function(){return this.message.xmd_message_id},transitTime:function(){return this.receiveTime-this.sendTime}},{MESSAGES:o,createMessage:function(t,n){return new e(t,n)},createBaseMessage:function(e){var t={xmd_message:e,xmd_message_id:r()};return t[e]={},t},createPingMsg:function(n){var r=this.createBaseMessage(o.PING);return r.ping={serial_string:"9876",version_string:t.getVersionString(),flash_xml_socket:!1,lang:n},new e(r,null)},createLoginMsg:function(t,n,r,a){var i=this.createBaseMessage(o.LOGIN_USER);return i.login_user.scheme=t,i.login_user.login_id=n,i.login_user.session_id=a,i.login_user.password=r,new e(i,null)},createGetClipProxyMsg:function(t,n,r,a,i,s){var u=this.createBaseMessage(o.GET_CLIP_PROXY);return u.get_clip_proxy.key=t,u.get_clip_proxy.type=n,u.get_clip_proxy.frame=r,u.get_clip_proxy.width=a,u.get_clip_proxy.height=i,u.get_clip_proxy.is_compressed=!0,u.get_clip_proxy.quality=s,new e(u,null)},createPlayTimelineMessage:function(t,n,r){var i=this.createBaseMessage(o.PLAY_TIMELINE);return i.play_timeline.name=n,i.play_timeline.session_id=t,a(r,i.play_timeline),new e(i,null)},createStopTimelineMessage:function(t){var n=this.createBaseMessage(o.STOP_TIMELINE);return n.stop_timeline.name=t,new e(n,null)},createPauseTimelineMessage:function(t){var n=this.createBaseMessage(o.PAUSE_TIMELINE);return n.pause_timeline.name=t,new e(n,null)},createResumeTimelineMessage:function(t){var n=this.createBaseMessage(o.RESUME_TIMELINE);return n.resume_timeline.name=t,new e(n,null)},createSetTimelineOptionMessage:function(t,n,r,a,i,s,u,l,c,d,f,m,g,p,E,_,S,h,T){var v=this.createBaseMessage(o.SET_TIMELINE_OPTION);return v.set_timeline_option.name=t,v.set_timeline_option.is_burn_general=n,v.set_timeline_option.message=r,v.set_timeline_option.poxistion_x=a,v.set_timeline_option.poxistion_y=i,v.set_timeline_option.text_size=s,v.set_timeline_option.area_size=u,v.set_timeline_option.background_color=l,v.set_timeline_option.title_color=c,v.set_timeline_option.text_color=d,v.set_timeline_option.other_color=f,v.set_timeline_option.font=m,v.set_timeline_option.is_feature_timeline_info=g,v.set_timeline_option.is_feature_bar=p,v.set_timeline_option.is_feature_segment_info=E,v.set_timeline_option.is_feature_frame_info=_,v.set_timeline_option.is_feature_monitors=S,v.set_timeline_option.is_feature_keycode=h,v.set_timeline_option.is_feature_message=T,new e(v,null)},createGetPlayingImageMessage:function(t){var n=this.createBaseMessage(o.GET_PLAYING_IMAGE);return n.get_playing_image.name=t,new e(n,null)},createSetPlayingOptionMessage:function(t,n){var r=this.createBaseMessage(o.SET_PLAYING_OPTION);return r.set_playing_option.name=t,a(n,r.set_playing_option),new e(r,null)},createTimelineImageAudioSampleMessage:function(t,n,r,i,s){var u=this.createBaseMessage(o.GET_TIMELINE_IMAGE_AUDIO);return u.get_timeline_image_audio.name=t,a(n,u.get_timeline_image_audio),u.get_timeline_image_audio.track_mask=n.audibleChannelsMask,u.get_timeline_image_audio.in_frame=r,u.get_timeline_image_audio.length=i,u.get_timeline_image_audio.bit_per_sample=n.audioBitPerSample,u.get_timeline_image_audio.frame_per_second=n.audioSampleRate,u.get_timeline_image_audio.premix=!1,u.get_timeline_image_audio.channel_count=2,u.get_timeline_image_audio.move_playback_position=s,new e(u,null)},createTimelineImageMessage:function(t,n,r){var a=this.createBaseMessage(o.GET_TIMELINE_IMAGE);return a.get_timeline_image.name=t,a.get_timeline_image.move_playback_position=r,i(n,a.get_timeline_image),new e(a,null)},createTimelineAudioMessage:function(t,n,r,a,i,s,u,l){var c=this.createBaseMessage(o.GET_TIMELINE_AUDIO);return c.get_timeline_audio.name=t,c.get_timeline_audio.track_mask=n,c.get_timeline_audio.in_frame=r,c.get_timeline_audio.length=a,c.get_timeline_audio.bit_per_sample=i,c.get_timeline_audio.frame_per_second=s,c.get_timeline_audio.premix=u,c.get_timeline_audio.move_playback_position=l,new e(c,null)},createAdjustPlayingMessage:function(t,n){var r=this.createBaseMessage(o.ADJUST_PLAYING);return r.adjust_playing.name=t,r.adjust_playing.frame=n,new e(r,null)},createRecordAudioMessage:function(t,n,r,a,i,s,u,l,c){var d=this.createBaseMessage(o.RECORD_AUDIO);return d.record_audio.file_path=t,d.record_audio.format=n,d.record_audio.channel_count=r,d.record_audio.sample_rate=a,d.record_audio.bit_per_sample=i,d.record_audio.codec=s,d.record_audio.start_frame=u,d.record_audio.frame_count=l,new e(d,c)},createGetClipInfoMessage:function(t,n){var r=this.createBaseMessage(o.GET_CLIP_INFO);return r.get_clip_info.key=t,r.get_clip_info.type=n,new e(r,null)},createLoadTimelineUrlMessage:function(t,n,r,a,i){var s=this.createBaseMessage(o.LOAD_TIMELINE_URL);return s.load_timeline_url.name=t,s.load_timeline_url.url=n,s.load_timeline_url.type=r,s.load_timeline_url.relink_policy=a,s.load_timeline_url.force_relink=i,s.load_timeline_url.output_format="json",new e(s,null)},createUnloadTimelineMessage:function(t){var n=this.createBaseMessage(o.UNLOAD_TIMELINE);return n.unload_timeline.name=t,new e(n,null)},createMultipleModifyTimelineMessage:function(t,n){var r=this.createBaseMessage(o.MODIFY_TIMELINE);return r.modify_timeline.name=t,r.modify_timeline.change=[],n.forEach(function(e){r.modify_timeline.change.push(e.data)}),new e(r,null)},createRssSubscribeMessage:function(t,n,r){var a=this.createBaseMessage(o.RSS_SUBSCRIBE);return a.rss_subscribe.name=t,a.rss_subscribe.rss_type=n,"RSS_ASSET_UPDATED"===n&&(a.rss_subscribe.rss_params.url=r.url,a.rss_subscribe.rss_params.url_type=r.url_type),new e(a,null)},createRssUnsubscribeMessage:function(t){var n=this.createBaseMessage(o.RSS_UNSUBSCRIBE);return n.rss_unsubscribe.name=t,new e(n,null)},createRecordStartMessage:function(t,n,r,a,i,s){var u=this.createBaseMessage(o.RECORD_START);return u.record_start.workspace=t,u.record_start.user_name=n,u.record_start.sequence_name=r,u.record_start.interplay_server=a,u.record_start.fps=i,u.record_start.drop_timecode=s,u.record_start.extension="mxf",new e(u,null)},createRecordStopMessage:function(t,n,r,a){var i=this.createBaseMessage(o.RECORD_STOP);return i.record_stop.path=t,i.record_stop.is_cancel=n,i.record_stop.is_confirm=r,i.record_stop.interplay_server=a,new e(i,null)},createRecordConfimMessage:function(t,n,r){var a=this.createBaseMessage(o.RECORD_CONFIRM);return a.record_confirm.path=t,a.record_confirm.is_cancel=n,a.record_confirm.interplay_server=r,new e(a,null)},createRenderToCacheMessage:function(t,n,r,a,s){var u=this.createBaseMessage(o.START_RENDER_TO_CACHE_TASK);return u.start_render_to_cache_task.name=t,u.start_render_to_cache_task.in=n,u.start_render_to_cache_task.out=r,u.start_render_to_cache_task.threshold=a,i(s,u.start_render_to_cache_task),new e(u,null)},createSetUserOptionMessage:function(t){var n=this.createBaseMessage(o.SET_USER_OPTION);return n.set_user_option.default_group_clip_layout=t,new e(n,null)},createGetTimelineAudioPeaksMasterMessage:function(t,n,r,a,i){var s=this.createBaseMessage(o.GET_TIMELINE_AUDIO_PEAKS);return s.get_timeline_audio_peaks.name=t,s.get_timeline_audio_peaks.track_mask=255,s.get_timeline_audio_peaks.channel_count=2,s.get_timeline_audio_peaks.start_time=n,s.get_timeline_audio_peaks.end_time=r,s.get_timeline_audio_peaks.peak_count=a,s.get_timeline_audio_peaks.frame_per_second=i,new e(s,null)},createExecXcoreCommandMessage:function(t){var n=this.createBaseMessage(o.EXEC_XCORE_COMMAND);return n.exec_xcore_command.command=t,new e(n,null)},createAbortedMessage:function(t,n){var r=t+"_re",a={xmd_message:r,xmd_message_id:n,xmd_status:{status:"warning",error_string:"Message aborted in transit: "+t}};return a[r]={},new e(a,null)}}}),n("event/Event",["event/EventStatus","util/JavascriptUtil"],function(e,t){return function(n,r,a){return a=t.defaultValue(a,e()),{type:n,params:r,status:a}}}),n("event/Dispatcher",["log/Log"],function(e){return function(){var t=e.getLogLine("Dispatcher"),n={};return{addListener:function(e,r){void 0===e&&t.error("Trying to add an undefined event.");var a=n,i=a[e]=a[e]||[];i.push(r)},raiseEvent:function(e){void 0===e.type&&t.error("Trying to raise an undefined event.");var r=n[e.type];if(r){r=r.slice();for(var a=0,i=r.length;a<i;a++)void 0===r[a]&&t.error("Undefined callback: "+e.type),r[a].apply(null,[e])}},removeListener:function(e,r){void 0===e&&t.error("Trying to remove an undefined event.");var a=n[e];if(a)for(var i=0;i<a.length;)if(a[i]===r){if(a.splice(i,1),0===a.length)return void delete n[e]}else i++},hasListener:function(e,t){var r=n[e];if(void 0===r)return!1;for(var a=0,i=r.length;a<i;a++)if(r[a]===t)return!0;return!1},addListeners:function(e,t){for(var n=0,r=e.length;n<r;n++)this.addListener(e[n],t)},removeListeners:function(e,t){for(var n=0,r=e.length;n<r;n++)this.removeListener(e[n],t)},redispatch:function(e,t){e.addListener(t,this.raiseEvent)},unredispatch:function(e,t){e.removeListener(t,this.raiseEvent)},redispatchEvents:function(e,t){e.addListeners(t,this.raiseEvent)},unredispatchEvents:function(e,t){e.removeListeners(t,this.raiseEvent)},forwardEvent:function(e){this.raiseEvent(e)}}}}),n("net/SOCKET_EVENTS",{CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED",LOGIN:"LOGIN",SEND_MESSAGE:"SEND_MESSAGE",RECEIVED_MESSAGE:"RECEIVED_MESSAGE"}),n("play/EPlayback",[],function(){var e={OPEN_ASSET:"OPEN_ASSET",DOWNLOAD_START:"DOWNLOAD_START",DOWNLOAD_PROGRESS:"DOWNLOAD_PROGRESS",DOWNLOAD_FINISHED:"DOWNLOAD_FINISHED",DOWNLOAD_FAILED:"DOWNLOAD_FAILED",DOWNLOAD_REBUFFERING_START:"DOWNLOAD_REBUFFERING_START",DOWNLOAD_REBUFFERING_FINISHED:"DOWNLOAD_REBUFFERING_FINISHED",PLAY_INITIATED:"PLAY_INITIATED",PLAY_BUFFERING:"PLAY_BUFFERING",PLAY_START:"PLAY_START",PLAY_PAUSE:"PLAY_PAUSE",PLAY_FAILED:"PLAY_FAILED",PREBUFFERING_PROGRESS:"PREBUFFERING_PROGRESS",PREBUFFERING_READY:"PREBUFFERING_READY",SEEK_START:"SEEK_START",SEEK_FINISHED:"SEEK_FINISHED",SEEK_FAILED:"SEEK_FAILED",AUDIO_SOLO_CHANGE:"AUDIO_SOLO_CHANGE",AUDIO_MUTE_CHANGE:"AUDIO_MUTE_CHANGE",AUDIO_PAN_CHANGE:"AUDIO_PAN_CHANGE",AUDIO_VOLUME_CHANGE:"AUDIO_VOLUME_CHANGE",AUDIO_MIXER_LEVEL:"AUDIO_MIXER_LEVEL",PLAY_SPEED_CHANGE:"PLAY_SPEED_CHANGE",MESSAGE_PROGRESS:"MESSAGE_PROGRESS",SEGMENT_CHANGE:"SEGMENT_CHANGE",EWC_UPDATE_TIMELINE_LENGTH:"EWC_UPDATE_TIMELINE_LENGTH",MULTICAM_SELECT:"MULTICAM_SELECT",MULTICAM_ZOOM_IN:"MULTICAM_ZOOM_IN",MULTICAM_ZOOM_OUT:"MULTICAM_ZOOM_OUT"},t={FILE:"FILE",FRAME:"FRAME",DEFAULT:"DEFAULT"};return{EVENTS:e,MODES:t,getDownloadEvents:function(){return[e.DOWNLOAD_START,e.DOWNLOAD_PROGRESS,e.DOWNLOAD_FINISHED,e.DOWNLOAD_FAILED,e.DOWNLOAD_REBUFFERING_START,e.DOWNLOAD_REBUFFERING_FINISHED]},getPlayEvents:function(){return[e.PLAY_INITIATED,e.PLAY_BUFFERING,e.PLAY_START,e.PLAY_PAUSE,e.PLAY_FAILED]},getSeekEvents:function(){return[e.SEEK_START,e.SEEK_FINISHED,e.SEEK_FAILED]},getAudioEvents:function(){return[e.AUDIO_SOLO_CHANGE,e.AUDIO_MUTE_CHANGE,e.AUDIO_VOLUME_CHANGE]}}}),n("text",["module"],function(e){"use strict";var n,r,a,i,o,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),f=c&&location.hostname,m=c&&(location.port||void 0),g={},p=e.config&&e.config()||{};return n={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(e){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,a=!1,i=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return i!==-1&&(!o||i>1)?(t=e.substring(0,i),n=e.substring(i+1,e.length)):t=e,r=n||t,i=r.indexOf("!"),i!==-1&&(a="strip"===r.substring(i+1),r=r.substring(0,i),n?n=r:t=r),{moduleName:t,ext:n,strip:a}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,r,a){var i,o,s,u=n.xdRegExp.exec(e);return!u||(i=u[2],o=u[3],o=o.split(":"),s=o[1],o=o[0],!(i&&i!==t||o&&o.toLowerCase()!==r.toLowerCase()||(s||o)&&s!==a))},finishLoad:function(e,t,r,a){r=t?n.strip(r):r,p.isBuild&&(g[e]=r),a(r)},load:function(e,t,r,a){if(a&&a.isBuild&&!a.inlineText)return void r();p.isBuild=a&&a.isBuild;var i=n.parseName(e),o=i.moduleName+(i.ext?"."+i.ext:""),s=t.toUrl(o),u=p.useXhr||n.useXhr;return 0===s.indexOf("empty:")?void r():void(!c||u(s,d,f,m)?n.get(s,function(t){n.finishLoad(e,i.strip,t,r)},function(e){r.error&&r.error(e)}):t([o],function(e){n.finishLoad(i.moduleName+"."+i.ext,i.strip,e,r)}))},write:function(e,t,r,a){if(g.hasOwnProperty(t)){var i=n.jsEscape(g[t]);r.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,r,a,i){var o=n.parseName(t),s=o.ext?"."+o.ext:"",u=o.moduleName+s,l=r.toUrl(o.moduleName+s)+".js";n.load(u,r,function(t){var r=function(e){return a(l,e)};r.asModule=function(e,t){return a.asModule(e,l,t)},n.write(e,u,r,i)},i)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(r=t.nodeRequire("fs"),n.get=function(e,t,n){try{var a=r.readFileSync(e,"utf8");0===a.indexOf("\ufeff")&&(a=a.substring(1)),t(a)}catch(e){n&&n(e)}}):"xhr"===p.env||!p.env&&n.createXhr()?n.get=function(e,t,r,a){var i,o=n.createXhr();if(o.open("GET",e,!0),a)for(i in a)a.hasOwnProperty(i)&&o.setRequestHeader(i.toLowerCase(),a[i]);
p.onXhr&&p.onXhr(o,e),o.onreadystatechange=function(n){var a,i;4===o.readyState&&(a=o.status||0,a>399&&a<600?(i=new Error(e+" HTTP status: "+a),i.xhr=o,r&&r(i)):t(o.responseText),p.onXhrComplete&&p.onXhrComplete(o,e))},o.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?n.get=function(e,t){var n,r,a="utf-8",i=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),a)),u="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),null!==r&&n.append(r);null!==(r=s.readLine());)n.append(o),n.append(r);u=String(n.toString())}finally{s.close()}t(u)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(a=Components.classes,i=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in a,n.get=function(e,t){var n,r,s,u={};o&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{n=a["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(s,1,0,!1),r=a["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),r.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(n.available(),u),r.close(),n.close(),t(u.value)}catch(e){throw new Error((s&&s.path||"")+": "+e)}}),n}),n("text!common/default.conf",[],function(){return'<config version="$Revision: 23032 $">\r\n\r\n\t<app>\r\n\t\t<cache_limit memory_mega="500" />\r\n\t\t<xmd port="5000" auto_reconnection="true" cluster="true" secure="false" trust_certificate="true" format="json" keep_alive="false" />\r\n\t\t<manager secure="false" port="80" proxy_route="" />\r\n\t\t<keyboard enabled="true" />\r\n\t\t<debug enabled="false" full_format_log="false" log_lines="500" max_log_line_characters="1024" />\r\n\t</app>\r\n\r\n\t<deck>\r\n\t\t<ui>\r\n\t\t\t<style type="CHROMELESS" background_color="7C7C7C" />\r\n\t\t\t<control_panel chrome_color="default">\r\n\t\t\t\t<audio_controls visible="true" enabled="true" />\r\n\t\t\t\t<options visible="true" enabled="true" />\r\n\t\t\t\t<to_begin visible="true" enabled="true" />\r\n\t\t\t\t<to_mark_in visible="true" enabled="true" />\r\n\t\t\t\t<mark_in visible="true" enabled="true" />\r\n\t\t\t\t<back_one visible="true" enabled="true" />\r\n\t\t\t\t<play_pause visible="true" enabled="true" />\r\n\t\t\t\t<forward_one visible="true" enabled="true" />\r\n\t\t\t\t<mark_out visible="true" enabled="true" />\r\n\t\t\t\t<to_mark_out visible="true" enabled="true" />\r\n\t\t\t\t<to_end visible="true" enabled="true" />\r\n\t\t\t\t<one_to_one visible="true" enabled="true" />\r\n\t\t\t\t<fullscreen_toggle visible="true" enabled="true" />\r\n\t\t\t\t<to_prev_cut visible="true" enabled="true" />\r\n\t\t\t\t<to_next_cut visible="true" enabled="true" />\r\n\t\t\t</control_panel>\r\n\t\t\t<segment_colors>\r\n\t\t\t\t<view first="FF000033" second="0000FF33" />\r\n\t\t\t\t<loading first="FF000066" second="0000FF66" />\r\n\t\t\t</segment_colors>\r\n\t\t\t<quality_list>\r\n\t\t\t\t<quality key="playback.quality.low" value="30"/>\r\n\t\t\t\t<quality key="playback.quality.medium" value="50"/>\r\n\t\t\t\t<quality key="playback.quality.high" value="80"/>\r\n\t\t\t</quality_list>\r\n\t\t\t<aspect_ratio always_fill="false"/>\r\n\t\t\t<context_menu show_statistics="false" />\r\n\t\t\t<varispeed enabled="true" autostart="true" speed_reset="false" />\r\n\t\t\t<errors visible="false" />\r\n\t\t\t<audio show_slide="false" />\r\n\t\t\t<safe_area action="false" title="false" color="FFFFFF" />\r\n\t\t\t<timecode show_in_out="false" />\r\n\t\t</ui>\r\n\r\n\t\t<loop_playback enabled="true" auto="false" />\r\n\t\t<scrub mode="file" allow_frame="true" audio="true" quality_low="50" quality_high="90" />\r\n\t\t<default_volume value="70" fade_in="0" />\r\n\t\t<recorder add_track="false"/>\r\n\t\t<editing inclusive="false" tail_frame="false" />\r\n\t\t<mouse scroll_enabled="false" />\r\n\t\t<audio mute_extra_tracks_on_load="true" />\r\n\t\t<playback mode="FRAME" maximum_play_objects="3" one_to_one="true" disable_file_mode_for_remote="true" />\r\n\t\t<playback_files preroll="false" max_downloads="20" peaks_per_second="24" samples_per_peak="10" video_bitrate="5000" audio_bitrate="128" seek_delay="80" gop_length="5" gop_offset="25" partial_threshold="5">\r\n\t\t\t<proxy quality="80" maximum_width_low="480" maximum_width_high="2048" />\r\n\t\t</playback_files>\r\n\t\t<edl audio_multichannel_mapping="true" audio_frame_rate="100" />\r\n\t\t<playback_frames level_low=".14" level_target=".2" dynamic_buffer="true" maximum_buffer="2" dynamic_buffer_deltas_length="60" stop_on_context="true">\r\n\t\t\t<video quality="80" proxy_width="320" domain="FRAME" layer="FRONT"\r\n\t\t\t\tfield_based_render="false" use_cache="true" dynamic_proxy_width="true"\r\n\t\t\t\tmaximum_width="480" smooth_scaling="true" />\r\n\t\t\t<audio rate="44100" bits="16" format="pcm" audibleChannelsMask="-1" sample_data_size="2048" />\r\n\t\t</playback_frames>\r\n\t\t<multicam select_color="F1B000" select_style="box" select_line_width="3" />\r\n\t</deck>\r\n\r\n</config>\r\n'}),n("view/STYLES",{CHROMELESS:"chromeless",PLAYBACK:"playback_clip",EDIT:"mark_clip",EDL:"playback_edl",NO_TIMECODE:"no_timecode"}),n("appbase/ConfigManager",["log/Log","event/Dispatcher","util/JavascriptUtil","util/XMLUtil","util/StringUtil","event/Event","play/EPlayback","text!common/default.conf","view/STYLES"],function(e,t,n,r,a,i,o,s,u){function l(t){m=n.extend(m,t),d.playbackMode=m.deck.playback["@attributes"].mode.toUpperCase(),d.playbackMode!==o.MODES.FILE&&d.playbackMode!==o.MODES.FRAME&&(c.critical("Configuration error: Unknown playback mode '"+playbackMode+"'.  Defaulting to FRAME"),d.playbackMode=o.MODES.FRAME),d.playbackLatencyLow=parseFloat(m.deck.playback_frames["@attributes"].level_low),d.playbackLatencyTarget=parseFloat(m.deck.playback_frames["@attributes"].level_target),d.maximumBuffer=parseFloat(m.deck.playback_frames["@attributes"].maximum_buffer),d.dynamicBuffer=parseFloat(m.deck.playback_frames["@attributes"].dynamic_buffer),d.dynamicBufferDeltasLength=parseFloat(m.deck.playback_frames["@attributes"].dynamic_buffer_deltas_length),d.alwaysFill=m.deck.ui.aspect_ratio["@attributes"].always_fill,d.maximumPlaybackObjects=parseInt(m.deck.playback["@attributes"].maximum_play_objects,10),d.loopPlayback=m.deck.loop_playback["@attributes"].enabled,d.selectColor="#"+m.deck.multicam["@attributes"].select_color,d.selectStyle=m.deck.multicam["@attributes"].select_style,d.selectLineWidth=parseInt(m.deck.multicam["@attributes"].select_line_width,10),d.xmdPort=parseInt(m.app.xmd["@attributes"].port,10),d.xmdAutoReconnection=m.app.xmd["@attributes"].auto_reconnection,d.xmdUseCluster=m.app.xmd["@attributes"].cluster,d.socketKeepAlive=m.app.xmd["@attributes"].keep_alive,d.secureSocket=m.app.xmd["@attributes"].secure,d.managerSecure=m.app.manager["@attributes"].secure,d.managerPort=m.app.manager["@attributes"].port,d.managerRoute=m.app.manager["@attributes"].proxy_route,d.addRecordVoiceTrack=m.deck.recorder["@attributes"].add_track,d.debugEnabled=m.app.debug["@attributes"].enabled,e.setDebug(d.debugEnabled),d.edlMultiChannelMapping=m.deck.edl["@attributes"].audio_multichannel_mapping,d.muteExtraAudioTracksOnLoad=m.deck.audio["@attributes"].mute_extra_tracks_on_load,d.speedReset=m.deck.ui.varispeed["@attributes"].speed_reset,d.audioFrameRate=parseInt(m.deck.edl["@attributes"].audio_frame_rate,10)}var c=e.getLogLine("Config"),d={dispatcher:t(),EVENTS:{LOADED:"loaded",CHANGED:"changed"},loaded:function(){return f},load:function(e,t){n.ajax({url:e,async:!0,dataType:"xml",callback:function(e,n){return e?(c.error("Error loading config file."),void d.dispatcher.raiseEvent(i(d.EVENTS.LOADED,null))):(l(r.XMLToObject(n)),t&&t(),void d.dispatcher.raiseEvent(i(d.EVENTS.LOADED,null)))}})},getConfig:function(e){for(var t=e.split("."),n=m;t.length>1;)n=n[t.shift()];return n=n["@attributes"][t[0]],n.toString()},setConfig:function(e,t){if(null===t)return c.info("No value set for "+e),!1;if("deck.scrub.mode"===e&&!d.allowFrameScrubbing&&!d.scrubServer)return c.info("Frame scrubbing disabled in configuration."),!1;for(var n=e.split("."),r=m;n.length>1;){if(r=r[n[0]],void 0===r)return c.error("Unknown config key:"+e),!1;n.splice(0,1)}return r["@attributes"][n[0]]=t,l(m),d.dispatcher.raiseEvent(i(d.EVENTS.CHANGED,{key:e,value:this.getConfig(e)})),!0},playbackMode:null,playbackLatencyLow:0,playbackLatencyTarget:0,maximumBuffer:2,dynamicBuffer:!1,dynamicBufferDeltasLength:60,alwaysFill:!1,maximumPlaybackObjects:2,loopPlayback:!1,selectColor:"F1B000",selectStyle:"box",selectLineWidth:3,xmdPort:5e3,xmdAutoReconnection:!0,xmdUseCluster:!1,socketKeepAlive:!0,secureSocket:!1,managerSecure:!1,managerPort:80,managerRoute:"",allowFrameScrubbing:!0,scrubServer:!0,addRecordVoiceTrack:!1,debugEnabled:!1,edlMultiChannelMapping:!1,muteExtraAudioTracksOnLoad:!1,speedReset:!1,audioFrameRate:29.97},f=!1,m={};return l(r.XMLToObject(r.StringToXML(s))),d}),n("text!common/locales/en.xml",[],function(){return'<locale>\r\n\t<!-- file version compatibility -->\r\n\t<version locale_revision="$Revision: 22992 $" />\r\n\t\r\n\t<!-- context menu items -->\r\n\t<element key="contextmenu.showhide.statistics" value="Show/hide player statistics" />\r\n\t<element key="contextmenu.showhide.debug" value="Show/hide debug panel" />\r\n\t\r\n\t<!-- MaxPlayerCode -->\r\n\t<element key="maxplayercode.networkFailed" value="Cannot connect to server." />\r\n\t<element key="maxplayercode.loginFailed" value="Login failed." />\r\n\t<element key="maxplayercode.loggingIn" value="Logging in..." />\r\n\t\r\n\t<!-- Deck -->\r\n\t<element key="deck.ms" value="ms" />\r\n\t<element key="deck.fps" value="fps" />\r\n\t<element key="deck.ps" value="ps" />\r\n\t<element key="deck.rulerarea.tooltip" value="Scrub Bar" />\r\n\t<element key="deck.zoomControlArea.tooltip" value="Timeline Zooming Bar" />\r\n\t<element key="deck.ruler.markin.tooltip" value="Mark In" />\r\n\t<element key="deck.ruler.markout.tooltip" value="Mark Out" />\r\n\t<element key="errorWindow.ok.button.label" value="OK" />\r\n\t\r\n\t<!-- StatsPanel -->\r\n\t<element key="statspanel.title" value="Playback Statistics:" />\r\n\t<element key="statspanel.raster" value="Video Source:" />\r\n\t<element key="statspanel.proxyspec" value="Proxy Quality:" />\r\n\t<element key="statspanel.frameratestats" value="Frame Rate Cur/Avg:" />\r\n\t<element key="statspanel.framestats" value="Frames Adjusted/Dropped:" />\r\n\t<element key="statspanel.seektime" value="Seek Time:" />\r\n\t<element key="statspanel.ratestat" value="Data Rate Video/Audio:" />\r\n\t<element key="statspanel.buffer" value="Buffer Video/Audio:" />\r\n\t<element key="statspanel.bufferTime" value="Buffer size:" />\r\n\t\r\n\t<!-- DebugPanel -->\r\n\t<element key="debugpanel.title" value="Debug:" />\r\n\t<element key="debugpanel.categoryList.ALL" value="ALL" />\r\n\t<element key="debugpanel.stageFPS" value="Stage Frame Rate:" />\r\n\t<element key="debugpanel.memory" value="Memory Usage:" />\r\n\t<element key="debugpanel.bytesTotal" value="Bytes Received:" />\r\n\t<element key="debugpanel.rateCurrent" value="Bytes Rate:" />\r\n\t<element key="debugpanel.traceTitle" value="Trace:" />\r\n\t<element key="debugpanel.copy" value="Copy" />\r\n\t<element key="debugpanel.clear" value="Clear" />\r\n\t<element key="debugpanel.logLevel.prompt" value="Log Level" />\r\n\t<element key="debugpanel.disable" value="Disable" />\r\n\t<element key="debugpanel.fullformat" value="Full Format" />\r\n\t<element key="debugpanel.fetchingLog" value="Fetching Log..." />\r\n\t\r\n\t<!-- MicrophoneSelector -->\r\n\t<element key="micselector.close" value="Close" />\r\n\t\r\n\t<!-- MaxplayerOptionsPanel -->\r\n\t<element key="maxplayeroptpanel.serverScrubRdBtn" value="Fast-Scrub" />\r\n\t<element key="maxplayeroptpanel.gopScrubRdBtn" value="Normal-Scrub" />\r\n\t<element key="maxplayeroptpanel.pressStoToggleScrub" value="Press S to Toggle Scrub Modes" />\r\n\t<element key="maxplayeroptpanel.pressQtoCycleQuality" value="Press Q to Cycle Quality Options" />\r\n\t<element key="maxplayeroptpanel.btn_accpet" value="Apply" />\r\n\t\r\n\t<!-- DeckCode -->\r\n\t<element key="deckcode.serverScrubEnabledText" value="-- Fast scrub mode --" />\r\n\t<element key="deckcode.serverScrubDisabledText" value="-- Normal scrub mode --" />\r\n\t<element key="deckcode.loadingUrl" value="Loading Video/EDL" />\r\n\t<element key="deckcode.sendFailed" value="Video/EDL Failed to Load - client not connected" />\r\n\t\r\n\t<!-- DeckControlBar -->\r\n\t<element key="deckcontrolbar.audioToggleBtn.tooltip" value="Show/Hide Audio Panel" />\r\n\t<element key="deckcontrolbar.optionsBtn.tooltip" value="Show/Hide Playback Options" />\r\n\t<element key="deckcontrolbar.toBeginBtn.tooltip" value="Go to Start" />\r\n\t<element key="deckcontrolbar.toMarkInBtn.tooltip" value="Go to In Point" />\r\n\t<element key="deckcontrolbar.markInBtn.tooltip" value="Mark In Point" />\r\n\t<element key="deckcontrolbar.seqSkipBack.tooltip" value="Previous Cut" />\r\n\t<element key="deckcontrolbar.backOneBtn.tooltip" value="Previous Frame" />\r\n\t<element key="deckcontrolbar.playBtn.tooltip" value="Play/Pause" />\r\n\t<element key="deckcontrolbar.forwardOneBtn.tooltip" value="Next Frame" />\r\n\t<element key="deckcontrolbar.seqSkipForward.tooltip" value="Next Cut" />\r\n\t<element key="deckcontrolbar.markOutBtn.tooltip" value="Mark Out Point" />\r\n\t<element key="deckcontrolbar.toMarkOutBtn.tooltip" value="Go to Out Point" />\r\n\t<element key="deckcontrolbar.toEndBtn.tooltip" value="Go to End" />\r\n\t<element key="deckcontrolbar.oneToOneBtn.tooltip" value="Native Video Size On/Off" />\r\n\t<element key="deckcontrolbar.fullscreenToggleBtn.tooltip" value="Fullscreen On/Off" />\r\n\t\r\n\t<!-- InfoBlock -->\r\n\t<element key="infoblock.currentTime.tooltip" value="Timecode" />\r\n\t<element key="infoblock.duration.tooltip" value="Duration" />\r\n\t<element key="infoblock.segmentCurrentTime.tooltip" value="Source Timecode" />\r\n\t<element key="infoblock.segmentDurationTime.tooltip" value="Segment Duration" />\r\n    <element key="infoblock.markIn.tooltip" value="In Point Timecode" />\r\n\t<element key="infoblock.markOut.tooltip" value="Out Point Timecode" />\r\n\t<element key="infoblock.toggleTimecodeFrame.tooltip" value="Timecode Display/Frame NUmber Display" />\r\n\t\r\n\t<!-- VariSpeedController -->\r\n\t<element key="varispeedcontroller.area.tooltip" value="Variable Speed Playback Bar" />\r\n\t<element key="varispeedcontroller.input.tooltip" value="Playback Speed Value" />\r\n\t<element key="varispeedcontroller.playback.mode.tooltip" value="Playback Mode" />\r\n\t<element key="varispeedcontroller.playback.mode.file" value="File" />\r\n\t<element key="varispeedcontroller.playback.mode.frame" value="Frame" />\r\n\t\r\n\t<!-- Browser -->\r\n\t<element key="browser.headerText.nameCol" value="Name" />\r\n\t<element key="browser.headerText.durationCol" value="Duration" />\r\n\t<element key="browser.headerText.displayCol" value="Display" />\r\n\t<element key="browser.headerText.fpsCol" value="Frame Rate" />\r\n\t<element key="browser.headerText.formatCol" value="Format" />\r\n\t<element key="browser.headerText.dateCol" value="Date" />\r\n\t<element key="browser.headerText.File" value="File" />\r\n\t\r\n\t<!-- Quality List -->\r\n\t<element key="playback.quality.low" value="Low" />\r\n\t<element key="playback.quality.medium" value="Medium" />\r\n\t<element key="playback.quality.high" value="High" />\r\n\r\n\t<!-- Frame based playback error overlays -->\r\n\t<element key="playback.error.mediaOffline" value="Media Offline" />\r\n\t<element key="playback.error.captureInProgress" value="Capture in progress" />\r\n\r\n</locale>\r\n'}),n("lang/Locale",["util/StringUtil","util/XMLUtil","util/JavascriptUtil","log/Log","text!common/locales/en.xml","net/Comm","event/Event"],function(e,t,n,r,a,i,o,s){function u(e,n){var r,a=t.XMLToObject(e);a.element.forEach(function(e){r=e["@attributes"],n[r.key]=r.value})}function l(e){n.ajax({method:"GET",url:e,dataType:"xml",callback:function(e,n){return e?void(f.length>0?(g.info("Load locale file failed. trying next fallback:"+f[0]),l(f.shift())):(g.critical("load locale file totally failed, no fallbacks left to try.  Using default."),u(t.StringToXML(a),p),m())):(u(n,p),c(),g.info("Locale file loaded."),void m())}})}function c(){for(var e in E)p.hasOwnProperty(e)&&void 0!=p[e]||g.error("Localization, missing key '"+e+"' in loaded localization file")}var d,f,m,g=r.getLogLine("Locales"),p={},E={};return u(t.StringToXML(a),E),{load:function(t,n){if(m=n,e.isEmpty(t)||(d=t),f=[],d.indexOf("/")>-1){f.push(d);var r=d.split("/");r=r[r.length-1].split("."),d=r[0]}else{(d.length<2||d.length>5)&&g.warn("Land & Region code is possibly invalid, received:"+d);var a=d.split("-");f.push("locales/"+d+".xml"),2==a.length&&f.push("locales/"+a[0]+".xml"),"en"!=a[0]&&"en"!=d&&f.push("locales/en.xml")}l(f.shift())},value:function(e){return p[e]},get langCode(){return d}}}),n("event/ExternalDispatcher",["log/Log","util/JavascriptUtil","event/EventStatus"],function(e,t,n){function r(e){if("function"==typeof e)return e;for(var t=e.split("."),n=window;t.length;){if(n=n[t[0]],void 0===n)return console.error("Couldn't find function for addEventListener: "+e),null;t.splice(0,1)}return n}var a=e.getLogLine("ExternalDispatcher"),i={};return{addEventListener:function(e,t){a.info("Adding listener: "+e);var n=r(t);i[e]?i[e].push(n):i[e]=[n]},removeEventListener:function(e,t){a.info("Removing listener: "+e);var n=r(t);if(i[e]){for(var o=0;i[e][o]!==n;)o++;i[e].splice(o,1)}},raiseEvent:function(e,r,a){if(a=t.defaultValue(a,n()),i[e])for(var o=0;o<i[e].length;o++)i[e][o]({type:e,params:r,status:a})}}}),n("event/ExternalInterface",["log/Log"],function(e){var t=e.getLogLine("ExternalInterface"),n={},r={},a=0,i={SET:"set",GET:"get"},o={APP_LOADED:"app.loaded",APP_VERSION:"app.version",APP_ERROR:"app.error",APP_SETTINGS_DIALOG:"app.settingsdialog",NET_CONNECT:"net.connect",USER_LOGIN:"user.login",DECK_LOAD:"deck.load",DECK_UNLOAD:"deck.unload",DECK_SWITCH:"deck.switch",DECK_PLAY:"deck.play",DECK_BUFFER:"deck.buffer",DECK_HEAD:"deck.head",DECK_VIDEO_QUALITY:"deck.video.quality",DECK_VIDEO_RATIO:"deck.video.ratio",DECK_AUDIO_MUTE:"deck.audio.mute",DECK_AUDIO_SOLO:"deck.audio.solo",DECK_AUDIO_VOLUME:"deck.audio.volume",DECK_AUDIO_PAN:"deck.audio.pan",DECK_AUDIO_TOTAL_TRACKS:"deck.audio.total_tracks",DECK_MIXER_LEVEL:"deck.mixer.level",DECK_MARK_IN:"deck.mark_in",DECK_MARK_OUT:"deck.mark_out",DECK_TIMELINE:"deck.timeline",DECK_TIMECODE_TRACK:"deck.timeline_track",DECK_DURATION:"deck.duration",DECK_FPS:"deck.fps",DECK_CONTENT_START:"deck.content_start",DECK_CONTENT_END:"deck.content_end",DECK_SPEED:"deck.speed",DECK_SCRUB_MODE:"deck.scrub_mode",DECK_IMAGE:"deck.image",DECK_AUDIO:"deck.audio",DECK_IMAGE_CURRENT:"deck.image.current",DECK_MODIFY:"deck.modify",DECK_FULLSCREEN:"deck.fullscreen",DECK_STATE:"deck.state",DECK_SEGMENT_NEXT:"deck.segment.next",DECK_SEGMENT_PREVIOUS:"deck.segment.previous",DECK_CLEAR_CACHE:"deck.clear_cache",DECK_CONFIG:"deck.config",DECK_CAPTIONS:"deck.captions",DECK_CAPTIONS_URL:"deck.captions.url",DECK_UI_AUDIO_SOURCE_SELECTION:"deck.ui.audio_source_selection",DECK_UI_STATISTICS:"deck.ui.statistics",DECK_UI_CAPTIONS:"deck.ui.captions",RECORDER_ENABLE:"recorder.enable",RECORDER_START:"recorder.start",RECORDER_STOP:"recorder.stop",RECORDER_CONFIRM:"recorder.confirm",RECORDER_SOURCE:"recorder.source",RECORDER_SOURCES:"recorder.sources",RECORDER_LEVEL:"recorder.level",RECORDER_GAIN:"recorder.gain",RSS_SUBSCRIBE:"rss.subscribe",RSS_UNSUBSCRIBE:"rss.unsubscribe",RSS_NOTIFY:"rss.notify",ASSET_METADATA:"asset.metadata",ASSET_PROXY:"asset.proxy",MULTICAM:"deck.multicam",MULTICAM_ANGLE:"deck.multicam.angle",MULTICAM_BANK:"deck.multicam.bank",MULTICAM_LAYOUT:"deck.multicam.layout",MULTICAM_AUDIO:"deck.multicam.audio",MULTICAM_CLICK_ENABLED:"deck.multicam.click_enabled",MULITICAM_LAYOUT_RENDER:"deck.multicam.layout.render",EXEC_XCORE_COMMAND:"xcore.exec"};return{KEYS:o,METHODS:i,callFunc:function(e,o,s){a++,t.info(e,o,JSON.stringify(s));var u;if(e===i.GET)u=n[o];else{if(e!==i.SET)return t.error("unsupported action: "+e),null;u=r[o]}if("undefined"==typeof u)return t.error("No function found for ExternalInterface key: "+o),null;null===s&&(s={});var l=u(s);return void 0===l&&(l=null),t.info("Result for "+e+" "+o+": "+JSON.stringify(l)),l},addSetter:function(e,t){r[e]=t},addGetter:function(e,t){n[e]=t}}}),n("net/Socket",["net/Message","log/Log","util/XMLUtil","util/JavascriptUtil","event/Event","event/EventStatus","event/Dispatcher","net/SOCKET_EVENTS","appbase/ConfigManager","lang/Locale","event/ExternalDispatcher","event/ExternalInterface"],function(e,t,n,r,a,i,o,s,u,l,c,d){return function(r,f){function m(e,t){if(!k)return!1;var r=n.XMLToString(n.objectToXML("xmd_packet",e.message)).toUint8Array(),a=r.length.toUint8Array(),i=e.data?e.data.byteLength:0,o=i.toUint8Array(),s=new Uint8Array(M.length+a.length+o.length+r.length+i);return s.set(M),s.set(a,M.length),s.set(o,M.length+a.length),s.set(r,M.length+a.length+o.length),e.hasData()&&s.set(new Int8Array(e.data),M.length+a.length+o.length+r.length),O.send(s.buffer),b.info("Message sent: "+JSON.stringify(e.message)),e.sendTime=(new Date).getTime(),e.callback=t,U[e.getId()]=e,!0}function g(e,t){I=!1,C.raiseEvent(a(s.LOGIN,e,t))}function p(t){var r=t.subarray(0,D.length).toString();if(r!==D)return b.error("Wrong socket message header: ",r),!1;if(T=t.subarray(D.length,D.length+4).toInt(),v=t.subarray(D.length+4,D.length+4+4).toInt(),R=e.createMessage(null,null),R.message=n.XMLToObject(n.StringToXML(t.subarray(D.length+8,D.length+8+T).toString())),0!==v){if(t.length<D.length+8+T+v)return!1;R.data=t.subarray(D.length+8+T,D.length+8+T+v)}t.length>D.length+8+T+v&&b.error("Socket message is longer than expected: "+(D.length+8+T+v)+" > "+t.length),P+=D.length+8+T+v,R.receiveTime=(new Date).getTime(),C.raiseEvent(a(s.RECEIVED_MESSAGE,R)),b.info("Received response:"+JSON.stringify(R.message));var o=R.getCommand(),u=U[R.getId()],l=!1;if(u&&(R.sendTime=u.sendTime,delete U[R.getId()],u.callback&&(l=!0,u.callback(R))),!l){var c;R.isOK()||(R.isError()&&(c=i(i().STATUS.ERROR_FROM_SERVER,R.getStatusErrorString())),R.isWarning()&&(c=i(i().STATUS.WARNING_FROM_SERVER,R.getStatusErrorString()))),C.raiseEvent(a(o.substr(0,o.length-3),R,c))}return R=null,T=0,v=0,!0}function E(){var t;for(var n in U){t=U[n],delete U[n];var r=e.createAbortedMessage(t.getCommand(),t.getId());t.callback?t.callback(r):C.raiseEvent(a(t.getCommand(),r,i(i().STATUS.ABORTED_MESSAGE,"Connection closed while message in transit")))}O&&(b.info("Socket closed"),O.close(),O=null),k=!1,L=!1}var _,S,h,T,v,A,I,y,b=t.getLogLine("Socket",!1),O=null,k=!1,C=o(),L=!1,D=(new Uint8Array(0),"XFST"),M=D.toUint8Array(),R=null,P=0,N=0,F=0,U={},w=1e4;return{dispatcher:C,connect:function(){this.stopReconnect(),this.connectXlbDispatcher(f.hostName,f.hostXmdPort)},connectXlbDispatcher:function(e,t){if(!I){if(I=!0,_=e,E(),!u.getConfig("app.xmd.cluster"))return void this.connectTo(e,t,function(){g(null,i(i().STATUS.COMMUNICATION_ERROR,"Couldn't connect to "+e))});b.info("contacting xlb dispatcher at "+e);var n=this;r.comm().getXmdService(function(r,a){if(r)return b.warn("error contacting xlb dispatcher: "+e),void n.connectTo(e,t,function(){g(null,i(i().STATUS.COMMUNICATION_ERROR,"Couldn't connect to "+e))});try{var o=JSON.parse(a)}catch(r){return b.warn("No load balancer dispatch available"),void n.connectTo(e,t,function(){g(null,i(i().STATUS.COMMUNICATION_ERROR,"Couldn't connect to "+e))})}if("ok"!==o.status)return b.warn("Dispatch error: "+a),void n.connectTo(e,t,function(){g(null,i(i().STATUS.COMMUNICATION_ERROR,"Couldn't connect to "+e))});b.info("Dispatch buffer: "+a);var s=t;o.data.hasOwnProperty("xlb_service_port")&&(s=o.data.xlb_service_port),n.connectTo(o.data.xlb_node_full_name,s,function(){_lls.warn("Couldn't connect to FQDN.  Trying hostname..."),n.connectTo(o.data.xlb_node_name,s,function(){_lls.warn("Couldn't connect to hostname.  Trying IP..."),n.connectTo(o.data.xlb_service_ip,s,function(){_lls.warn("Couldn't connect to IP.  Trying original hostname (no load balancing)..."),n.connectTo(e,s,function(){g(null,i(i().STATUS.COMMUNICATION_ERROR,"Couldn't connect to "+redirectHostName))})})})})})}},connectTo:function(t,n,r){if(!("WebSocket"in window))return b.error("WebSocket aren't supported by your browser.");S=t,h=n,A=r,O=new WebSocket((u.secureSocket?"wss":"ws")+"://"+t+":"+n),O.binaryType="arraybuffer";var o=this;O.onopen=function(){b.info("Socket connection opened.  Loggin in..."),k=!0,m(e.createPingMsg(l.langCode),function(t){f.serverVersionNumber=t.message.ping_re.server_version,C.raiseEvent(a(s.CONNECTED)),c.raiseEvent(d.KEYS.NET_CONNECT,{connect:k,host:_,node:S,port:h}),b.info("XmdSocket connected, login",f.schemeName,f.userName,f.userPassword,f.userSession),m(e.createLoginMsg(f.schemeName,f.userName,f.userPassword,f.userSession),function(e){var t;e.isError()?t=i(i().STATUS.ERROR_FROM_SERVER,e.getStatusMessageDetails()):e.isWarning()?t=i(i().STATUS.WARNING_FROM_SERVER,e.getStatusMessageDetails()):(t=i(),L=!0,b.info("Login success")),g(e,t)})})},O.onmessage=function(e){p(new Uint8Array(e.data))},O.onclose=function(e){var t=k;b.info("Socket connection closed",e),C.raiseEvent(a(s.DISCONNECTED)),E(),I=!1,t&&!o.isReconnecting()&&c.raiseEvent(d.KEYS.NET_CONNECT,{connect:k,host:_,node:S,port:h},e),t&&f.autoReconnection&&o.startReconnect()}},isConnected:function(){return k},sendMsg:m,startReconnect:function(){function e(){t.isConnected()?t.stopReconnect():(b.info("Attempting reconnect: "+f.hostName+":"+f.hostXmdPort),t.connectXlbDispatcher(f.hostName,f.hostXmdPort))}if(y)return b.warn("Already reconnecting.");var t=this;y=setInterval(e,w)},stopReconnect:function(){y&&(clearInterval(y),y=null)},isReconnecting:function(){return y},get authenticated(){return L},get host(){return _},get node(){return S},get bytesTotal(){return P},getReceivedByteRate:function(){var e=(P-N)/((Date.now()-F)/1e3);return N=P,F=Date.now(),e}}}}),n("cache/Cache",[],function(){return function(){return{clearDownloading:function(){}}}}),n("util/Timer",[],function(){return function(){var e;return{start:function(){e=Date.now()},get time(){return Date.now()-e}}}}),n("appbase/App",["net/Comm","net/Socket","cache/Cache","util/Timer"],function(e,t,n,r){var a,i,o={};o.comm=function(t){return a?a:a=e(t)},o.socket=function(e){return i?i:i=t(o,e)},o.cache=n(),o.timer=r();var s=window.AudioContext||window.webkitAudioContext;return o.audioContext=new s,o}),n("view/Resizer",[],function(){return function(e,t){var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(n){var r=new n(function(e){e.forEach(function(e){"attributes"==e.type&&"style"==e.attributeName&&t(e.target.clientWidth,e.target.clientHeight)})});r.observe(e,{attributes:!0,attributeFilter:["style"]}),t(e.clientWidth,e.clientHeight)}else{var a,i=250,o=0,s=0;a=setInterval(function(){var n=e.clientWidth,r=e.clientHeight;n===o&&r===s||(o=n,s=r,t(o,s))},i)}}}),n("view/Ruler",[],function(){return function(e){return{set cursor(e){},set cue(e){},set markIn(e){},set markOut(e){}}}}),n("text!common/static/player.html",[],function(){return'<div class="AICPSP_INFO">\r\n\t<div class="AICPSP_TC_LEFT">\r\n\t\t<div class="AICPSP_TC AICPSP_TC1">00:00:00:00</div>\r\n\t</div>\r\n\t<div class="AICPSP_TC_CENTER">\r\n\t\t<div class="AICPSP_TC AICPSP_TC2">00:00:00:00</div>\r\n\t\t<div class="AICPSP_TC AICPSP_TC3">00:00:00:00</div>\r\n\t</div>\r\n\t<div class="AICPSP_TC_RIGHT">\r\n\t\t<div class="AICPSP_TC AICPSP_TC4">00:00:00:00</div>\r\n\t</div>\r\n</div>\r\n<div class="AICPSP_CONTENT">\r\n\t<div class="AICPSP_VIDEO_CONTAINER">\r\n\t</div>\r\n\t<div class="AICPSP_STATISTICS">\r\n\t\t<div class="AICPSP_STATISTICS_BLOCK_HELPER"></div>\r\n\t\t<div class="AICPSP_STATISTICS_BLOCK">\r\n\t\t\t<table>\r\n\t\t\t\t<tr><th class="AICPSP_STATISTICS_TITLE" colspan="2"></th></tr>\r\n\t\t\t\t<tr><td class="AICPSP_STATISTICS_VIDEO_SOURCE"></td><td class="AICPSP_STATISTICS_VIDEO_SOURCE_VALUE"></td></tr>\r\n\t\t\t\t<tr><td class="AICPSP_STATISTICS_PROXY_QUALITY"></td><td class="AICPSP_STATISTICS_PROXY_QUALITY_VALUE"></td></tr>\r\n\t\t\t\t<tr><td class="AICPSP_STATISTICS_FRAME_RATE"></td><td class="AICPSP_STATISTICS_FRAME_RATE_VALUE"></td></tr>\r\n\t\t\t\t<tr><td class="AICPSP_STATISTICS_FRAMES_ADJUST"></td><td class="AICPSP_STATISTICS_FRAMES_ADJUST_VALUE"></td></tr>\r\n\t\t\t\t<tr><td class="AICPSP_STATISTICS_SEEK_TIME"></td><td class="AICPSP_STATISTICS_SEEK_TIME_VALUE"></td></tr>\r\n\t\t\t\t<tr><td class="AICPSP_STATISTICS_DATA_RATE"></td><td class="AICPSP_STATISTICS_DATA_RATE_VALUE"></td></tr>\r\n\t\t\t\t<tr><td class="AICPSP_STATISTICS_BUFFER"></td><td class="AICPSP_STATISTICS_BUFFER_VALUE">\r\n\t\t\t\t\t<div class="AICPSP_STATISTICS_BUFFER_VALUE_VIDEO"><div><img src="/static/images/bufferBars.png"></div></div>\r\n\t\t\t\t\t<div class="AICPSP_STATISTICS_BUFFER_VALUE_AUDIO"><div><img src="/static/images/bufferBars.png"></div></div>\r\n\t\t\t\t</td></tr>\r\n\t\t\t\t<tr><td class="AICPSP_STATISTICS_BUFFER_SIZE"></td><td class="AICPSP_STATISTICS_BUFFER_SIZE_VALUE"></td></tr>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="AICPSP_DEBUG">\r\n\t\t<div class="AICPSP_DEBUG_BLOCK_HELPER"></div>\r\n\t\t<div class="AICPSP_DEBUG_BLOCK">\r\n\t\t\t<table>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tr><td class="AICPSP_DEBUG_STAGE_FRAME_RATE"></td><td class="AICPSP_DEBUG_STAGE_FRAME_RATE_VALUE"></td></tr>\r\n\t\t\t\t\t\t\t<tr><td class="AICPSP_DEBUG_MEMORY_USAGE"></td><td class="AICPSP_DEBUG_MEMORY_USAGE_VALUE"></td></tr>\r\n\t\t\t\t\t\t\t<tr><td class="AICPSP_DEBUG_BYTES_RECEIVED"></td><td class="AICPSP_DEBUG_BYTES_RECEIVED_VALUE"></td></tr>\r\n\t\t\t\t\t\t\t<tr><td class="AICPSP_DEBUG_BYTES_RATE"></td><td class="AICPSP_DEBUG_BYTES_RATE_VALUE"></td></tr>\r\n\t\t\t\t\t\t\t<tr><td colspan="2">\r\n\t\t\t\t\t\t\t\t<button class="AICPSP_DEBUG_ENABLE_ALL"><br/>\r\n\t\t\t\t\t\t\t\t<button class="AICPSP_DEBUG_DISABLE_ALL">\r\n\t\t\t\t\t\t\t</td></tr>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td><td>\r\n\t\t\t\t\t\t<div class="AICPSP_DEBUG_LOG_LINES"></div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="AICPSP_PROGRESS">\r\n\t\t<div class="AICPSP_PROGRESS_BLOCK_HELPER"></div>\r\n\t\t<div class="AICPSP_PROGRESS_BLOCK">\r\n\t\t\t<div class="AICPSP_PROGRESS_SPIN_CONTAINER">\r\n\t\t\t\t<img src="/static/images/spinner.png" />\r\n\t\t\t</div>\r\n\t\t\t<span class="AICPSP_PROGRESS_TEXT"></span>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n<div class="AICPSP_BOTTOM">\r\n\t<div class="AICPSP_SCRUB">\r\n\t\t<img class="AICPSP_head" src="/static/images/markHeadOrange.png" />\r\n\t\t<img class="AICPSP_markIn" src="/static/images/markInOrange.png" />\r\n\t\t<img class="AICPSP_markOut" src="/static/images/markOutOrange.png" />\r\n\t</div>\r\n\t<div class="AICPSP_CONTROLS">\r\n\t\t<div class="AICPSP_CONTROLS_RIGHT">\r\n\t\t\t<div class="AICPSP_CONTROL AICPSP_OneToOne"><img src="/static/images/OneToOne.png" /></div><div class="AICPSP_CONTROL AICPSP_fullscreen"><img src="/static/images/fullscreen.png" /></div>\r\n\t\t</div>\r\n\t\t<div class="AICPSP_CONTROLS_LEFT">\r\n\t\t\t<div class="AICPSP_CONTROL AICPSP_options"><img src="/static/images/options.png" /></div><div class="AICPSP_CONTROL AICPSP_muteOff"><img src="/static/images/muteOff.png" /></div>\r\n\t\t</div>\r\n\t\t<div class="AICPSP_CONTROLS_MIDDLE">\r\n\t\t\t<div class="AICPSP_CONTROL AICPSP_toBegining"><img src="/static/images/toBegining.png" /></div><div class="AICPSP_CONTROL AICPSP_toMarker"><img src="/static/images/toMarker.png" /></div><div class="AICPSP_CONTROL AICPSP_markInButton"><img src="/static/images/markInButton.png" /></div><div class="AICPSP_CONTROL AICPSP_SeqSkipBack"><img src="/static/images/SeqSkipBack.png" /></div><div class="AICPSP_CONTROL AICPSP_backOne"><img src="/static/images/backOne.png" /></div><div class="AICPSP_CONTROL AICPSP_play"><img src="/static/images/play.png" /></div><div class="AICPSP_CONTROL AICPSP_forwardOne"><img src="/static/images/forwardOne.png" /></div><div class="AICPSP_CONTROL AICPSP_SeqSkipForward"><img src="/static/images/SeqSkipForward.png" /></div><div class="AICPSP_CONTROL AICPSP_markOutButton"><img src="/static/images/markOutButton.png" /></div><div class="AICPSP_CONTROL AICPSP_toEndMarker"><img src="/static/images/toEndMarker.png" /></div><div class="AICPSP_CONTROL AICPSP_toEnd"><img src="/static/images/toEnd.png" /></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="AICPSP_VARISPEED">\r\n\t\t<div class="AICPSP_VARISPEED_DISPLAY"></div><div class="AICPSP_VARISPEED_CONTROL"></div><div class="AICPSP_PLAYMODE"></div>\r\n\t</div>\r\n</div>';
}),n("util/TileAnimator",[],function(){return function(e,t,n,r,a){function i(){if(0!=d){if(o=Math.floor((Date.now()-d)*(a/1e3)%r),o!=s){s=o;var f=Math.floor(o/u)*n,m=o%u*t,g=m+t,p=f+n;e.style.clip="rect("+f+"px, "+g+"px, "+p+"px, "+m+"px)",e.style.marginTop=-f-l+"px",e.style.marginLeft=-m-c+"px"}window.requestAnimationFrame(i)}}var o=-1,s=-1,u=1,l=t/2,c=n/2,d=0;return e.addEventListener("load",function(n){u=e.width/t}),{start:function(){0==d&&(d=Date.now(),i())},stop:function(){d=0}}}}),n("util/NumberUtil",[],function(){return{ONE_MICRO:-1e6,ONE_MILLI:-1e3,ONE_KILO:1e3,ONE_MEGA:1e6,ONE_GEGA:1e9,ONE_KILO_BYTE:1024,ONE_MEGA_BYTE:1048576,ONE_GEGA_BYTE:1073741824,MAX_UINT32:4*this.ONE_GEGA_BYTE-1,MAX_INT32:2147483647,MAX_INT24:8388607,MAX_INT16:32767,MAX_INT8:127,getKilo:function(e){return e/this.ONE_KILO_BYTE},getMega:function(e){return this.getKilo(e)/this.ONE_KILO_BYTE},getGega:function(e){return this.getMega(e)/this.ONE_KILO_BYTE},getReadable:function(e){return this.getGega(e)>=1?this.getGega(e).toFixed(2)+" GB":this.getMega(e)>=1?this.getMega(e).toFixed(2)+" MB":this.getKilo(e)>=1?this.getKilo(e).toFixed(2)+" KB":e.toFixed(2)+" B"},minMax:function(e,t,n){return e>n?n:e<t?t:e},dBToNumber:function(e){return Math.pow(10,(e>20?20:e)/20)},NumberTodB:function(e){return 20*Math.log(minMax(e,0,1))},isEven:function(e){return e%2==0},isNumeric:function(e){return e-parseFloat(e)+1>=0},toNumber:function(e,t){return this.isNumeric(e)?parseFloat(e):t}}}),n("util/FrameRateCounter",[],function(){return function(){function e(){t++,a&&window.requestAnimationFrame(e)}var t,n,r={},a=!1;return r.start=function(t){t?a||(a=!0,r.flushFrameCount(),e()):a=!1},r.getFrameRate=function(){return t/((Date.now()-n)/1e3)},r.flushFrameCount=function(){t=0,n=Date.now()},r}}),n("util/DOMUtil",[],function(){return{removeAllChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}}}),n("view/DebugPanel",["util/NumberUtil","util/FrameRateCounter","event/ExternalDispatcher","event/ExternalInterface","log/Log","util/DOMUtil"],function(e,t,n,r,a,i){return function(o){function s(){f.innerText=S.getFrameRate().toFixed(2)+" FPS",S.flushFrameCount(),m.innerText=e.getReadable(window.performance.memory.usedJSHeapSize),g.innerText=e.getReadable(o.socket().bytesTotal),p.innerText=e.getReadable(o.socket().getReceivedByteRate())}function u(e){for(var t=E.childNodes,n=0,r=t.length;n<r;n++){var i=t[n].category;a.logLines[i].enabled=e,t[n].enabled=e,t[n].className=e?"AICPSP_DEBUG_LOG_LINE_ACTIVE":"AICPSP_DEBUG_LOG_LINE"}}function l(){i.removeAllChildren(E);for(var e in a.logLines){var t=document.createElement("div"),n=a.logLines[e];t.innerText=n.category,t.className=n.enabled?"AICPSP_DEBUG_LOG_LINE_ACTIVE":"AICPSP_DEBUG_LOG_LINE",t.category=n.category,t.enabled=n.enabled,t.addEventListener("click",function(e){this.enabled=!this.enabled,this.className=this.enabled?"AICPSP_DEBUG_LOG_LINE_ACTIVE":"AICPSP_DEBUG_LOG_LINE",a.logLines[this.category].enabled=this.enabled}),E.appendChild(t)}}var c,d,f,m,g,p,E,_={},S=t();return _.setDOM=function(e){c=e,c.getElementsByClassName("AICPSP_DEBUG_STAGE_FRAME_RATE")[0].innerText="Stage Frame Rate:",c.getElementsByClassName("AICPSP_DEBUG_MEMORY_USAGE")[0].innerText="Memory Usage:",c.getElementsByClassName("AICPSP_DEBUG_BYTES_RECEIVED")[0].innerText="Bytes Received:",c.getElementsByClassName("AICPSP_DEBUG_BYTES_RATE")[0].innerText="Bytes Rate:",f=c.getElementsByClassName("AICPSP_DEBUG_STAGE_FRAME_RATE_VALUE")[0],m=c.getElementsByClassName("AICPSP_DEBUG_MEMORY_USAGE_VALUE")[0],g=c.getElementsByClassName("AICPSP_DEBUG_BYTES_RECEIVED_VALUE")[0],p=c.getElementsByClassName("AICPSP_DEBUG_BYTES_RATE_VALUE")[0];var t=c.getElementsByClassName("AICPSP_DEBUG_ENABLE_ALL")[0];t.innerText="Enable all",t.addEventListener("click",function(e){u(!0)}),t=c.getElementsByClassName("AICPSP_DEBUG_DISABLE_ALL")[0],t.innerText="Disable all",t.addEventListener("click",function(e){u(!1)}),E=c.getElementsByClassName("AICPSP_DEBUG_LOG_LINES")[0]},_.setSize=function(e,t){c.style.width=e+"px",c.style.height=t+"px"},_.show=function(e){e!=_.isShowing()&&(c.style.display=e?"block":"none",S.start(e),e?(d||(d=setInterval(s,1e3)),l()):(clearInterval(d),d=null),n.raiseEvent(r.KEYS.APP_SETTINGS_DIALOG,{visible:e}))},_.isShowing=function(){return"block"==c.style.display},_}}),n("view/BufferDisplay",[],function(){return function(e){var t;e.firstChild.firstChild.addEventListener("load",function(n){t=n.target.width,e.style.width=t+"px"});var n={setValue:function(n){e.firstChild.style.width=Math.floor(n*t)+"px"}};return n}}),n("view/StatisticsPanel",["util/NumberUtil","util/FrameRateCounter","event/ExternalDispatcher","event/ExternalInterface","lang/Locale","view/BufferDisplay"],function(e,t,n,r,a,i){return function(t,n){function r(){var t=n.playback.statistics();if(null!=t){o.getElementsByClassName("AICPSP_STATISTICS_VIDEO_SOURCE_VALUE")[0].innerText=t.raster,o.getElementsByClassName("AICPSP_STATISTICS_PROXY_QUALITY_VALUE")[0].innerText=String(t.currentProxyWidth)+"x"+String(t.currentProxyHeight)+" "+String(t.currentQuality)+"%";var r=t.timePlayed;t.lastStarted&&(r+=Date.now()-t.lastStarted);var i=0;r&&(i=Math.floor(t.framesDrawn/r*1e5)/100);var l=Math.floor(100*t.fpsCurrent)/100;o.getElementsByClassName("AICPSP_STATISTICS_FRAME_RATE_VALUE")[0].innerText=l.toFixed(2)+" / "+i.toFixed(2)+" "+a.value("deck.fps");var c=Math.floor(t.framesDropped/t.framesDrawn*1e3)/10;o.getElementsByClassName("AICPSP_STATISTICS_FRAMES_ADJUST_VALUE")[0].innerText=String(t.framesAdjusted)+" / "+t.framesDropped+" ("+(isNaN(c)?0:c)+"%)",o.getElementsByClassName("AICPSP_STATISTICS_SEEK_TIME_VALUE")[0].innerText=t.seekTime+a.value("deck.ms"),o.getElementsByClassName("AICPSP_STATISTICS_DATA_RATE_VALUE")[0].innerText=e.getReadable(t.rateVideo)+a.value("deck.ps")+" / "+e.getReadable(t.rateAudio)+a.value("deck.ps"),o.getElementsByClassName("AICPSP_STATISTICS_BUFFER_SIZE_VALUE")[0].innerText=t.audioBufferCurrent.toFixed(3)+" / "+t.bufferTarget.toFixed(3),s.setValue(t.videoBufferCurrent/t.bufferTarget),u.setValue(t.audioBufferCurrent/t.bufferTarget)}}var o,s,u,l,c={};return c.setDOM=function(e){o=e,o.getElementsByClassName("AICPSP_STATISTICS_TITLE")[0].innerText=a.value("statspanel.title"),o.getElementsByClassName("AICPSP_STATISTICS_VIDEO_SOURCE")[0].innerText=a.value("statspanel.raster"),o.getElementsByClassName("AICPSP_STATISTICS_PROXY_QUALITY")[0].innerText=a.value("statspanel.proxyspec"),o.getElementsByClassName("AICPSP_STATISTICS_FRAME_RATE")[0].innerText=a.value("statspanel.frameratestats"),o.getElementsByClassName("AICPSP_STATISTICS_FRAMES_ADJUST")[0].innerText=a.value("statspanel.framestats"),o.getElementsByClassName("AICPSP_STATISTICS_SEEK_TIME")[0].innerText=a.value("statspanel.seektime"),o.getElementsByClassName("AICPSP_STATISTICS_DATA_RATE")[0].innerText=a.value("statspanel.ratestat"),o.getElementsByClassName("AICPSP_STATISTICS_BUFFER")[0].innerText=a.value("statspanel.buffer"),o.getElementsByClassName("AICPSP_STATISTICS_BUFFER_SIZE")[0].innerText=a.value("statspanel.bufferTime"),s=i(o.getElementsByClassName("AICPSP_STATISTICS_BUFFER_VALUE_VIDEO")[0]),u=i(o.getElementsByClassName("AICPSP_STATISTICS_BUFFER_VALUE_AUDIO")[0])},c.setSize=function(e,t){o.style.width=e+"px",o.style.height=t+"px"},c.show=function(e){e!=c.isShowing()&&(o.style.display=e?"block":"none",e?l||(l=setInterval(r,200)):(clearInterval(l),l=null))},c.isShowing=function(){return"block"==o.style.display},c}}),n("view/View",["appbase/ConfigManager","util/JavascriptUtil","log/Log","event/ExternalDispatcher","event/ExternalInterface","view/Resizer","view/Ruler","play/EPlayback","text!common/static/player.html","view/STYLES","util/TileAnimator","util/NumberUtil","view/DebugPanel","view/StatisticsPanel"],function(e,t,n,r,a,i,o,s,u,l,c,d,f,m){return function(r,a,d,g){function p(e){F.cue=parseInt(e.params.frame,10)}function E(e){S(!0)}function _(e){S(!1)}function S(e){document.getElementsByClassName("AICPSP_play")[0].firstElementChild.src="static/images/"+(e?"pause.png":"play.png")}function h(){function e(e){D.style.left=e.clientX+"px",d.playback.seekQuality(Math.floor(D.offsetLeft/L.clientWidth*d.playback.duration),!0,!0,!1)}function t(n){D.style.left=n.clientX+"px",window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t),d.playback.seekQuality(Math.floor(D.offsetLeft/L.clientWidth*d.playback.duration),!1,!0,!0)}function n(e){D.style.left=e.layerX+"px",d.playback.seekQuality(Math.floor(D.offsetLeft/L.clientWidth*d.playback.duration),!0,!0,!1),e.preventDefault()}function r(e){D.style.left=e.layerX+"px",window.removeEventListener("touchmove",n),window.removeEventListener("touchend",r),d.playback.seekQuality(Math.floor(D.offsetLeft/L.clientWidth*d.playback.duration),!1,!0,!0),e.preventDefault()}if(!O){var i,o,s;for(I=a.parentNode.parentNode,i=0,o=a.childElementCount;i<o;i++)switch(s=a.children[i],s.className){case"AICPSP_INFO":y=s,y.style.height="30px";break;case"AICPSP_CONTENT":b=s;break;case"AICPSP_BOTTOM":k=s,k.style.height="110px"}for(i=0,o=b.childElementCount;i<o;i++)switch(s=b.children[i],s.className){case"AICPSP_VIDEO_CONTAINER":O=s,d.setContainer(O);break;case"AICPSP_STATISTICS":w.setDOM(s);break;case"AICPSP_DEBUG":U.setDOM(s);break;case"AICPSP_PROGRESS":M=s,R=c(M.getElementsByTagName("img")[0],40,40,21,30),P=M.getElementsByTagName("span")[0],A("",!1)}for(i=0,o=k.childElementCount;i<o;i++)switch(s=k.children[i],s.className){case"AICPSP_BOTTOM":break;case"AICPSP_CONTROLS":C=s;break;case"AICPSP_VARISPEED":}for(i=0,o=C.childElementCount;i<o;i++)switch(s=C.children[i],s.className){case"AICPSP_CONTROLS_RIGHT":break;case"AICPSP_CONTROLS_LEFT":break;case"AICPSP_CONTROLS_MIDDLE":}L=k.firstElementChild,D=L.firstElementChild,L.addEventListener("mousedown",function(n){D.style.left=n.clientX+"px",window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)}),L.addEventListener("touchstart",function(e){D.style.left=e.layerX+"px",window.addEventListener("touchmove",n),window.addEventListener("touchend",r),e.preventDefault()});var u=document.getElementsByClassName("AICPSP_play")[0];u.onclick=function(e){d.togglePlay()}}}function T(t,n){h(),v(e.getConfig("deck.ui.style.type").toLocaleLowerCase());var r=n-y.clientHeight-k.clientHeight;d.resize(t,r),b.style.width=t+"px",b.style.height=r+"px",O.style.width=t+"px",O.style.height=r+"px",w.setSize(t,r),U.setSize(t,r),M.style.width=t+"px",M.style.height=n+"px"}function v(e){switch(e){case l.PLAYBACK:case l.EDIT:case l.EDL:y.style.display="block",k.style.display="block";break;case l.NO_TIMECODE:y.style.display="none",k.style.display="block";break;case l.CHROMELESS:y.style.display="none",k.style.display="none"}}function A(e,t){M&&(e&&(P.innerText=e),t?(R.start(),M.style.display="block"):(R.stop(),M.style.display="none"))}var I,y,b,O,k,C,L,D,M,R,P,N=n.getLogLine("View"),F=o(),U=f(r),w=m(r,d);return t.loadLink(g+"static/player.css",function(e){if(e)return N.error("Couldn't load style sheet for player.  Missing static/player.css.")}),a.className="AICPSP",u=u.replace(/src="\/static/g,'src="'+g+"static"),a.innerHTML=u,i(a.parentNode.parentNode,T),d.dispatcher.addListener(s.EVENTS.SEEK_START,p),d.dispatcher.addListener(s.EVENTS.PLAY_START,E),d.dispatcher.addListener(s.EVENTS.PLAY_PAUSE,_),d.dispatcher.addListener(d.EVENTS.PROGRESS,function(e){A(e.params.progress.message,!e.params.progress.isDone())}),{variSpeedController:{showPlaybackMode:function(e){}},showPlaybackStatistics:w.show,isPlaybackStatisticsShowing:w.isShowing,showDebugPanel:U.show,isDebugPanelShowing:U.isShowing}}}),n("net/CommConf",["appbase/ConfigManager"],function(e){return{hostName:"",schemeName:"",hostXmdPort:5e3,userName:"",userPassword:"",userSession:"",autoReconnection:!0,useCluster:!0,serverVersionNumber:"unknown",getUrlHost:function(){return(e.managerSecure?"https://":"http://")+this.hostName+":"+e.managerPort+"/"+e.managerRoute},setLoginConf:function(e,t,n,r,a){this.schemeName=e,this.hostName=t,this.userName=n,this.userPassword=r,this.userSession=a},setSession:function(e){this.userSession=e}}}),n("play/PlaybackFramesImage",["event/Dispatcher","event/Event","log/Log"],function(e,t,n){var r=function(){this.ll=n.getLogLine("PlaybackFramesImage"),this._EVENTS={IMAGE_LOADED:"IMAGE_LOADED"},this._dispatcher=e(),this._isLastFrame=!1,this._loaded=!1};return r.prototype.loadImage=function(e){if(this._loaded=!1,e){this._image=document.createElement("img");var n=this;this._image.addEventListener("load",function(e){n._loaded=!0,n._dispatcher.raiseEvent(t(n._EVENTS.IMAGE_LOADED,n._rasterFrame))}),this._image.addEventListener("error",function(e){n.ll.error("Couldn't load image:"+JSON.stringify(e))}),this._data=e,this._image.src=URL.createObjectURL(e.slice(0).toBlob("image/jpeg"))}},r.prototype.load=function(e,t,n,r,a,i){this._realFrame=t,this._rasterFrame=isNaN(e)?0:e,this._duration=isNaN(n)?0:n,this._time=0,this.loadImage(r),this._layout=void 0===a?null:a,this._bank=isNaN(i)?0:i},r.prototype.unload=function(){this._image&&URL.revokeObjectURL(this._image.src)},Object.defineProperty(r.prototype,"EVENTS",{get:function(){return this._EVENTS}}),Object.defineProperty(r.prototype,"dispatcher",{get:function(){return this._dispatcher}}),Object.defineProperty(r.prototype,"data",{get:function(){return this._data}}),Object.defineProperty(r.prototype,"image",{get:function(){return this._image}}),Object.defineProperty(r.prototype,"realFrame",{get:function(){return this._realFrame}}),Object.defineProperty(r.prototype,"rasterFrame",{get:function(){return this._rasterFrame}}),Object.defineProperty(r.prototype,"duration",{get:function(){return this._duration}}),Object.defineProperty(r.prototype,"time",{get:function(){return this._time},set:function(e){this._time=e}}),Object.defineProperty(r.prototype,"isLastFrame",{get:function(){return this._isLastFrame},set:function(e){this._isLastFrame=e}}),Object.defineProperty(r.prototype,"loaded",{get:function(){return this._loaded}}),Object.defineProperty(r.prototype,"layout",{get:function(){return this._layout}}),Object.defineProperty(r.prototype,"bank",{get:function(){return this._bank}}),r}),n("play/PlaybackFramesImages",["log/Log","play/EPlayback","event/Dispatcher","play/PlaybackFramesImage","event/Event"],function(e,t,n,r,a){return function(i,o){function s(){u(l),l=[]}function u(e){if(e)for(var t=0,n=e.length;t<n;t++)d.unredispatch(e[t].dispatcher,e[t].EVENTS.IMAGE_LOADED),e[t].unload()}var l,c=e.getLogLine("PlaybackFramesImages"),d=n(),f=i,m=o;return s(),{dispatcher:d,addImage:function(e,n,i,o,s,u){var c=new r;c.load(e,n,i,o,s,u),d.redispatch(c.dispatcher,c.EVENTS.IMAGE_LOADED);for(var f=l.length;f>0&&c.rasterFrame<l[f-1].rasterFrame;)f--;if(l.splice(f,0,c),f){var m=l[f-1].time;for(f-=1;f<l.length;f++)l[f].time=m,m+=l[f].duration/1e9}this.isBufferFull()&&d.raiseEvent(a(t.EVENTS.PLAY_START,null))},getFrameAt:function(e){if(!l.length)return c.error("Frame requested from empty buffer..."),null;for(var t=0;t<l.length-1&&e>l[t].time;)t++;return t>1&&(m.framesDropped+=t-1),u(l.splice(0,t)),l[0]},getFrameFirst:function(){return l.length?l[0]:null},clearBuffer:s,getBufferLength:function(){return l.length},getBufferTime:function(){return l.length?l[l.length-1].time-l[0].time:0},hasFullBuffer:function(){var e=this.getBufferTime()>=f;return!e&&l.length&&(e=l[l.length-1].isLastFrame),e},hasFrame:function(e){if(0===l.length)return!1;for(var t=l[0].realFrame,n=l[0].realFrame,r=1;r<l.length;r++)l[r].realFrame<t?t=l[r].realFrame:l[r].realFrame>n&&(n=l[r].realFrame);return e>=t&&e<=n},getLastRealFrameNum:function(){return l.length?l[l.length-1].realFrame:(c.error("PlaybackFramesImages.getLastFrameNum: getting last frame of an empty array"),0)},getLastRasterFrame:function(){return l.length?l[l.length-1].rasterFrame:0},getFirstRealFrameNum:function(){return 0===l.length?0:l[0].realFrame},getLastFrameInBuffer:function(){return l.length?l[l.length-1]:null},hasLastFrame:function(){return!!l.length&&l[l.length-1].isLastFrame},setBufferTime:function(e){f=e},isBufferFull:function(){return!!l.length&&(this.getBufferTime()>f||l[l.length-1].isLastFrame)}}}}),n("util/Sound",["appbase/App","log/Log"],function(e,t){return function(n){var r,a=t.getLogLine("Sound"),i=0,o=e.audioContext,s=o.createScriptProcessor(4096,0,2),u=o.createGain();o.createStereoPanner?(r=o.createStereoPanner(),u.connect(r),r.connect(o.destination)):(a.warn("Safari doesn't support StereoPannerNode (yet)."),u.connect(o.destination)),s.onaudioprocess=n;var l={playing:!1,play:function(){this.playing=!0,s.connect(u),i=o.currentTime},stop:function(){this.playing=!1,s.disconnect()},playSingle:function(e,t,n,r,a){var i=o.createBufferSource();i.buffer=o.createBuffer(n,e.length,a),i.buffer.getChannelData(0).set(e),i.buffer.getChannelData(1).set(t),i.connect(u),i.start()},get position(){return this.playing?o.currentTime-i:0},get sampleRate(){return o.sampleRate},decodeAudioData:function(e,t){o.decodeAudioData(e.buffer,function(e){t(null,e)},function(e){t(e)})},wrapMP3:function(e){var t=new ArrayBuffer(32+e.length),n=new DataView(t);return n.setUint32(0,4294680640),n.setUInt8array(e,32),n},deinterweaveAudio:function(e,t,n,r){if(2!==t)return a.error("Invalid channel count.  Expecting 2.");for(var i=new DataView(e),s=n/8*2,u=e.byteLength/2/s,l=o.createBuffer(t,u,r),c=0,d=l.getChannelData(0),f=l.getChannelData(1);c<u;){switch(n){case 8:d[c]=i.getInt8(c*s)/128,f[c]=i.getInt8(c*s+1)/128;break;case 16:d[c]=i.getInt16(c*s,!0)/32767,f[c]=i.getInt16(c*s+2,!0)/32767;break;case 32:d[c]=i.getFloat32(c*s,!0),f[c]=i.getFloat32(c*s+4,!0)}c++}return l},interweaveAudio:function(e){for(var t=new Int16Array(2*e.length),n=e.getChannelData(0),r=e.getChannelData(1),a=0,i=e.length;a<i;a++)t[2*a]=32767*n[a],t[2*a+1]=32767*r[a];return t},concat:function(e,t){var n=o.createBuffer(e.numberOfChannels,e.length+t.length,e.sampleRate);return n.getChannelData(0).set(e.getChannelData(0),0),n.getChannelData(1).set(e.getChannelData(1),0),n.getChannelData(0).set(t.getChannelData(0),e.length),n.getChannelData(1).set(t.getChannelData(1),e.length),n},setGain:function(e){u.gain.value=e},getGain:function(){return u.gain},setPan:function(e){r&&(r.pan.value=e)},getPan:function(){return r?r.pan.value:0}};return l}}),n("util/CircularFloat32Array",[],function(){return function(e){var t=0,n=0,r=new Float32Array(e);return{append:function(a){if(a.length>e-n)return!1;var i=(t+n)%e,o=e-i;return a.length>o?(r.set(a.subarray(0,o),i),r.set(a.subarray(o),0)):r.set(a,i),n+=a.length,!0},moveOffset:function(r){t+=r,n-=r,t>=e&&(t-=e),t<0&&(t+=e)},subarray:function(a,i){if(i>n&&console.error("End is out of bounds"),t+a<e&&t+i>e){var o=new Float32Array(i-a);return o.set(r.subarray(t+a,e)),o.set(r.subarray(0,t+i-e),e-t+a),o}return r.subarray((t+a)%e,(t+i)%e)},array:function(){return this.subarray(0,n)},clear:function(){t=0,n=0},get length(){return n},set length(e){n=e},getFloat32:function(){var e=r[t];return this.moveOffset(1),e},setFloat32:function(e){r[t]=e,this.moveOffset(1)},get offset(){return t}}}}),n("play/PlaybackFramesSound",["play/EPlayback","event/Dispatcher","event/Event","log/Log","util/Sound","util/NumberUtil","util/CircularFloat32Array"],function(e,t,n,r,a,i,o){return function(s,u,l){function c(){b.play()}function d(t){var r=0,a=0,i=Math.min(I.length,t.outputBuffer.length);for(t.outputBuffer.getChannelData(0).set(I.subarray(0,i)),t.outputBuffer.getChannelData(1).set(y.subarray(0,i));i;)r=Math.max(r,I.getFloat32()),a=Math.max(a,y.getFloat32()),i--;A.raiseEvent(n(e.EVENTS.AUDIO_MIXER_LEVEL,{peak_left:r,peak_right:a})),I.length||(console.log("No more sound."),k&&clearTimeout(k),k=setTimeout(m,I.length/u.audioSampleRate))}function f(){b&&b.playing&&(_+=b.position,b.stop(),A.raiseEvent(n(e.EVENTS.AUDIO_MIXER_LEVEL,{peak_left:0,peak_right:0})))}function m(){k=0,f(),A.raiseEvent(n(v.SOUND_COMPLETE,null)),A.raiseEvent(n(e.EVENTS.AUDIO_MIXER_LEVEL,{peak_left:0,peak_right:0}))}function g(){f(),I.clear(),y.clear(),_=0,O=!1}function p(){void 0!==u&&(E=u.audioBitPerSample/8*2,S=l*u.audioSampleRate*E,g())}var E,_,S,h,T=r.getLogLine("PlaybackFramesSound"),v={SOUND_COMPLETE:"sound_complete",AUDIO_READY:"audio_ready"},A=t(),I=o(1e6),y=o(1e6),b=a(d),O=!1,k=0;return u.audioSampleRate!==b.sampleRate&&(T.warn("This machine does not support configured sample rate ("+u.audioSampleRate+").  Setting it to "+b.sampleRate+"."),u.audioSampleRate=b.sampleRate),p(),{dispatcher:A,EVENTS:v,resetAudioOptions:p,appendBuffer:function(t,r,a){if(O=r,!t)return void T.info("Got null data for the audio buffer");if(a){var i=this;b.decodeAudioData(t,function(t,r){return t?void T.error(t):(I.append(r.getChannelData(0))||_ll.error("Left audio buffer overrun."),I.append(r.getChannelData(1))||_ll.error("Right audio buffer overrun."),void(b&&!b.playing&&i.isBufferFull()&&A.raiseEvent(n(e.EVENTS.PLAY_START,null))))},T.error)}else{var o=0,s=t.length,u=s/E,l=I.length+u,c=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(I.moveOffset(I.length),y.moveOffset(y.length),E){case 2:for(;o<s;)I.setFloat32(c.getInt8(o)/128),o++,y.setFloat32(c.getInt8(o)/128),o++;break;case 4:for(;o<s;)I.setFloat32(c.getInt16(o,!0)/32767),o+=2,y.setFloat32(c.getInt16(o,!0)/32767),o+=2;break;case 8:for(;o<s;)I.setFloat32(c.getFloat32(o,!0)),o+=4,y.setFloat32(c.getFloat32(o,!0)),o+=4}I.moveOffset(-1*l),I.length=l,y.moveOffset(-1*l),y.length=l,b&&!b.playing&&this.isBufferFull()&&A.raiseEvent(n(e.EVENTS.PLAY_START,null))}},appendZeroBuffer:function(e,t){var n=e*E;h&&h.length==n||(h=new Uint8Array(n),h.fill(0)),this.appendBuffer(h,t,!1)},clearBuffer:g,play:function(){f(),_=0,c()},playSingle:function(){b.playSingle(I.array(),y.array(),2,32,u.audioSampleRate)},resume:function(){c()},stop:f,isPlaying:function(){return b.playing},get position(){return b&&b.playing?b.position+_:_},get bufferSize(){return I.length},isBufferFull:function(){return I.length>S||O},isBufferEmpty:function(){return I.length>0},getBufferTime:function(){return I.length/E/u.audioSampleRate},setVolume:function(e){b.setGain(i.dBToNumber(e))},getVolume:function(){return i.NumberTodB(b.getGain())},setPan:function(e){b.setPan(e)},getPan:function(){return b.getPan()},setMute:function(e){b.setMute(e)},getMute:function(){return b.getMute()},setSolo:function(e){b.setSolo(e)},getSolo:function(){return b.getSolo()}}}}),n("play/PlaybackFramesOptions",[],function(){return function e(){return{frame:0,width:1,height:1,rasterWidth:1,rasterHeight:1,rasterFps:30,isVideoCompressed:!0,compressionQuality:80,dominance:"FRAME",layer:"NONE",isFieldBasedRender:!1,eyeSelectionMask:-1,directIO:!1,useCache:!0,audioSampleRate:48e3,audioBitPerSample:16,audibleChannelsMask:-1,isAudioCompressed:!1,isLoop:!1,speed:0,first:0,last:-1,streamingMode:"FRAMES",copy:function(){var t=e();return t.frame=this.frame,t.width=this.width,t.height=this.height,t.rasterWidth=this.rasterWidth,t.rasterHeight=this.rasterHeight,t.rasterFps=this.rasterFps,t.isVideoCompressed=this.isVideoCompressed,t.compressionQuality=this.compressionQuality,t.dominance=this.dominance,t.layer=this.layer,t.isFieldBasedRender=this.isFieldBasedRender,t.eyeSelectionMask=this.eyeSelectionMask,t.directIO=this.directIO,t.useCache=this.useCache,t.audioSampleRate=this.audioSampleRate,t.audioBitPerSample=this.audioBitPerSample,t.audibleChannelsMask=this.audibleChannelsMask,t.isAudioCompressed=this.isAudioCompressed,t.isLoop=this.isLoop,t.speed=this.speed,t.first=this.first,t.last=this.last,t.streamingMode=this.streamingMode,t}}}}),n("play/PlaybackStatistics",[],function(){return function(){return{fpsCurrent:0,framesDrawn:0,timePlayed:0,lastStarted:0,framesDropped:0,videoBufferCurrent:0,videoBufferTarget:1,audioBufferCurrent:1,audioBufferTarget:0,framesAdjusted:0,seekTime:0,rateVideo:0,rateAudio:0,raster:"",currentProxyWidth:0,currentProxyHeight:0,currentQuality:0,reset:function(){this.videoBufferCurrent=0,this.audioBufferCurrent=0,this.fpsCurrent=0,this.framesDrawn=0,this.timePlayed=0,this.lastStarted=0,this.framesAdjusted=0,this.framesDropped=0}}}}),n("play/PlaybackFramesLatencyParameters",["appbase/ConfigManager"],function(e){return function(){return{getLowWaterLevel:function(){return e.playbackLatencyLow},getTargetWaterLevel:function(){return e.playbackLatencyTarget}}}}),n("play/PlaybackFramesDynamicBuffer",["util/NumberUtil","appbase/ConfigManager"],function(e,t){return function(){function n(n){if(t.dynamicBuffer){var r=Date.now();if(c){for(u.push((r-c)/1e3/n),u.length>l&&u.shift(),i=0,s=u.length,o=0;o<s;o++)i+=u[o];a=i/u.length,d=e.minMax(a*t.playbackLatencyTarget,t.playbackLatencyTarget,t.maximumBuffer)}c=r}}function r(){c=0}var a,i,o,s,u=[],l=t.dynamicBufferDeltasLength,c=0,d=t.playbackLatencyTarget;return t.dispatcher.addListener(t.EVENTS.CHANGED,function(e){switch(e.params.key){case"deck.playback_frames.level_target":d=t.playbackLatencyTarget,u=[],r()}}),{get target(){return d},clear:r,adjust:n}}}),n("data/AudioStates",["log/Log"],function(e){return function(){function t(e){var t=1<<e;return a?Boolean(a&t):!(r&t)}function n(){r=4294967295,a=0;var e;for(o=new Array(32),i=new Array(32),e=0;e<32;e++)o[e]=0,i[e]=0}var r,a,i,o;e.getLogLine("AudioStates");return n(),{MAX_TRACKS:32,reset:n,muteTrack:function(e,t){var n=1<<e;!t&&r&n?r-=n:!t||r&n||(r+=n)},isMute:function(e){var t=1<<e;return Boolean(r&t)},soloTrack:function(e,t){var n=1<<e;!t&&a&n?a-=n:!t||a&n||(a+=n)},isSolo:function(e){var t=1<<e;return Boolean(a&t)},hasSolo:function(){return Boolean(a)},setTrackPan:function(e,t){o[e]=t},getTrackPan:function(e){return o[e]},setTrackVolume:function(e,t){i[e]=t},getTrackVolume:function(e){return i[e]},isAudible:t,audibleMask:function(){return a?a:~r}}}}),n("timecode/Fps",[],function(){return function(e){function t(e){r=e,a=Boolean(r%1)&&(30==n()||60==n())}function n(){return Math.ceil(r)}var r,a,i=.01;return t(e),{setFps:t,intFps:n,realFps:function(){return r},supportDFTimecode:function(){return a},get rationalFps(){return this.convertToRational(r)},convertToRational:function(e){return Math.abs(e-3e4/1001)<i?3e4/1001:Math.abs(e-30)<i?30:Math.abs(e-24)<i?24:Math.abs(e-25)<i?25:Math.abs(e-6e4/1001)<i?6e4/1001:Math.abs(e-24e3/1001)<i?24e3/1001:Math.abs(e-96e3/1001)<i?96e3/1001:e}}}}),n("timecode/SmpteTimecode",["util/StringUtil","log/Log"],function(e,t){return function(n){function r(t){return e.padDigit(t)}function a(e,t,n,r,a,i){o=e,s=t,u=n,l=r,c=a,d=i}function i(){a(0,0,0,0,!1,!1)}var o,s,u,l,c,d,f=t.getLogLine("SmpteTimecode"),m="––:––:––:––",g=39,p=n;return i(),{set:a,setZero:i,UNDEFINED_TIMECODE:m,setFromTimecode:function(e){if(e==m)return void i();var t=e.split(";").join(":").split("*").join(""),n=t.split(":");4==n.length?(o=parseInt(n[0],10),s=parseInt(n[1],10),u=parseInt(n[2],10),l=parseInt(n[3],10),d=e.indexOf(";")>-1,c=e.indexOf("*")>-1):i()},getTimecode:function(){return r(o)+":"+r(s)+":"+r(u)+(d?";":":")+r(l)+(c?"*":"")},setFromFrame:function(e,t,n){var r=t.intFps(),a=Math.floor(e+1e-4*r);d=n&&t.supportDFTimecode;var i;if(d){var f=r/30*2,m=60*r,E=10*m-9*f,_=m-f,S=a/E,h=a%E,T=(h-f)/_;o=S/6,s=S%6*10+T,i=a-(S*E+T*_),u=i/r,l=i%r}else l=a%r,i=a/r,u=i%60,i/=60,s=i%60,o=i/60;p&&r>g?(c=Boolean(l%2),l/=2):c=!1},getFrame:function(e){var t=e.intFps(),n=60*o+s,r=l;p&&t>g&&(r=2*l+(c?1:0));var a=(60*n+u)*t+r;if(d&&!e.supportDFTimecode&&f.warn("this fps does not support dropframe",e.realFps),!d||!e.supportDFTimecode)return a;0!=u||0!=l&&1!=l||s%10==0||(a+=2);var i=(n-Math.floor(n/10))*parseInt(t/30)*2;return a-i}}}}),n("timecode/NormalPlayTime",["util/StringUtil","timecode/Fps","timecode/SmpteTimecode"],function(e,t,n){return function(){var r,a=0;return{set:function(e,n){a=e,r=t(n)},setFps:function(e){r=e},getFps:function(){return r},setFromSecond:function(e){a=e},getSecond:function(){return a},getRoundedMillisecond:function(){return Math.floor(1e3*a+.1)},offsetSecond:function(e){a+=e},setFromFrame:function(e){a=e/r.realFps()},getFrame:function(){return a*r.realFps()},getFrameIntDisplay:function(){return(a+1e-4)*r.realFps()},offsetFrame:function(e){a+=e*this.getOneFrameTime()},getOneFrameTime:function(){return 1/r.realFps()},setFromTimecode:function(e){var t=new n(!1);t.setFromTimecode(e);var a=t.getFrame(r);this.setFromFrame(a)},getSmpteTimecode:function(e){var t=new n(!1);return t.setFromFrame(getFrame(),r,e),t},getTimecode:function(e){return e=defaultValue(e,!0),getSmpteTimecode(e).getTimecode()},setFromNpt:function(e){var t=0;t+=3600*parseFloat(e.slice(0,2)),t+=60*parseFloat(e.slice(3,5)),t+=parseFloat(e.slice(6,8)),t+=parseFloat("0."+e.slice(9)),this.setFromSecond(t)},getNpt:function(){var e=this.getSecond(),t=Math.floor(e),n=1e3*(e-t),r=t%60,a=t/60,i=a%60,o=a/60;return pad(o)+":"+pad(i)+":"+pad(r)+"."+int(n)},pad:function(t){return e.padDigit(t)}}}}),n("play/PlaybackFrames",["util/JavascriptUtil","util/NumberUtil","play/EPlayback","play/PlaybackFramesImage","play/PlaybackFramesImages","play/PlaybackFramesSound","play/PlaybackFramesOptions","play/PlaybackStatistics","play/PlaybackFramesLatencyParameters","play/PlaybackFramesDynamicBuffer","net/Message","log/Log","util/StringUtil","event/Dispatcher","data/AudioStates","timecode/NormalPlayTime","timecode/Fps","event/Event","net/SOCKET_EVENTS","util/DOMUtil","appbase/ConfigManager"],function(e,t,n,r,a,i,o,s,u,l,c,d,f,m,g,p,E,_,S,h,T){return function(v){function A(){yt=!0,y()}function I(){yt=!1}function y(e){yt&&(window.requestAnimationFrame(y),b())}function b(){var e,t,n=ve.getFrameAt(Ae.position);if(n){if(e=n.realFrame/he.timelineRaster.fps,pt>-1&&e>pt)return Ye.info("In uncaptured section!  Stop and wait.  Position: "+e+" Length: "+pt),R(),Ae.clearBuffer(),ve.clearBuffer(),kt.clear(),void(Fe=!0);O(n)&&Ze&&(t=Date.now(),De++,t-Le>1e3&&(Ce.fpsCurrent=De/(t-Le)*1e3,Le=t,De=0),Ce.framesDrawn++)}}function O(t,n,r){return n=e.defaultValue(n,null),r=e.defaultValue(n,!1),n?(qe.visible=!0,qe.text=n,!0):(qe.visible=!1,!!t&&(Re=r?videoDuration:t.realFrame,!(!t.image||t===Pe)&&(Pe=t,He.src=Pe.image.src,ee(),we&&(Ve=we.selectedAngle),_e(),!0)))}function k(){Pe=null,_e(),He.src=""}function C(){$e=!0,at=-1,0===be.speed&&(this.playSpeed=1,T.autoStartVarispeed)||(ve.hasFrame(At)?(Ye.info("resume from frame "+At+" (buffer has up to frame "+ve.getLastRealFrameNum()+")"),Oe=!0,Ke.dispatcher.addListener(c.MESSAGES.GET_PLAYING_IMAGE,V),Ke.dispatcher.addListener(c.MESSAGES.GET_PLAYING_AUDIO,G),Ke.sendMsg(c.createResumeTimelineMessage(Te.name),L)?je.raiseEvent(_(n.EVENTS.PLAY_INITIATED)):Q("resume","Couldn't resume.",n.EVENTS.PLAY_FAILED)):(Ye.info("playing from frame "+At+" (clear buffer)"),Oe=!1,ve.clearBuffer(),Ae.clearBuffer(),kt.clear(),Ce.reset(),Ke.dispatcher.addListener(c.MESSAGES.GET_PLAYING_IMAGE,V),Ke.dispatcher.addListener(c.MESSAGES.GET_PLAYING_AUDIO,G),be.frame=At,Ke.sendMsg(c.createPlayTimelineMessage(null,Te.name,be),D)?je.raiseEvent(_(n.EVENTS.PLAY_INITIATED)):Q("resume","Couldn't play.",n.EVENTS.PLAY_FAILED)))}function L(e){Ze=!0,e.isOK()?te():Q("resume","Couldn't resume: "+e.getStatusErrorString(),n.EVENTS.PLAY_FAILED),$e||R()}function D(e){Ke.dispatcher.removeListener(c.MESSAGES.PLAY_TIMELINE,D),Ze=!0,e.isOK()?(Ne=parseInt(e.message.xmd_message_id,10),te(),ut&&(ut=!1,B())):Q("resume","Couldn't play: "+e.getStatusErrorString(),n.EVENTS.PLAY_FAILED),$e||R()}function M(){return Ye.info("Starting..."),mt?(Ye.info("Buffer done."),R(),je.raiseEvent(_(n.EVENTS.PREBUFFERING_READY,null)),void(mt=!1)):(ze=!1,Ye.info("Play!"),Ze=!0,je.raiseEvent(_(n.EVENTS.PLAY_START)),je.raiseEvent(_(n.EVENTS.PLAY_SPEED_CHANGE,{speed:be.speed/100})),A(),De=0,Le=Date.now(),Ce.lastStarted=Le,Me=!1,Oe?(Ye.info("Play: resuming sound (size:"+Ae.bufferSize+")"),Ae.resume()):(Ye.info("Play: restarting sound"),Ae.play()),void J())}function R(){$e=!1,(Ze||ie())&&(Ye.info("pausing at frame "+Re+" - First frame in buffer: "+ve.getFirstRealFrameNum()),F(),Ke.sendMsg(c.createPauseTimelineMessage(Te.name),P)||(Q("pause","Couldn't send pause message."),Ke.dispatcher.removeListener(c.MESSAGES.GET_PLAYING_IMAGE,V),Ke.dispatcher.removeListener(c.MESSAGES.GET_PLAYING_AUDIO,G)))}function P(e){Ke.dispatcher.removeListener(c.MESSAGES.GET_PLAYING_IMAGE,V),
Ke.dispatcher.removeListener(c.MESSAGES.GET_PLAYING_AUDIO,G),e.isOK()||Q("pause","Server couldn't pause."),100!=be.speed&&T.speedReset&&(be.speed=100,B()),$e&&C()}function N(){R()}function F(){Ze=!1,Ye.info("Stop!"),I(),ne(),Ae.stop(),Ce.timePlayed+=Date.now()-Ce.lastStarted,Ce.lastStarted=0,je.raiseEvent(_(n.EVENTS.PLAY_PAUSE,null)),je.raiseEvent(_(n.EVENTS.PLAY_SPEED_CHANGE,{speed:0})),Me=!1,Fe=!1,H(Re)}function U(t,r,a,i){if(a=e.defaultValue(a,!1),i=e.defaultValue(i,!1),be.last=-1,je.raiseEvent(_(n.EVENTS.SEEK_START,{frame:t})),R(),Se)if(at===-1)if(at=t,it=r,H(t)){var o=t/he.timelineRaster.fps*be.audioSampleRate;ot=a,Ye.info("Seeking:",t,r),be.frame=At,ot?Ke.sendMsg(c.createTimelineImageAudioSampleMessage(Te.name,be,o,be.audioSampleRate/10,i),K)||(Q("seek","Couldn't get image.",n.EVENTS.SEEK_FAILED,{frame:t}),at=-1):Ke.sendMsg(c.createTimelineImageMessage(Te.name,be,i),j)||(Q("seek","Couldn't get image.",n.EVENTS.SEEK_FAILED,{frame:t}),at=-1)}else Q("seek","Out of range: "+t,n.EVENTS.SEEK_FAILED,{frame:t}),at=-1;else{var s=Pe?Pe.bitmap:null;(t!==at||r!==it||we&&Pe.layout!=we.layout||we&&Pe.bank!=we.bank||we&&Ve!=we.selectedAngle||s&&s.width!=be.width||s&&s.height!=be.height)&&(et=t,tt=a,nt=r,rt=i)}}function w(t,n,r,a){n=e.defaultValue(n,!1),r=e.defaultValue(r,!1),a=e.defaultValue(a,!1),U(t,be.compressionQuality,n,a)}function B(){Ze?st?ut=!0:(st=!0,be.frame=-1,Ye.info("updating options: "+be.width+"x"+be.height+" speed:"+be.speed/10),Ke.sendMsg(c.createSetPlayingOptionMessage(Te.name,be),function(e){st=!1,e.isOK()||Q("updatePlaybackOptions","Couldn't update."),ut&&(ut=!1,B())})||Q("updatePlaybackOptions","Couldn't send.")):(ve&&ve.clearBuffer(),Ae&&Ae.clearBuffer(),kt.clear(),ut=!0)}function x(){var e=Date.now();if(!dt&&!ve.hasFullBuffer()&&e-ft>ct){var t=Ae.getBufferTime(),n=kt.target;if(t<T.playbackLatencyLow||t>n){var r=Math.round((n-t)*be.rasterFps);r&&(ft=e,Ye.info("Adjusting "+r+"frames."),Ke.sendMsg(c.createAdjustPlayingMessage(Te.name,r),function(e){e.isError()?(Q("checkWaterLevel","Couldn't adjust: "+e.getStatusErrorString()),F()):dt=!1})?dt=!0:Q("checkWaterLevel","Couldn't send."))}}}function V(e){var t=e.params;if(parseInt(t.message.xmd_message_id,10)===Ne){if(t.isError())Q("onImage","Couldn't get image from server: "+t.getStatusMessageDetails()),R(),ve.clearBuffer(),kt.clear();else{if("true"===t.message.get_playing_image_re.is_finished){Ye.info("Playback finished.");var r=ve.getLastFrameInBuffer();return void(r&&(r.isLastFrame=!0))}if(ve.getBufferLength()&&(Ce.framesAdjusted+=Math.abs(parseInt(t.message.get_playing_image_re.frame,10)-gt-1)),gt=parseInt(t.message.get_playing_image_re.frame,10),t.data&&Z(t.data.length),ve.addImage(parseInt(t.message.get_playing_image_re.raster_frame,10),parseInt(t.message.get_playing_image_re.frame,10),parseInt(t.message.get_playing_image_re.duration,10),t.data,t.message.get_playing_image_re.group_layout,parseInt(t.message.get_playing_image_re.group_bank,10)),vt){var a=ve.getFrameFirst();a&&(ye&&(ye.dispatcher.removeListener(bt.IMAGE_LOADED,Y),ye.unload()),ye=a,ye.dispatcher.addListener(bt.IMAGE_LOADED,Y),ot=!1,vt=!1)}}mt&&je.raiseEvent(_(n.EVENTS.PREBUFFERING_PROGRESS,{progress:ve.getBufferTime()/Xe.getTargetWaterLevel()})),x()}}function G(e){var t=e.params;if(parseInt(t.message.xmd_message_id,10)===Ne){var n=1e3*parseInt(t.message.get_playing_audio_re.time_out,10),r=1e3*parseInt(t.message.get_playing_audio_re.time_in,10);kt.adjust(n-r);var a=!1;t.message.get_playing_audio_re.is_finished&&(a=f.parseBoolean(t.message.get_playing_audio_re.is_finished)),a&&Ye.info("Last sound chunk received."),t.data?($(t.data.length),Ae.appendBuffer(t.data,a,be.isAudioCompressed)):Ae.appendZeroBuffer(parseInt(t.message.get_playing_audio_re.out_frame,10)-parseInt(t.message.get_playing_audio_re.in_frame,10),a)}}function K(e){if(Ze){Ye.info("dumping redundant seek");var t=-1;return e.isError()||(t=parseInt(e.message.get_timeline_image_audio_re.frame,10)),Re=t,je.raiseEvent(_(n.EVENTS.SEEK_FAILED,{frame:t})),void(at=-1)}if(Ce.seekTime=e.transitTime(),e.isError())Q("onImageAudioSeek","Couldn't get image from server: "+e.getStatusMessageDetails(),n.EVENTS.SEEK_FAILED,{frame:at});else{if(!e.hasData())return void je.raiseEvent(_(n.EVENTS.SEEK_FINISHED,{frame:parseInt(e.message.get_timeline_image_audio_re.frame,10)}));var a=parseInt(e.message.get_timeline_image_audio_re.imageBytesSize,10),i=e.data.slice(0,a);Z(a),ye&&(ye.dispatcher.removeListener(bt.IMAGE_LOADED,Y),ye.unload()),ye=new r,ye.dispatcher.addListener(bt.IMAGE_LOADED,Y),ye.load(parseInt(e.message.get_timeline_image_audio_re.raster_frame,10),parseInt(e.message.get_timeline_image_audio_re.frame,10),parseInt(e.message.get_timeline_image_audio_re.duration,10),i,e.message.get_timeline_image_audio_re.group_layout,parseInt(e.message.get_timeline_image_audio_re.group_bank,10));var o=e.data.slice(a);$(o.length),Ie.clearBuffer(),Ie.appendBuffer(o,!0,"MP3"===String(e.message.get_timeline_image_audio_re.format).toUpperCase())}}function j(e){if(Ze){Ye.info("dumping redundant seek");var t=-1;return e.isError()||(t=parseInt(e.message.get_timeline_image_re.frame,10)),Re=t,je.raiseEvent(_(n.EVENTS.SEEK_FAILED,{frame:t})),void(at=-1)}if(Ce.seekTime=e.transitTime(),e.isError())Q("onImageSeek","Couldn't get image from server: "+e.getStatusMessageDetails(),n.EVENTS.SEEK_FAILED,{frame:at});else{if(!e.hasData())return void je.raiseEvent(_(n.EVENTS.SEEK_FINISHED,{frame:parseInt(e.message.get_timeline_image_re.frame,10)}));var a=e.data;Z(a.length),ye&&(ye.dispatcher.removeListener(bt.IMAGE_LOADED,Y),ye.unload()),ye=new r,ye.dispatcher.addListener(bt.IMAGE_LOADED,Y),ye.load(parseInt(e.message.get_timeline_image_re.raster_frame,10),parseInt(e.message.get_timeline_image_re.frame,10),parseInt(e.message.get_timeline_image_re.duration,10),a,e.message.get_timeline_image_re.group_layout,parseInt(e.message.get_timeline_image_re.group_bank,10))}}function Y(e){ye.dispatcher.removeListener(bt.IMAGE_LOADED,Y),ot?Ie.isBufferFull()&&X():X()}function X(){O(ye),ot&&Ie.playSingle(),je.raiseEvent(_(n.EVENTS.SEEK_FINISHED)),at=-1,et>-1&&(U(et,nt,tt,rt),et=-1)}function H(e){return!(e>=he.duration||e<0)&&(At=e,!0)}function W(e){Pe.isLastFrame?(Ye.info("Reached last frame ("+Pe.realFrame+") - stopping."),Ke.dispatcher.removeListener(c.MESSAGES.GET_PLAYING_IMAGE,V),Ke.dispatcher.removeListener(c.MESSAGES.GET_PLAYING_AUDIO,G),F(),ve.clearBuffer(),Ae.clearBuffer(),kt.clear(),Oe=!1,w(Pe.realFrame,!1,!0)):(Ye.info("No more sound in audio buffer... rebuffering."),b(),F(),Oe=!0,te())}function q(e){F(),ve.clearBuffer(),kt.clear(),It=!1}function Q(t,n,r){r=e.defaultValue(r,null),Ye.error(r,"PlaybackFrames."+t,n),r&&je.raiseEvent(_(r,"PlaybackFrames."+t+": "+n))}function J(){Ue=Date.now(),ht=0,St=0}function z(){var e=Date.now(),t=e-Ue;Ce.rateVideo=ht/t*1e3,ht=0,Ce.rateAudio=St/t*1e3,St=0,Ue=e}function Z(e){ht+=e}function $(e){St+=e}function ee(){var e=he.getFirstTrackWithSegments().getSegmentAtPos(Re);null!==e&&(we&&we.segment===e.segment||(we=e,je.raiseEvent(_(n.EVENTS.SEGMENT_CHANGE,{segment:e,playback:Lt}))))}function te(){Ae.isBufferFull()&&ve.isBufferFull()?M():(Ye.info("Adding listeners for buffers"),ze||(ze=!0,je.raiseEvent(_(n.EVENTS.PLAY_BUFFERING))),ve.dispatcher.addListener(n.EVENTS.PLAY_START,re),Ae.dispatcher.addListener(n.EVENTS.PLAY_START,ae))}function ne(){ze=!1,ve.dispatcher.removeListener(n.EVENTS.PLAY_START,re),Ae.dispatcher.removeListener(n.EVENTS.PLAY_START,ae)}function re(e){Ye.info("Image buffer full."),ve.dispatcher.removeListener(n.EVENTS.PLAY_START,re),Ae.isBufferFull()&&(Ye.info("Buffer full.  Removing listeners."),Ae.dispatcher.removeListener(n.EVENTS.PLAY_START,ae),M())}function ae(e){Ye.info("Sound buffer full."),Ae.dispatcher.removeListener(n.EVENTS.PLAY_START,ae),ve.isBufferFull()&&(Ye.info("Buffer full.  Removing listeners."),ve.dispatcher.removeListener(n.EVENTS.PLAY_START,re),M())}function ie(){return ve&&ve.dispatcher.hasListener(n.EVENTS.PLAY_START)||Ae&&Ae.dispatcher.hasListener(n.EVENTS.PLAY_START)}function oe(e){switch(e.params.key){case"deck.playback_frames.video.domain":be.dominance=e.params.value,B(),w(Re,!1,!0);break;case"deck.playback_frames.video.layer":be.layer=e.params.value,B(),w(Re,!1,!0);break;case"deck.playback_frames.video.field_based_render":be.isFieldBasedRender=f.parseBoolean(e.params.value),B(),w(Re,!1,!0);break;case"deck.playback_frames.video.use_cache":be.useCache=f.parseBoolean(e.params.value),B(),w(Re,!1,!0);break;case"deck.playback_frames.video.quality":be.compressionQuality=e.params.value,Ce.currentQuality=be.compressionQuality,B(),Ze||w(Re,!1,!0);break;case"deck.playback_frames.video.proxy_width":case"deck.playback_frames.video.dynamic_proxy_width":case"deck.playback_frames.video.maximum_width":ce(Se.parent.width,Se.parent.height);break;case"deck.playback_frames.latency":ve.setBufferTime(Xe.getTargetWaterLevel()),Ce.videoBufferTarget=Xe.getTargetWaterLevel(),Ce.audioBufferTarget=Xe.getTargetWaterLevel();break;case"deck.playback_frames.audio.rate":be.audioSampleRate=e.params.value,ve.clearBuffer(),kt.clear(),Ae.resetAudioOptions(),Ie.resetAudioOptions(),w(Re,!1,!0);break;case"deck.playback_frames.audio.bits":be.audioBitPerSample=e.params.value,ve.clearBuffer(),kt.clear(),Ae.resetAudioOptions(),Ie.resetAudioOptions(),w(Re,!1,!0);break;case"deck.ui.safe_area.action":Qe.style.display=f.parseBoolean(e.params.value)?"block":"none";break;case"deck.ui.safe_area.title":Je.style.display=f.parseBoolean(e.params.value)?"block":"none";break;case"deck.ui.safe_area.color":Je.style.borderColor="#"+e.params.value,Qe.style.borderColor="#"+e.params.value}}function se(){Ke.dispatcher.addListener(c.MESSAGES.RSS_NOTIFY,le),Ke.sendMsg(c.createRssSubscribeMessage(Te.name,"RSS_ASSET_UPDATED",{url:Te.url,url_type:Te.type}))||(Q("openTimeline","Couldn't subscribe to RSS feed."),Ke.dispatcher.removeListener(c.MESSAGES.RSS_NOTIFY,le))}function ue(){Ke&&he&&(Ke.dispatcher.removeListener(c.MESSAGES.RSS_NOTIFY,le),Ke.sendMsg(c.createRssUnsubscribeMessage(Te.name))||Q("openTimeline","Couldn't unsubscribe from RSS feed."),pt=-1,Fe=!1)}function le(e){var t=Rss.parseRSSNotifyMessage(e.params);if(t.rss_params.url===Te.url){Te.assetInfo.duration=e.params.message.rss_notify_re.details.clip_item.media_info.properties.length,Te.assetInfo.videoReceivedDuration=e.params.message.rss_notify_re.details.clip_item.media_info.properties.video_frame_received,Te.assetInfo.audioDuration=e.params.message.rss_notify_re.details.clip_item.media_info.properties.audio_length,Te.assetInfo.audioReceivedDuration=e.params.message.rss_notify_re.details.clip_item.media_info.properties.audio_frame_received;var r=t.rss_params.metadata,a=-1,i=-1,o=!1;r.video_duration_received>-1&&(a=r.video_duration_received/r.video_fps),r.audio_duration_received>-1&&(i=r.audio_duration_received/r.audio_sample_rate),o=a===-1&&i===-1,o?(Ye.info("Capture done.  Duration: "+r.video_duration),pt=r.video_duration/r.video_fps):a>-1&&i>-1?pt=Math.min(a,i):a>-1?pt=a:i>-1&&(pt=i),Fe&&Ae.position/1e3+Et<pt&&(C(),Fe=!1);var s=pt*he.timelineRaster.fps+.001+1,u=he.duration;je.raiseEvent(_(n.EVENTS.EWC_UPDATE_TIMELINE_LENGTH,{timeline:timeline,name:Te.name,srcLength:s})),o&&ue(),u!==s&&B()}}function ce(e,t){var n=fe()/me(),r=e/t;xe=t,Be=e;var a=Math.floor((He.parentElement.clientWidth-Be)/2),i=Math.floor((He.parentElement.clientHeight-xe)/2);if(He.width=Be,He.height=xe,He.style.marginTop=i+"px",He.style.marginLeft=a+"px",We.width=Be,We.height=xe,We.style.marginTop=i+"px",We.style.marginLeft=a+"px",qe.style.width=Be,qe.style.height=xe,qe.style.marginTop=i+"px",qe.style.marginLeft=a+"px",de(Qe,i,a,Be,xe,.05),de(Je,i,a,Be,xe,.1),T.getConfig("deck.playback_frames.video.dynamic_proxy_width")){var n=he.timelineRaster.width/he.timelineRaster.height,r=e/t,o=Be,s=xe;r>n?(s=t,o=t*n):(s=e/n,o=e),o>he.timelineRaster.width&&(o=he.timelineRaster.width,s=he.timelineRaster.height),o>T.getConfig("deck.playback_frames.video.maximum_width")&&(o=T.getConfig("deck.playback_frames.video.maximum_width"),s=o/n),o=Math.round(o),s=Math.round(s),be.width!==o&&(be.width=o,be.height=s,B(),It&&!Ze&&w(Re,!1,!0))}else be.width=T.getConfig("deck.playback_frames.video.proxy_width"),be.height=Math.floor(T.getConfig("deck.playback_frames.video.proxy_width")/he.timelineRaster.width*he.timelineRaster.height),B(),It&&!Ze&&w(Re,!1,!0);Ce.currentProxyWidth=be.width,Ce.currentProxyHeight=be.height,_e()}function de(e,t,n,r,a,i){e.style.width=r-i*r*2+"px",e.style.height=a-i*a*2+"px",e.style.marginTop=t+i*a+"px",e.style.marginLeft=n+i*r+"px"}function fe(){return he.timelineRaster.width}function me(){return he.timelineRaster.getAdjustedHeight()}function ge(e){if(Ot&&(!Pe||null!=Pe.layout)){var t=Ee(e.offsetX,e.offsetY);t&&je.raiseEvent(_(n.EVENTS.MULTICAM_SELECT,{mobID:t}))}}function pe(e){if(Ot)if(Pe.layout){var t=Ee(e.offsetX,e.offsetY);t&&je.raiseEvent(_(n.EVENTS.MULTICAM_ZOOM_IN,{mobID:t}))}else je.raiseEvent(_(n.EVENTS.MULTICAM_ZOOM_OUT))}function Ee(e,t){if(Pe.layout){var n,r;switch(Pe.layout){case"3x3":return n=Be/3,r=xe/3,we.getAngleID(Math.floor(e/n)+3*Math.floor(t/r)+9*Pe.bank);case"2x2":return n=Be/2,r=xe/2,we.getAngleID(Math.floor(e/n)+2*Math.floor(t/r)+4*Pe.bank)}}return null}function _e(){var e=We.getContext("2d");if(e.clearRect(0,0,Be,xe),Pe&&Pe.layout&&we){var t,n,r,a,i=we.getAngleIndex(we.selectedAngle);switch(Pe.layout){case"3x3":if(Math.floor(i/9)!=Pe.bank)return;i%=9,r=Be/3,a=xe/3,t=i%3*r,n=Math.floor(i/3)%3*a;break;case"2x2":if(Math.floor(i/4)!=Pe.bank)return;i%=4,r=Be/2,a=xe/2,t=i%2*r,n=Math.floor(i/2)%2*a;break;default:return void Ye.error("Layout not supported: "+Pe.layout)}switch(T.selectStyle){case"box":e.lineWidth=T.selectLineWidth,e.strokeStyle=T.selectColor,e.strokeRect(t,n,r,a)}}}var Se,he,Te,ve,Ae,Ie,ye,be,Oe,ke,Ce,Le,De,Me,Re,Pe,Ne,Fe,Ue,we,Be,xe,Ve,Ge,Ke=v.socket(),je=m(),Ye=d.getLogLine("PlaybackFrames"),Xe=u(),He=document.createElement("img"),We=document.createElement("canvas"),qe=document.createElement("div"),Qe=document.createElement("div"),Je=document.createElement("div"),ze=!1,Ze=!1,$e=!1,et=-1,tt=!1,nt=80,rt=!1,at=-1,it=-1,ot=!1,st=!1,ut=!1,lt=g(),ct=1e3,dt=!1,ft=0,mt=!1,gt=0,pt=-1,Et=2,_t=null,St=0,ht=0,Tt=500,vt=!1,At=-1,It=!1,yt=!1,bt=(new r).EVENTS,Ot=!1,kt=l();be=o(),be.compressionQuality=parseInt(T.getConfig("deck.playback_frames.video.quality"),10),be.frame=-1,be.dominance=T.getConfig("deck.playback_frames.video.domain"),be.layer=T.getConfig("deck.playback_frames.video.layer"),be.useCache=f.parseBoolean(T.getConfig("deck.playback_frames.video.use_cache")),be.isFieldBasedRender=f.parseBoolean(T.getConfig("deck.playback_frames.video.field_based_render")),be.audioBitPerSample=parseInt(T.getConfig("deck.playback_frames.audio.bits"),10),be.audioSampleRate=parseInt(T.getConfig("deck.playback_frames.audio.rate"),10);var Ct=T.getConfig("deck.playback_frames.audio.format");switch(Ct.toLocaleLowerCase()){case"pcm":be.isAudioCompressed=!1;break;case"mp3":be.isAudioCompressed=!0;break;default:Ye.warn("Audio format not supported: "+Ct),be.isAudioCompressed=!1}Me=!1,Fe=!1,Ce=s(),Ce.currentQuality=be.compressionQuality,ke=p(),T.dispatcher.addListener(T.EVENTS.CHANGED,oe),He.style.display="block",He.style.margin="auto",He.style.position="absolute",We.style.display="block",We.style.margin="auto",We.style.position="absolute",We.addEventListener("click",ge),We.addEventListener("dblclick",pe),qe.style.display="block",qe.style.margin="auto",qe.style.position="absolute",Qe.style.display="block",Qe.style.position="absolute",Qe.style.borderWidth="1px",Qe.style.borderStyle="solid",Qe.style.borderColor="#"+T.getConfig("deck.ui.safe_area.color"),Qe.style.display=f.parseBoolean(T.getConfig("deck.ui.safe_area.action"))?"block":"none",Je.style.display="block",Je.style.position="absolute",Je.style.borderWidth="1px",Je.style.borderStyle="solid",Je.style.borderColor="#"+T.getConfig("deck.ui.safe_area.color"),Je.style.display=f.parseBoolean(T.getConfig("deck.ui.safe_area.title"))?"block":"none";var Lt={dispatcher:je,close:function(){Ye.info("Closing stream..."),Ze&&R(),It=!1,ue(),I(),T.dispatcher.removeListener(T.EVENTS.CHANGED,oe),k()},get mode(){return n.MODES.FRAME},setLoaddata:function(e){this.isPlaying()&&N(),ue(),Ye.info("Set load"),he=e.timeline;var t=E(he.timelineRaster.fps);Ge=t.rationalFps,Te=e},open:function(){Ye.info("Open"),Ke.dispatcher.addListener(S.DISCONNECTED,q),It=!0,k(),ke.setFps(E(this.fps)),be.rasterWidth=this.width,be.rasterHeight=this.height,be.rasterFps=this.fps,be.speed=0,T.getConfig("deck.playback_frames.video.dynamic_proxy_width")||(be.width=T.getConfig("deck.playback_frames.video.proxy_width"),be.height=Math.floor(T.getConfig("deck.playback_frames.video.proxy_width")/this.videoWidth*this.videoHeight)),Te.assetInfo.getMetadataObject().video_duration_received>-1&&(Ye.info("Playing growing file - subscribe to RSS notify"),se()),Ce.raster=he.raster,lt.reset(),ve=a(Xe.getTargetWaterLevel(),Ce),Ce.videoBufferTarget=Xe.getTargetWaterLevel(),Ce.audioBufferTarget=Xe.getTargetWaterLevel(),Ae&&(Ae.dispatcher.removeListener(Ae.EVENTS.SOUND_COMPLETE,W),je.unredispatch(Ae.dispatcher,n.EVENTS.AUDIO_MIXER_LEVEL)),Ie&&je.unredispatch(Ie.dispatcher,n.EVENTS.AUDIO_MIXER_LEVEL),Ae=i(v,be,Xe.getTargetWaterLevel()),Ie=i(v,be,Xe.getTargetWaterLevel()),Ae.dispatcher.addListener(Ae.EVENTS.SOUND_COMPLETE,W),je.redispatch(Ae.dispatcher,n.EVENTS.AUDIO_MIXER_LEVEL),je.redispatch(Ie.dispatcher,n.EVENTS.AUDIO_MIXER_LEVEL),at=-1,et=-1,_canChangePlaybackOptions=!1,Re=he.head<0?0:he.head>=he.duration?he.duration-1:he.head,w(Re,!1,!0,!0)},play:function(e,n){e=t.toNumber(e,-1),n=t.toNumber(n,-1),Ye.info("Play called from frame "+e+" to frame "+n),e===-1&&at>-1?et>-1?(H(et),et=-1):(H(at),at=-1):H(e>-1?e:Re),be.last=n,vt=!0,this.resume()},resume:C,pause:R,stop:N,isPlaying:function(){return Ze},buffer:function(){Ye.info("Buffering..."),mt=!0,this.resume()},set playSpeed(e){var t=parseInt(100*e,10);t!==be.speed&&(be.speed=t,je.raiseEvent(_(n.EVENTS.PLAY_SPEED_CHANGE,{speed:e})),Ye.info("Speed set to "+be.speed),B()),T.autoStartVarispeed&&(Ze||0===t?0===t&&(H(Re),R()):C())},get playSpeed(){return be.speed/100},seek:U,seekQuality:w,get currentFrame(){return Re},attachToDisplay:function(e){Se=e,Se.appendChild(He),Se.appendChild(We),Se.appendChild(qe),Se.appendChild(Je),Se.appendChild(Qe),we=null,null==_t&&(_t=setInterval(z,Tt))},detachDisplay:function(){Se&&h.removeAllChildren(Se),Se=null,clearInterval(_t),_t=null},getBufferRange:function(){return null},get duration(){return he.duration},setAudioVolume:function(e,t){if(e<0)return Ae.setVolume(t),void Ie.setVolume(t)},getAudioVolume:function(e){return e<0?Ae.getVolume():he.getNthAudioTrack(e).data.audioVolume},setAudioPan:function(e,t){if(e<0)return Ae.setAudioPan(t),void Ie.setAudioPan(t)},getAudioPan:function(e){return e<0?Ae.getPan():he.getNthAudioTrack(e).data.audioPan},setAudioMute:function(e,t){if(e<0)return Ae.setMute(t),void Ie.setMute(t)},getAudioMute:function(e){return e<0?Ae.getMute():he.getNthAudioTrack(e).muted},setAudioSolo:function(e,t){if(e<0)return Ae.setSolo(t),void Ie.setSolo(t)},getAudioSolo:function(e){return e<0?Ae.getSolo():he.getNthAudioTrack(e).solo},currentFrameBitmap:function(){return Pe.data},get timeline(){return he},get name(){return Te.name},get width(){return fe()},get height(){return me()},get fps(){return he.timelineRaster.fps},statistics:function(){return Ce.videoBufferCurrent=ve.getBufferTime(),Ce.audioBufferCurrent=Ae.getBufferTime(),Ce.bufferTarget=kt.target,Ce},setSize:ce,get loadData(){return Te},flush:function(){ve.clearBuffer(),kt.clear()},set captions(e){Te.captions=e},get captions(){return Te?Te.captions:null},isConnected:function(){return It},timelineModified:function(){},get playbackFramesOptions(){return be},drawMulticamOverlay:_e,enableMulticamClicks:function(e){Ot=e},areMulticamClicksEnabled:function(){return Ot}};return Lt}}),n("timeline/TimecodeTrack",["timecode/NormalPlayTime","timecode/Fps","util/XMLUtil","util/JavascriptUtil"],function(e,t,n,r){return function(){function a(e,t){s=e,u=t}function i(e){if(null===s||0===s.length||null===u||0===u.length)return e;var t=AlgoUtil.binarySearch(s,function(t){return t-e});return t===-1?e:e-s[t]+u[t]}function o(e){if(null===s||0===s.length||null===u||0===u.length)return e;var t=AlgoUtil.binarySearch(u,function(t){return t-e});return t===-1?e:e-u[t]+s[t]}var s,u,l,c=0,d=e();return{set:function(e,t,n){if(c=e,d.set(0,t),d.setFromTimecode(n),0===d.getFrame())a(null,null);else{var r=[],i=[];r.push(0),i.push(d.getSecond()),a(r,i)}},setDuration:function(e){c=e},setTimecodeTrackFps:function(e,n){var r=t(e);l=n,d.setFps(r)},dropFrameFormat:function(){return l},setTimecodeTrack:function(e){if(""===e)return a(null,null);var t,i,o,s=n.XMLToObject(n.StringToXML(e)),u=r.forceArray(s.Leap),l=u.length,c=[],d=[];if(0===l)a(null,null);else{for(t=0;t<l;t++)i=parseFloat(u[t].offs)/1e3,o=parseFloat(u[t].tc)/1e3,c.push(i),d.push(o);a(c,d)}},getTimecode:function(e){return d.setFromSecond(i(e)),d.getTimecode(l)},getTimecodeFromFrame:function(e){return d.setFromFrame(e),this.getTimecode(d.getSecond())},getAbsoluteFrameFromTimecode:function(e){return d.setFromTimecode(e),d.setFromSecond(o(d.getSecond())),Math.round(d.getFrame())},getStartTimecode:function(){return this.getTimecode(0)},getEndTimecode:function(){return this.getTimecode(c)},getDuration:function(){return c},getDurationTimecode:function(){return this.getInOutDurationTimecode(0,c)},getInOutDurationTimecode:function(e,t){return d.setFromSecond(t-e),d.getTimecode()},fps:function(){return d.getFps()}}}}),n("asset/AssetPathUrl",[],function(){return function(e){var t,n,r,a;t=e;var i=t.indexOf("://");if(i===-1)n="morpheus",r="server",a=t;else{var o=t.indexOf("/",i+3);n=t.substr(0,i),r=t.substr(i+3,o-i-3),a=t.substr(o,t.length-o)}return{getPath:function(){return encodeURI(a)},isMorpheusProtocol:function(){return"morpheus"===n}}}}),n("timeline/TimelineSegment",["util/StringUtil","util/JavascriptUtil","timeline/TimecodeTrack","log/Log","asset/AssetPathUrl"],function(e,t,n,r,a){return function i(o,s,u){function l(e){o=e,d()}function c(){l({name:null,description:null,tag:null,protocol:"file",selected:!0,path:null,format:null,groupId:null,totalLength:0,depth:0,components:0,width:-1,height:-1,ratio:0,lutFile:null,lut3dFile:null,opacity:100,embeddedText:null,speed:1,position:{trackIn:0,trackOut:0,in:0,out:0,handles:0,head:0,tail:0},surface:{layer:"NONE",domain:"FRAME"},burn:{x:0,y:0,type:"NONE"},axis:{x:0,y:0,scaleX:1,scaleY:1,ratio:1,useRatio:!0,scaleType:"NONE",scaleQuality:"QUALITY"},crop:{left:0,right:0,top:0,bottom:0,softness:0},store:{base:0,adjustment:0},vtr:{tape:null,df:!1,in:"00:00:00:00",out:"00:00:00:00"},mob:{id:null,slotId:0,start:null,length:null,fileMobId:null,tapeMobId:null},videoGenerator:{type:"NONE",color:0,softness:3,percent:75},transition:{type:"NONE",pattern:"NONE",softness:0,reverseDirection:0,animation:"LINEAR",beforeOut:0,afterOut:0,selected:!1},border:{type:"NONE",thickness:1,color:0,opacity:100,softness:0,cornerType:"SQUARE"},shadow:{dx:0,dy:0,color:0,opacity:100,softness:0},timecodeLeap:{fps:null,dropTimecode:null,leaps:null}})}function d(){o&&!e.isEmpty(o.timecodeLeap)&&parseFloat(o.timecodeLeap.fps)>0&&(m=n(),m.setTimecodeTrackFps(o.timecodeLeap.fps,o.timecodeLeap.dropTimecode),m.setTimecodeTrack(decodeURI(o.timecodeLeap.leaps)),m.showMilliseconds="black"===o.format[0])}function f(){o&&(o.audioGain=parseFloat(o.audioGain),o.opacity=parseFloat(o.opacity),o.position.handles=parseInt(o.position.handles,10),o.position.head=parseInt(o.position.head,10),o.position.in=parseInt(o.position.in,10),o.position.out=parseInt(o.position.out,10),o.position.tail=parseInt(o.position.tail,10),o.position.trackIn=parseInt(o.position.trackIn,10),o.position.trackOut=parseInt(o.position.trackOut,10),o.shadow&&(o.shadow.color=parseInt(o.shadow.color,10),o.shadow.dx=parseFloat(o.shadow.dx),o.shadow.dy=parseFloat(o.shadow.dy),o.shadow.opacity=parseFloat(o.shadow.opacity),o.shadow.softness=parseFloat(o.shadow.softness)))}var m,g=r.getLogLine("TimelineSegment"),p=2048,E={NONE:"NONE",DISSOLVE:"DISSOLVE",WIPE:"WIPE",CROSSFADE:"CROSSFADE"},_={NONE:"NONE",BAR_LEFT_RIGHT:"BAR_LEFT_RIGHT",BAR_TOP_BOTTOM:"BAR_TOP_BOTTOM",BOX_TOP_LEFT:"BOX_TOP_LEFT",BOX_TOP_RIGHT:"BOX_TOP_RIGHT",BOX_BOTTOM_RIGHT:"BOX_BOTTOM_RIGHT",BOX_BOTTOM_LEFT:"BOX_BOTTOM_LEFT",BARN_DOOR_VERTICAL:"BARN_DOOR_VERTICAL",BARN_DOOR_HORIZONTAL:"BARN_DOOR_HORIZONTAL",BOX_TOP_CENTER:"BOX_TOP_CENTER",BOX_RIGHT_CENTER:"BOX_RIGHT_CENTER",BOX_BOTTOM_CENTER:"BOX_BOTTOM_CENTER",BOX_LEFT_CENTER:"BOX_LEFT_CENTER",BOX_CENTER:"BOX_CENTER"};return null===o?c():(f(),l(o)),{ESTIMATED_SEGMENT_STRING_LENGTH:p,TRANSITION_TYPE:E,TRANSITION_PATTERN:_,get data(){return o},get index(){return s},copy:function(){return i(JSON.parse(JSON.stringify(o)),s,u)},getXPath:function(){return"/track["+u+"]/segment["+s+"]"},get path(){return""!==o.path?o.path:""!==o.mob.id?o.mob.id:(g.info("path and modid are empty"),null)},set path(e){o.path=e},get name(){return o.name},set name(e){o.name=e},get selected(){return o.selected},set selected(e){o.selected=e},get trackIn(){return o.position.trackIn},set trackIn(e){o.position.trackIn=e},get trackOut(){return o.position.trackOut},set trackOut(e){o.position.trackOut=e},get trackDuration(){return this.trackOut-this.trackIn},get srcIn(){return o.position.in},set srcIn(e){o.position.in=e},get srcOut(){return o.position.out},set srcOut(e){o.position.out=e},get srcDuration(){return this.srcOut-this.srcIn},includeTrackPos:function(e){return e>=this.trackIn&&e<this.trackOut},beforeTrackPos:function(e){return this.trackOut<=e},afterTrackPos:function(e){return this.trackIn>e},inRange:function(e,t){return this.trackIn>=e&&this.trackOut<=t},includeSrcPos:function(e){return e>=this.srcIn&&e<this.srcOut},toTrackPos:function(e){return 0===this.srcDuration?this.trackIn:this.trackIn+(e-this.srcIn)/this.srcDuration*this.trackDuration},toSrcPos:function(e){return 0===this.trackDuration?this.srcIn:this.srcIn+(e-this.trackIn)/this.trackDuration*this.srcDuration},moveTo:function(e){this.trackOut=e+this.trackDuration,this.trackIn=e},get format(){return o.format},set format(e){o.format=e},get axis(){return o.axis},set axis(e){o.axis=e},get speed(){return o.speed},get isGroupClip(){return o.hasOwnProperty("groupClipMob")},get selectedAngle(){return this.isGroupClip?o.groupClipMob.selected:null},get layout(){return this.isGroupClip?o.groupClipMob.layout:null},get bank(){return this.isGroupClip?o.groupClipMob.bank:-1},get groupClipID(){return this.isGroupClip?o.groupClipMob.id:null},getAngle:function(e){var t,n;for(t=0,n=o.groupClipMob.angles.length;t<n;t++){var r=o.groupClipMob.angles[t];if(r.mob.id===e)return r}return null},getAngleIndex:function(e){var t,n,r=0;for(t=0,n=o.groupClipMob.angles.length;t<n;t++){var a=o.groupClipMob.angles[t];if(a.mob.id==e)return r;r++}return 0},getAngleID:function(e){return e>=o.groupClipMob.angles.length?null:o.groupClipMob.angles[e].mob.id},directVideoSegment:function(e,n,r,i,o,s,u,l,c,d,f,m,g,p,E,_){return g=t.defaultValue(g,-1),p=t.defaultValue(p,-1),E=t.defaultValue(E,0),_=t.defaultValue(_,"LETTER-BOX"),f=t.defaultValue(f,""),m=t.defaultValue(m,""),{name:"",protocol:"file",selected:!0,path:a(e).getPath(),key:e,globalId:f,clientData:{comment:m},format:s,width:g,height:p,opacity:100,speed:u,position:{trackIn:i,trackOut:o,in:n,out:r},axis:{useRatio:!0,ratio:E,scaleType:_,scaleQuality:"QUALITY"},timecodeLeap:{fps:l,dropTimecode:c,leaps:encodeURI(d)}}},directAudioSegment:function(e,n,r,i,o,s,u,l,c){return c=t.defaultValue(c,""),{name:"unknown",protocol:"file",selected:!0,path:a(e).getPath(),key:e,globalId:c,format:s,audioTrack:u,audioChannel:l,position:{trackIn:i,trackOut:o,in:n,out:r,handles:0,head:0,tail:0}}},isRemote:function(){return"remotemedia"==o.format}}}}),n("timeline/TimelineTrack",["timeline/TimelineSegment","log/Log"],function(e,t){return function(n,r){var a=(t.getLogLine("TimelineTrack"),{VIDEO:"VIDEO",AUDIO:"AUDIO"});return null===n&&(n={name:"undefined",description:null,type:"VIDEO",subtype:null,active:!0,selected:!0,view:{muted:!1,scaleY:1}}),{TRACK_TYPE:a,TRACK_AUDIO_PAN_LEFT:-100,TRACK_AUDIO_PAN_RIGHT:100,get data(){return n},get index(){return r},set index(e){r=e},get type(){return n.type},set type(e){n.type=e},isVideoTrack:function(){return n.type===a.VIDEO},isAudioTrack:function(){return n.type===a.AUDIO},getSegment:function(t){return e(n.segments[t],t,r)},getSegmentCount:function(){return n.segments.length},getTrackOut:function(){var e=this.getSegmentCount();return e>0?this.getSegment(e-1).trackOut:0},get selected(){return n.selected},set selected(e){n.selected=e},get muted(){return n.view.muted},set muted(e){n.view.muted=e},get solo(){return n.view.audioSolo},set solo(e){n.view.audioSolo=e},getSegmentAtPos:function(t){var a,i,o,s=n.segments;for(i=0,o=s.length;i<o;i++)if(a=e(s[i],i,r),a.includeTrackPos(t))return a;return null},getSegmentBeforePos:function(t){var a,i,o,s=[],u=n.segments;for(i=0,o=u.length;i<o;i++)a=e(u[i],i,r),a.beforeTrackPos(t)&&s.push(a);return s},getSegmentAfterPos:function(t){var a,i,o,s=[],u=n.segments;for(i=0,o=u.length;i<o;i++)a=e(u[i],i,r),a.afterTrackPos(t)&&s.push(a);return s},getSegmentBetweenPos:function(t,a){var i,o,s,u=[],l=n.segments;for(o=0,s=l.length;o<s;o++)i=e(l[o],o,r),i.inRange(t,a)&&u.push(i);return u},hasVideo:function(){if(this.isAudioTrack())return!1;var t,a,i,o=n.segments;for(a=0,i=o.length;a<i;a++)if(t=e(o[a],a,r),"black"!==t.format)return!0;return!1},directVideoTrack:function(e){return{name:"undefined",description:"",type:"VIDEO",active:!0,selected:!0,segments:e}},directAudioTrack:function(e,t){return{name:"undefined",description:"",type:"AUDIO",active:!0,audioPan:e,audioVolume:0,audioOtherTrackAttenuation:0,audioSolo:!1,audioLink:!1,selected:!0,segments:t}},hasRemoteAssets:function(){for(var e=0,t=this.getSegmentCount();e<t;e++)if(this.getSegment(e).isRemote())return!0;return!1}}}}),n("timeline/TimelineRaster",["util/StringUtil","log/Log"],function(e,t){return function(){function n(e,t,n,c,d,f){a=e,i=t,o=n,s=parseFloat(c),u=d,l=parseFloat(f),r(a)}function r(e){a=e?e:1920==i&&1080==o?"HD":"GN"}var a,i,o,s,u,l,c=t.getLogLine("TimelineRaster"),d={P:"p",IT:"iT",IB:"iB",SF:"sF"};return n("UNKNOWN",0,0,0,d.P,0),{SCAN_TYPE:d,get type(){return a},get width(){return i},get height(){return o},get fps(){return s},get scan(){return u},get ratio(){return l},set:n,setHDRaster:function(e){n("HD",1920,1080,e,d.P,1.7777)},setFromMediaProps:function(t){var r,a=t.scan_type;switch(a){case"progressive":r=d.P;break;case"field1":r=d.IT;break;case"field2":r=d.IB;break;case"segmented":r=d.SF;break;default:r=d.P,c.warn("Unknown scan type, use progressive, returned by clip info for TimelineRaster",a)}var i=e.isEmpty(t.display_width)?t.width:t.display_width,o=e.isEmpty(t.display_height)?t.height:t.display_height;n(t.video_type,parseInt(i,10),parseInt(o,10),t.fps,r,t.ratio)},parseString:function(t){if(e.isEqual(t,"NTSC",!1))return n("NTSC",720,486,29.97,d.IB,4/3),!0;if(e.isEqual(t,"PAL",!1))return n("PAL",720,576,25,d.IT,4/3),!0;var r=/[_@]/,a=t.split(r);if(3!=a.length&&4!=a.length)return c.info("error raster",t),!1;var i=a[1].split(/x/);return 2!=i.length?(c.info("error raster",t),!1):3==a.length?(n(a[0],parseInt(i[0]),parseInt(i[1]),parseFloat(a[2]),this.getScanType(a[2]),parseInt(i[0])/parseInt(i[1])),!0):4==a.length&&(n(a[0],parseInt(i[0]),parseInt(i[1]),parseFloat(a[2]),this.getScanType(a[2]),e.parseRational(a[3],1)),!0)},getScanType:function(t){return e.hasSubStr(t,d.SF,!1)?d.SF:e.hasSubStr(t,d.P,!1)?d.P:e.hasSubStr(t,d.IT,!1)?d.IT:e.hasSubStr(t,d.IB,!1)?d.IB:d.P},getString:function(){return a+"_"+i+"x"+o+"@"+s.toFixed(3)+u+"@"+l.toFixed(3)},getAdjustedHeight:function(){return 0!=l?Math.floor(i/l):1},defaultRaster:function(e){return"HD_1920x1080@"+e+"P@1.7777"}}}}),n("timeline/TimelineEditPosition",[],function(){return function(e){return{get head(){return e.editPosition.head},set head(t){e.editPosition.head=t},get markIn(){return e.editPosition.markIn},set markIn(t){
e.editPosition.markIn=t},get markOut(){return e.editPosition.markOut},set markOut(t){e.editPosition.markOut=t},get startContent(){return 0},get endContent(){return e.duration-1}}}}),n("util/FrameUtil",["timecode/NormalPlayTime"],function(e){return{getTimecodeFromFrame:function(t,n){var r=e();return r.set(0,n),r.setFromFrame(t),r.getTimecode()},getFrameFromTimecode:function(t,n){var r=e();return r.set(0,n),r.setFromTimecode(t),r.getFrame()},getSecondFromFrame:function(t,n){var r=e();return r.set(0,n),r.setFromFrame(t),r.getSecond()},getFrameFromSecond:function(t,n){var r=e();r.set(0,n),r.setFromSecond(t);var a=r.getFrame();return a},getSecondFromNpt:function(t){var n=e();return n.set(0,1),n.setFromNpt(t),n.getSecond()},getRoundedMillisecondFromNpt:function(t){if(""==t)return NaN;var n=e();return n.set(0,1),n.setFromNpt(t),n.getRoundedMillisecond()},getNptFromSecond:function(t){var n=e();return n.set(t,1),n.getNpt()}}}),n("util/RectangleUtil",[],function(){return{getRatioCenterRect:function(e,t){var n=t.width/t.height;if(n>e){var r=e*t.height;return{x:t.x+(t.width-r)/2,y:t.y,width:r,height:t.height}}var a=t.width/e;return{x:t.x,y:t.y+(t.height-a)/2,width:t.width,height:a}}}}),n("asset/AssetInfo",["util/StringUtil","log/Log","timecode/SmpteTimecode","util/RectangleUtil","timecode/NormalPlayTime"],function(e,t,n,r,a){return function(i,o,s){var u,l,c,d,f,m,g,p,E,_,S,h,T,v,A,I,y=t.getLogLine("AssetInfo"),b={SHARED_FOLDER:"SHARED_FOLDER",PROJECT_FOLDER:"PROJECT_FOLDER",MEDIA_FILE:"MEDIA_FILE",EDL_FILE:"EDL_FILE",UNKNOWN_FILE:"UNKNOWN_FILE"},O={ICON:"Icon",KEY:"Key",DISPLAY_NAME:"Name",DURATION_FRAME:"Frames",DURATION_TIMECODE:"Duration",TRACKS:"Tracks",VIDEO_TRACKS:"Video Tracks",AUDIO_TRACKS:"Audio Tracks",FPS:"Fps",START_TIMECODE:"Start Timecode",DATE:"Date",FORMAT:"File Format",WIDTH:"Width",HEIGHT:"Height",DISPLAY_SIZE:"Display Size",VIDEO_FORMAT:"Video Format",AUDIO_FORMAT:"Audio Format"},k={AAF_STR:"aaf",REGULAR_STR:"regular",IMAGE_STR:"image",AUDIO_STR:"audio",TIMELINE_STR:"timeline",MOVIE_STR:"movie",MPEG_STR:"mpeg",MXF_STR:"mxf",P2_STR:"p2",DV_STR:"DV",EDL_STR:"edl",TEXTLAYER_STR:"textlayer"};return{PRI_CATEGORY:b,FIELDS:O,MEDIA_TYPES:k,setBasicInfo:function(e,t,n){i=e,o=t,s=n},setMediaInfo:function(e,t,n,r,a,i,o,s,y,b,O,k,C,L,D,M){u=e,l=t,_=n,c=r,d=a,f=i,m=o,g=s,p=y,E=b,S=O,h=k,T=C,v=L,A=D,I=M,this.isMediaFile()&&this.verifyMediaInfo()},setMediaInfoFromXml:function(t){var n=t.media_info.properties,r=(e.isEmpty(n.audio_tracks)?0:e.parseInteger(n.audio_tracks))*(n.channels?e.parseInteger(n.channels):0),a=e.parseInteger(n.display_width),i=e.parseInteger(n.display_height);e.isEmpty(a)&&(y.info("setMediaInfoFromXml: display_width is empty, take width"),a=e.parseInteger(n.width)),e.isEmpty(i)&&(y.info("setMediaInfoFromXml: display_height is empty, take height"),i=e.parseInteger(n.height)),this.setMediaInfo(t.media_info.type,e.parseInteger(t.file_info.modification_time),n.timecode,e.parseInteger(n.video_tracks),n.video_type,a,i,e.parseInteger(n.length),e.parseInteger(n.video_frame_received),e.parseNumber(n.fps),e.parseInteger(n.audio_tracks),n.audio_type,r,e.parseInteger(n.audio_length),e.parseInteger(n.audio_frame_received),n.rate)},getValue:function(e){switch(e){case O.KEY:return i;case O.DISPLAY_NAME:return o;case O.FORMAT:return this.getFormatedFormat();case O.DURATION_FRAME:return g;case O.DURATION_TIMECODE:return this.getFormatedDuration();case O.FPS:return this.getFormatedFps();case O.START_TIMECODE:return this.getStartTimecode();case O.DATE:return this.getFromatedDate();case O.TRACKS:return this.getFromatedTracks();case O.VIDEO_TRACKS:return c;case O.VIDEO_FORMAT:return d;case O.WIDTH:return f;case O.HEIGHT:return m;case O.DISPLAY_SIZE:return this.getFromatedDisplaySize();case O.AUDIO_TRACKS:return S;case O.AUDIO_FORMAT:return h;default:return"N/A"}},getCategory:function(){return s},isSharedFolder:function(){return s==b.SHARED_FOLDER},isProjectFolder:function(){return s==b.PROJECT_FOLDER},isFolder:function(){return isSharedFolder()||isProjectFolder()},isMediaFile:function(){return s==b.MEDIA_FILE},getFormatedFormat:function(){return isFolder()?"":e.getExtension(o)+(supportDirectPlay()?"*":"")},getFormatedDuration:function(){return isFolder()?"":this.getDurationTimecode()},getFromatedDate:function(){if(null==l)return"";var e=(parseFloat(l),new Date(1e3*parseFloat(l)));return(e.date>9?"":"0")+e.date+"/"+(e.month>9?"":"0")+e.month+"/"+e.fullYear},getFormatedFps:function(){return isFolder()?"":this.getFps().toFixed(2)},getFromatedTracks:function(){return""},getFromatedDisplaySize:function(){return this.hasVideo()?this.getWidth()+"x"+this.getHeight():""},getFormat:function(){return u},getFormatForTimeline:function(){return"audio"==u?h:(y.info("format",u),u)},getWidth:function(){return f},getHeight:function(){return m},setFps:function(e){var t=this.getDurationSecond();this.fps=e,this.duration=String(t*e)},getFps:function(){return E},getStartTimecode:function(){return e.isEmpty(_)?n().UNDEFINED_TIMECODE:_},getLastFrameNumber:function(){return Math.max(0,this.getDurationFrame()-1)},getDurationFrame:function(){return g},getVideoReceivedFrame:function(){return p},getDurationSecond:function(){var e=a();return e.set(0,this.getFps()),e.setFromFrame(this.getDurationFrame()),e.getSecond()},getDurationTimecode:function(){var e=a();return e.set(0,this.getFps()),e.setFromFrame(this.getDurationFrame()),e.getTimecode()},getSecond:function(e){var t=a();return t.set(0,this.getFps()),t.setFromFrame(e),t.getSecond()},getFrame:function(e){var t=a();return t.setFps(Fps(this.getFps())),t.setFromSecond(e),t.getFrame()},getVideoTracks:function(){return c},hasVideo:function(){return this.getVideoTracks()>0},getAudioTracks:function(){return S},getAudioChannels:function(){return T},getAudioDurationFrame:function(){return v},getAudioSampleRate:function(){return I},getAudioReceivedFrame:function(){return A},hasAudio:function(){return getAudioTracks()>0},getRatio:function(){return 0==this.getHeight()?0:this.getWidth()/this.getHeight()},getRatioCenter:function(e){var t=this.getWidth(),n=this.getHeight();return 0==t||0==n?(y.info("erro media dimension",t,n),e):r.getRatioCenterRect(t/n,e)},supportDirectPlay:function(){var t=e.getExtension(o),n=e.isEqual(t,"mp4",!1)||e.isEqual(t,"mov",!1),r=!hasVideo()||e.hasSubStr(getValue(O.VIDEO_FORMAT),"264",!1)||e.hasSubStr(getValue(O.VIDEO_FORMAT),"avc",!1),a=!hasAudio()||e.hasSubStr(getValue(O.AUDIO_FORMAT),"aac",!1);return n&&r&&a},getMetadataObject:function(){var e={key:i,start_timecode:this.getStartTimecode(),video_tracks:this.getVideoTracks(),video_duration:this.getDurationFrame(),video_fps:this.getFps(),video_width:this.getWidth(),video_height:this.getHeight(),video_duration_received:this.getVideoReceivedFrame(),audio_tracks:this.getAudioTracks(),audio_duration:this.getAudioDurationFrame(),audio_sample_rate:this.getAudioSampleRate(),audio_duration_received:this.getAudioReceivedFrame()};return e},verifyMediaInfo:function(){0==this.getFps()&&y.info("verifyInfo: Fps 0"),0==this.getDurationFrame()&&y.info("verifyInfo: Duration 0"),e.isEmpty(u)&&y.info("verifyInfo: Empty file format"),this.getVideoTracks()+this.getAudioTracks()==0&&y.info("verifyInfo: No tracks"),0!=this.getVideoTracks()&&(0!=this.getWidth()&&0!=this.getHeight()||y.info("verifyInfo: Video with/height 0"))}}}}),n("timeline/Timeline",["timeline/TimelineTrack","timeline/TimelineRaster","util/StringUtil","timeline/TimelineEditPosition","timeline/TimecodeTrack","util/FrameUtil","asset/AssetInfo","log/Log"],function(e,t,n,r,a,i,o,s){return function(n){function u(){E=a(),E.set(m(),_.fps,l(),c()),E.setTimecodeTrack(n.timecodeLeaps),E.showMilliseconds=!d()}function l(){return n.stampTimecode}function c(){return n.dropTimecode}function d(){var t,r,a=n.tracks||[];for(t=0,r=a.length;t<r;t++){var i=e(a[t],t);if(i.hasVideo())return!0}return!1}function f(){var t,r,a=0,i=n.tracks||[];for(t=0,r=i.length;t<r;t++){var o=e(i[t],t);a=Math.max(a,o.getTrackOut())}return a}function m(){return Math.max(f(),n.duration)}function g(){n.audioMasterVolume=parseFloat(n.audioMasterVolume),n.duration=parseInt(n.duration,10),n.start=parseInt(n.start,10),n.end=parseInt(n.end,10),n.editPosition.markIn=parseInt(n.editPosition.markIn,10),n.editPosition.markOut=parseInt(n.editPosition.markOut,10),n.editPosition.playHead=parseInt(n.editPosition.playHead,10),n.view.scaleX=parseFloat(n.view.scaleX),n.view.storylineScale=parseFloat(n.view.storylineScale)}function p(e){return e.replace(/\/track\[/i,"/tracks[").replace(/\/segment\[/i,"/segments[").replace(/\/angle\[/i,"/angles[").replace(/\/locator\[/i,"/locators[").split("/").slice(2).join(".")}var E,_=(s.getLogLine("Timeline"),t());return n?g():n={version:4,name:"untitled",description:"",originator:"MAXedit",assetLocation:"",assetKey:"",raster:"NTSC",dropTimecode:!1,timecodeLeaps:"",start:0,end:0,duration:0,stampTimecode:"00:00:00:00",readOnly:!1,audioMasterVolume:0,audioMixInMode:2,unrenderedAudioEffectCount:0,unrenderedVideoEffectCount:0,unsupportedAudioEffectCount:0,unsupportedVideoEffectCount:0,view:{firstVisibleFrame:0,scaleX:1,storylineScale:1},editPosition:{markIn:-1,markOut:-1,playHead:0}},_.parseString(n.raster),u(),{get data(){return n.duration=f(),n},get name(){return n.name},set name(e){n.name=e},timelineRaster:_,getAssetInfo:function(){var e=o("",n.name,o().PRI_CATEGORY.UNKNOWN_FILE);return e.setMediaInfo("timeline","",l(),this.getVideoTrackTotal(),"rgb",_.width,_.height,m(),-1,_.fps,this.getAudioTrackTotal(),"pcm",1,m()/_.fps*44100,-1,44100),e},getEditPosition:function(){return r(n)},get head(){return n.editPosition.playHead},set head(e){n.editPosition.playHead=e},get markIn(){var e=n.editPosition.markIn;return e===-1?0:e},set markIn(e){e>this.lastFrameNumber?n.editPosition.markIn=this.lastFrameNumber:n.editPosition.markIn=e},get markOut(){var e=n.editPosition.markOut;return e===-1?this.lastFrameNumber:e},set markOut(e){e>this.lastFrameNumber?n.editPosition.markOut=this.lastFrameNumber:n.editPosition.markOut=e},get lastFrameNumber(){return m>0?m-1:0},setEditPostion:function(e){this.head=e.head,this.markIn=e.markIn,this.markOut=e.markOut},get duration(){return m()},get end(){return n.end},set end(e){n.end=e},get raster(){return n.raster},set raster(e){n.raster=e,_.parseString(e),u()},resetTimecodeTrack:u,isDropTimecode:c,get timecodeLeaps(){return n.timecodeLeaps},set timecodeLeaps(e){n.timecodeLeaps=e,E.setTimecodeTrack(e)},setTimecodeTrackFps:function(e,t){E.setTimecodeTrackFps(e,t)},getTimelineTrackOut:f,hasVideo:d,getVideoTrackTotal:function(){var t,r,a=0,i=n.tracks||[];for(t=0,r=i.length;t<r;t++){var o=e(i[t],t);o.isVideoTrack()&&a++}return a},getAudioTrackTotal:function(){var t,r,a=0,i=n.tracks||[];for(t=0,r=i.length;t<r;t++){var o=e(i[t],t);o.isAudioTrack()&&a++}return a},getNthAudioTrack:function(e){for(var t,n=-1,r=0,a=this.getTrackCount();r<a;r++)if(t=this.getTrack(r),t.isAudioTrack()&&n++,n==e)return t},getSecond:function(e){return i.getSecondFromFrame(e,_.fps)},getFrame:function(e){return i.getFrameFromSecond(e,_.fps)},getTrack:function(t){return e(n.tracks[t],t)},getFirstTrackWithSegments:function(){for(var e,t=0;t<this.getTrackCount();t++)if(e=this.getTrack(t),e.getSegmentCount())return e;return this.getTrack(0)},getTrackCount:function(){return n.hasOwnProperty("tracks")?n.tracks.length:0},getSegmentTotal:function(){var t,r,a=0,i=n.tracks||[];for(t=0,r=i.length;t<r;t++){var o=e(i[t],t);a+=o.getSegmentCount()}return a},getXPath:function(){return""},get timeline(){return JSON.stringify({timeline:n})},changeProperty:function(e,t){for(var r,a,i,o=p(e).split("."),s=n;o.length>1;)r=o.shift(),i=r.indexOf("["),i>-1?(a=parseInt(r.substr(i+1,r.length-1),10),r=r.substr(0,i),s=s[r][a]):s=s[r];s[o.shift()]=t},insertTrack:function(e,t){n.hasOwnProperty("tracks")?n.tracks.splice(e,0,t.data):n.tracks=[t.data]},directTimeline:function(e,t,n,r,a,i,o){return{timeline:{version:4,name:e,uuid:t,assetKey:n,raster:r,dropTimecode:a,audioMasterVolume:0,audioMixInMode:2,editPosition:{markIn:-1,markOut:-1,playHead:i},tracks:o}}},hasRemoteAssets:function(){for(var e=0,t=this.getTrackCount();e<t;e++)if(this.getTrack(e).hasRemoteAssets())return!0;return!1}}}}),n("play/DefaultPlayback",["play/EPlayback","event/Dispatcher","event/Event","play/EPlayback","util/JavascriptUtil","timeline/Timeline"],function(e,t,n,e,r,a){return function(i){function o(e){u&&(u.style.backgroundColor=e)}var s,u,l,c,d,f=!1,m=320,g=240,p=null,E=a(null),_=t();return{dispatcher:_,mode:function(){return e.MODES.DEFAULT},setLoaddata:function(e){d=e,d.timeline&&(E=d.timeline)},open:function(){this.seekQuality(0)},close:function(){},play:function(e,t){f=!0},isPlaying:function(){return f},pause:function(e){e=r.defaultValue(e,!0),f=!1},stop:function(){f=!1},resume:function(){},buffer:function(){},seek:function(t,r,a,i){_.raiseEvent(n(e.EVENTS.SEEK_FINISHED)),_.raiseEvent(n(e.EVENTS.SEGMENT_CHANGE,{segment:null,playback:public})),l=t,c=t,o(0)},seekQuality:function(e,t,n,a){t=r.defaultValue(t,!1),n=r.defaultValue(n,!1),a=r.defaultValue(a,!1),this.seek(e,80,t)},get currentFrame(){return this.isPlaying()&&c++,c},currentSegment:function(){return null},getBitmap:function(e,t){return null},attachToDisplay:function(e){s=e,u=document.createElement("div"),u.style.display="block",u.style.backgroundColor=0,u.width=320,u.height=200,u.margin="auto",s.appendChild(u)},detachDisplay:function(){s&&u&&s.removeChild(u),u=null},set playSpeed(e){},get playSpeed(){return 1},getBufferRange:function(){return null},get fps(){return 30},get duration(){return 0},get width(){return m},get height(){return g},setAudioVolume:function(e,t){},setAudioPan:function(e,t){},setAudioMute:function(e,t){},setAudioSolo:function(e,t){},currentFrameBitmap:function(){return null},statistics:function(){return null},setSize:function(e,t){},get timeline(){return E},get loadData(){return d},get name(){return d.name},flush:function(){},modifyTimeline:function(e,t,n){return!1},get captions(){return p},set captions(e){p=e},isConnected:function(){return!0},timelineModified:function(){},getSegment:function(e){return null}}}}),n("data/Captions",[],function(){return function(){return{}}}),n("data/LoadData",["util/JavascriptUtil"],function(e){return function(t,n,r,a,i,o,s){return{name:e.defaultValue(t,null),url:e.defaultValue(n,null),type:e.defaultValue(r,null),relinkPolicy:e.defaultValue(a,null),seek:e.defaultValue(i,-1),background:e.defaultValue(o,!1),forceRelink:e.defaultValue(s,!1),aborted:!1,captions:null,assetInfo:null,timeline:null,fixedDuration:!1}}}),n("data/LoadDataManager",["log/Log"],function(e){return function(){var t=[];return public={},ll=e.getLogLine("LoadDataManager"),public.addPending=function(e){var n=public.getPendingByName(e.name);n&&(ll.info("Aborting load of: "+n.url),public.removePending(n),n.aborted=!0),t.push(e)},public.isPending=function(e){return t.indexOf(e)>-1},public.removePending=function(e){var n=t.indexOf(e);return n>-1&&(t.splice(n,1),!0)},public.getPendingByName=function(e){var n=null;return t.forEach(function(t,r,a){t.name==e&&(n=t)}),n},public}}),n("asset/AssetEditPosition",[],function(){return function(){return{head:0,markIn:0,markOut:0,startContent:0,endContent:0,setFromAssetInfo:function(e){this.head=0,this.markIn=0,this.markOut=e.getDurationFrame(),this.startContent=0,this.endContent=e.getDurationFrame()-1}}}}),n("asset/Asset",["log/Log","asset/AssetInfo","asset/AssetEditPosition","timeline/TimecodeTrack"],function(e,t,n,r){return function(a,i,o){var s=(e.getLogLine("Asset"),t(a,i,o)),u=n(),l=r(),c=[];return{getKey:function(){return s.key},getDisplayName:function(){return s.displayName},getCategory:function(){return s.category},setMediaInfoFromXml:function(e){s.setMediaInfoFromXml(e),this.getEditPosition().setFromAssetInfo(s),this.getTimecodeTrack().set(s.getFps(),s.getDurationSecond(),s.getStartTimecode())},getInfo:function(){return s},getEditPosition:function(){return u},getTimecodeTrack:function(){return l},getCustomProxy:function(e,t,n,r,a,i,o){e.getProxy(getKey(),t,n,r,a,"",i,o,null)},getXmdCustomProxy:function(e,t,n,r,a,i,o){var s=function(n){var r=n.params;if(e.removeListener(XmdMsg.GET_CLIP_PROXY,s),e.removeListener(XmdSocket.DISCONNECTED,s),null==r||r.isError()||!r.hasData())o(getKey(),t,"getXmdCustomProxy failed.");else{var a=new Loader;a.loadBytes(r.data,null),a.contentLoaderInfo.addEventListener(Event.COMPLETE,function(e){i(getKey(),t,a)})}};e.addListener(XmdSocket.DISCONNECTED,s),e.addListener(XmdMsg.GET_CLIP_PROXY,s),e.sendMsg(XmdMsg.createGetClipProxyMsg(getKey(),XmdMsg.GET_CLIP_PROXY_TYPE_KEY,t,n,r,a))||(e.removeListener(XmdMsg.GET_CLIP_PROXY,s),e.removeListener(XmdSocket.DISCONNECTED,s),o(getKey(),t,"Socket send error."))},addSubAssetkey:function(e){c.push(e)},getSubAssetKeys:function(){return c},clearSubAssetKeys:function(){return c=[]},hasSubAssets:function(){return c.length>0},supportDirectPlay:function(){return s.supportDirectPlay()}}}}),n("asset/AssetBuilder",["asset/Asset","asset/AssetInfo"],function(e,t){return function(){var n=t();return{createAssetFromXml:function(t){var r=e(t.key,t.display_name,n.PRI_CATEGORY.MEDIA_FILE);return r.setMediaInfoFromXml(t),r}}}}),n("util/FileTypeUtil",[],function(){return{isAudio:function(e){var t=e.split("."),n=t[t.length-1];switch(n){case"mp3":case"wav":case"aiff":return!0}return!1}}}),n("timeline/EdlSegment",["appbase/ConfigManager","log/Log","event/Dispatcher","event/Event","event/EventStatus","util/FrameUtil","util/StringUtil","util/NumberUtil","util/XMLUtil","util/JavascriptUtil","util/FileTypeUtil","timecode/Fps"],function(e,t,n,r,a,i,o,s,u,l,c,d){return function(a){function s(){return!isNaN(p.timecodeTrackFps)&&(!isNaN(p.endMillisecond)&&0==g)}function u(e){return i.getRoundedMillisecondFromNpt(e?e.slice(4):"")}function l(t,n){if(t)return void(isNaN(p.endMillisecond)||isNaN(p.timecodeTrackFps)||0!=g?m.raiseEvent(r(p.EVENTS.FAILED,p)):(p.hasVideo=!c.isAudio(p.src),p.fixedDuration=!0,p.aspectratio=1,m.raiseEvent(r(p.EVENTS.LOADED,p))));p.clipInfo=n.get_clip_info_re.clip_item;var a=p.clipInfo.media_info.properties;p.hasVideo=a.video_tracks&&"0"!=a.video_tracks,p.isGrowing=o.parseInteger(a.audio_frame_received,-1)>-1||o.parseInteger(a.video_frame_received,-1)>-1,p.fixedDuration=!isNaN(p.endMillisecond),p.audioTrackCount=o.parseInteger(a.audio_tracks,0),p.hasVideo?isNaN(p.timecodeTrackFps)&&(p.timecodeTrackFps=d.convertToRational(parseFloat(a.fps)),p.timecodeTrackDropTimecode=Boolean(p.timecodeTrackFps%1)):(p.timecodeTrackFps=d.convertToRational(e.audioFrameRate),p.timecodeTrackDropTimecode=!1),isNaN(p.endMillisecond)&&(p.hasVideo?p.isGrowing?(p.endMillisecond=a.video_frame_received/a.fps*1e3,p.endMillisecond<p.beginMillisecond&&(p.endMillisecond=p.beginMillisecond)):p.endMillisecond=a.length/a.fps*1e3:p.endMillisecond=a.audio_length/a.rate*1e3),g?(p.height=o.parseInteger(a.display_height,-1),p.width=Math.round(p.height*g),p.aspectratio=g):(p.height=o.parseInteger(a.display_height,-1),p.width=o.parseInteger(a.display_width,-1),p.aspectratio=o.parseRational(a.ratio,-1)),m.raiseEvent(r(p.EVENTS.LOADED,p))}var f=t.getLogLine("Edl"),m=n(),g=0,p={dispatcher:m,EVENTS:{LOADED:"edl.segment.loaded",FAILED:"edl.segment.failed"},src:"",beginMillisecond:0,endMillisecond:0,width:-1,height:-1,aspectratio:0,scaleType:"LETTER-BOX",globalID:"",comment:"",timecodeTrackFps:30,timecodeTrackDropTimecode:!1,timecodeTrackLeaps:"",hasVideo:!0,clipInfo:null,isGrowing:!1,fixedDuration:!1,audioTrackCount:16};return p.setSegment=function(e,t){p.src=e["@attributes"].src,p.beginMillisecond=u(e["@attributes"]["clip-begin"]),isNaN(p.beginMillisecond)&&(p.beginMillisecond=0),p.endMillisecond=u(e["@attributes"]["clip-end"]);var n=e["@attributes"].framerate,i=e["@attributes"].dropframe;if(e["timecode-track"].length&&(p.timecodeTrackLeaps=o.trim(e["timecode-track"])),!o.isEmpty(n)){p.timecodeTrackFps=d().convertToRational(parseFloat(n));var E=Boolean(p.timecodeTrackFps%1);p.timecodeTrackDropTimecode=0==i.length?E:o.parseBoolean(i,!1)}aspectratio=o.parseRational(e["@attributes"].aspectratio,0),width=o.parseInteger(e["@attributes"].width,-1),height=o.parseInteger(e["@attributes"].height,-1),width!=-1&&height!=-1?0==aspectratio?aspectratio=width/height:width=Math.round(height*aspectratio):g=aspectratio,p.globalID=e["@attributes"].globalID,p.comment=e["@attributes"].comment,!t&&s()?(p.hasVideo=!c.isAudio(p.src),m.raiseEvent(r(p.EVENTS.LOADED,p))):(f.info("Getting missing clip info for: "+p.src),a.comm().getClipInfo(p.src,l))},p}}),n("timeline/Edl",["log/Log","event/Dispatcher","event/Event","event/EventStatus","util/XMLUtil","util/JavascriptUtil","util/StringUtil","appbase/ConfigManager","timeline/EdlSegment","timeline/TimelineRaster","timeline/TimelineSegment","timeline/TimelineTrack","timeline/Timeline","timecode/Fps"],function(e,t,n,r,a,i,o,s,u,l,c,d,f,m){return function(g){function p(e){b=i.without(b,e.params),y.length!=O||0!=b.length||k||S.raiseEvent(n(D.EVENTS.LOADED,null,null))}function E(e){var t=e.params;k=!0;var a="Failed to load clip info for segment: "+t.src;h.error(a),S.raiseEvent(n(D.EVENTS.LOAD_FAILED,{key:t.src},r(r().STATUS.BAD_REQUEST,a)))}var _,S=t(),h=e.getLogLine("Edl"),T=30,v=!1,A=16,I=1e4,y=[],b=[],O=0,k=!1,C=0,L="",D={dispatcher:S,EVENTS:{LOADED:"edl.loaded",LOAD_FAILED:"edl.load_failed",TIMELINE_READY:"timeline.ready"}};return D.loadEdlUrl=function(e){L=e,g.comm().loadUrl(e,function(e,t){if(e){var a="EDL SMIL URL load failed";return h.error(a),void S.raiseEvent(n(D.EVENTS.LOAD_FAILED,{},r(r().STATUS.NOT_FOUND,a)))}if(null==t||""==t){var a="EDL SMIL URL data is null";return h.error(a),void S.raiseEvent(n(D.EVENTS.LOAD_FAILED,{},r(r().STATUS.NO_CONTENT,a)))}D.generateFromEdl(t)})},D.generateFromEdl=function(e){k=!1;var t=a.XMLToObject(a.StringToXML(e)),o=t.body.par.seq.video;if(null==o){var s="Bad EDL SMIL format";return h.error(s,t),void S.raiseEvent(n(D.EVENTS.LOAD_FAILED,{smil:t},r(r().STATUS.BAD_REQUEST,s)))}o=i.forceArray(o),_=t.head&&t.head.video?t.head.video:null,y=[],b=[],O=o.length,o.forEach(function(e){var t=u(g);t.dispatcher.addListener(u().EVENTS.LOADED,p),t.dispatcher.addListener(u().EVENTS.FAILED,E),y.push(t),b.push(t),t.setSegment(e,1==O)});var l=t.head&&t.head.meta?t.head.meta:null;l&&(Array.isArray(l)||(l=[l]),l.forEach(function(e){switch(e.name){case"startposition":C=FrameUtil.getRoundedMillisecondFromNpt(e.value.slice(4,e.value.length))}})),0==O&&S.dispatch(D.EVENTS.LOADED,null,null)},D.prepareTimeline=function(){var e,t;_&&_["@attributes"].framerate?(e=m().convertToRational(o.parseRational(_["@attributes"].framerate,T)),t=_["@attributes"].dropframe):y.length?(e=y[0].timecodeTrackFps,t=y[0].timecodeTrackDropTimecode):_?(e=T,t=v):(e=s.audioFrameRate,t=v);var r,a,u,g=[],p=[],E=0,b=0;y.forEach(function(t){r=Math.round(t.beginMillisecond*t.timecodeTrackFps/1e3),a=Math.round(t.endMillisecond*t.timecodeTrackFps/1e3),u=E,E=u+(Math.round(t.endMillisecond*e/1e3)-Math.round(t.beginMillisecond*e/1e3));var n="1";t.timecodeTrackFps!=e&&(n=String(t.timecodeTrackFps/e)),t.timecodeTrackLeaps.length>I&&h.warn("Video segment in EDL has too many timecode leaps"),g.push(c().directVideoSegment(t.src,r,a,u,E,t.hasVideo?"":"black",n,t.timecodeTrackFps,t.timecodeTrackDropTimecode,t.timecodeTrackLeaps,t.globalID,t.comment,t.width,t.height,t.aspectratio,t.scaleType)),r=Math.round(t.beginMillisecond*e/1e3),a=Math.round(t.endMillisecond*e/1e3),p.push(c().directAudioSegment(t.src,r,a,u,E,"",0,0,t.globalID)),b=Math.max(b,t.audioTrackCount)});for(var k,M=d().directVideoTrack(g),R=[],P=0;P<A;P++){var N=s.edlMultiChannelMapping?P+1:P%2+1;k=i.deepCopy(p);for(var F=0,U=k.length;F<U;F++)k[F].audioChannel=N,s.edlMultiChannelMapping||(k[F].audioTrack=Math.floor(P/2+1));var w=P%2?d().TRACK_AUDIO_PAN_RIGHT:d().TRACK_AUDIO_PAN_LEFT;R.push(d().directAudioTrack(w,k))}var B=Math.floor(C*e/1e3),x=l();if(_){var V="p";switch(String(_["@attributes"].scantype).toLocaleLowerCase()){case"progressive":V="p";break;case"field1":V="iT";break;case"field2":V="iB";break;case"segmented":V="sF";break;default:h.warn("No scan type found - defaulting to progressive")}var G=o.parseInteger(_["@attributes"].width,1920),K=o.parseInteger(_["@attributes"].height,1080);x.set(null,G,K,e,V,o.parseRational(_["@attributes"].aspectratio,G/K))}else 1==O?x.setFromMediaProps(y[0].clipInfo.media_info.properties):x.setHDRaster(e);var j="untitled";if(L){var Y=L.split("/");j=Y[Y.length-1]}var X=f().directTimeline(j,L,L,x.getString(),t,B,[M].concat(R)),H=null,W=!1;y.length&&y[0].isGrowing&&(H=y[0].clipInfo,W=y[0].fixedDuration),S.raiseEvent(n(D.EVENTS.TIMELINE_READY,{timeline:JSON.stringify(X),growingClipInfo:H,fixedDuration:W}))},D}}),n("event/EventParamProgress",["util/StringUtil"],function(e){return function(t,n,r){var a={NOPROGRESS:0,INDETERMINATE:1,DETERMINATE:2,DONE:3};return{STATES:a,percent:function(){return n},message:r,hasMessage:function(){return!e.isEmpty(r)},hasProgress:function(){return t!==a.NOPROGRESS},isDeterminate:function(){return t===a.DETERMINATE},isDone:function(){return t===a.DONE||t===a.DETERMINATE&&_percent>=100}}}}),n("net/ModifyTimelineItem",[],function(){return function(e,t,n){return{get action(){return e},get key(){return t},get value(){return n},get data(){return{action:e,key:t,value:n}}}}}),n("timeline/TimelineAngle",["util/StringUtil","log/Log"],function(e,t){var n=function(e){var t=[],n={name:null,get mobID(){return e},offset:0,duration:0,timecode:null,video:!1};return n.addAudio=function(e,n){for(;e>=t.length;)t.push(null);t[e]=n},n.getAudioTracks=function(){for(var e=[],n=0,r=t.length;n<r;n++)t[n]&&e.push(n);return e},n};return n}),n("timeline/TimelineGroupClip",["util/StringUtil","log/Log","timeline/TimelineTrack","timeline/TimelineAngle"],function(e,t,n,r){return function(e,t){function a(){return t&&e.isGroupClip}var i,o=[];if(a()){t.data.tracks.forEach(function(t,r){var a=new n(t,r);if(a.isAudioTrack()){var i=a.getSegmentAtPos(e.trackIn);i&&i.isGroupClip&&i.groupClipID==e.groupClipID&&o.push(i)}});var s=[];e.data.groupClipMob.angles.forEach(function(e,t){s.push(e.mob.id)});for(var u,l,c=o.length;l<c;l++)u=[],o[l].data.groupClipMob.angles.forEach(function(e,t){u.push(String(e.mob.id))}),s=ArrayUtil.merge(s,u);i=[];var d=0;s.forEach(function(t){var n=new r(t),a=e.getAngle(t);for(a?(n.name=a.name,n.video=!0,n.offset=a.offset,n.duration=a.sourceMob.length,n.timecode=a.in):n.video=!1,l=0,c=o.length;l<c;l++){var s=o[l].getAngle(t);s&&(n.addAudio(l,s),n.name=s.name,n.offset=s.offset,n.duration=s.sourceMob.length,n.timecode=s.in)}i.push(n),d++});var f={get angles(){return i},get layout(){return e.data.groupClipMob.layout},get bank(){return e.data.groupClipMob.hasOwnProperty("bank")?e.data.groupClipMob.bank:0}};return f.getVideoSegment=function(){return e},f.getAudioSegment=function(e){return o[e]},f.getAudioSelections=function(){for(var e={},t=0,n=o.length;t<n;t++)e[t]=o[t].selectedAngle;return e},Object.defineProperty(f,"isGroupClip",{get:function(){return a()}}),f}}}),n("data/Recorder",["util/JavascriptUtil","log/Log","net/Message","timeline/TimelineTrack","event/ExternalDispatcher","event/ExternalInterface"],function(e,t,n,r,a,i){return function(e){var o,s,u=t.getLogLine("Recorder"),l=32,c=2,d=0,f=e.audioContext,m=null,g=null,p=f.createGain(),E=f.createScriptProcessor(2048,1,1),_=!1,S={};return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,S.enable=function(e){e?null==m&&navigator.getUserMedia({audio:!0},function(e){m=e,g=f.createMediaStreamSource(m),g.connect(p),p.connect(E),E.connect(f.destination),a.raiseEvent(i.KEYS.RECORDER_ENABLE,{enabled:!0})},function(e){u.error("Couldn't get audio input: "+e.name)}):(m&&(m.active=!1,m.stop()),m=null,g.disconnect(p),g=null,p.disconnect(E),E.disconnect(f.destination),a.raiseEvent(i.KEYS.RECORDER_ENABLE,{enabled:!1}))},S.isMicEnabled=function(){return null!=m},E.onaudioprocess=function(t){var r,s,m,g=t.inputBuffer.getChannelData(0),p=(t.outputBuffer.getChannelData(0),0),E=g.length;switch(l){case 8:for(_data=new Int8Array(g.length),r=0;r<E;r++)Math.abs(g[r])>p&&(p=Math.abs(g[r])),_data[r]=127*g[r];break;case 16:for(s=new ArrayBuffer(g.length*c),m=new DataView(s),r=0;r<E;r++)Math.abs(g[r])>p&&(p=Math.abs(g[r])),m.setInt16(2*r,32767*g[r],!0);break;case 32:for(s=g.buffer.slice(0),r=0;r<E;r++)g[r]>p&&(p=g[r]);break;default:u.error("Recodring bit rate not supported.")}a.raiseEvent(i.KEYS.RECORDER_LEVEL,{peak:p}),_&&(e.socket().sendMsg(n.createRecordAudioMessage(o,"mxf",1,f.sampleRate,l,"PCM",d,E,s),function(e){e.isError()&&u.error("VoiceRecorder: Server reports error: "+e.getStatusErrorString())})||u.error("VoiceRecorder: Error sending audio data to server."),d+=E)},S.startRecording=function(t,n,r){return S.isMicEnabled||S.enable(!0),o=t,s=n,l=r,d=0,c=l/8,e.socket().isConnected()?(u.info("Recording file: "+o),void(_=!0)):void u.error("Socket not connected")},S.stopRecording=function(){u.info("Stopping recording."),_=!1},S.isRecording=function(){return _},S.getRecorderPath=function(){return o},S.getGain=function(){return p?100*p.gain.value:100},S.setGain=function(e){p&&(p.gain.value=e/100)},S.addRecordFileToTimeline=function(t,a,i){o=a,e.socket().sendMsg(n.createGetClipInfoMessage(o,n.GET_CLIP_PROXY_TYPE_FILE),function(e){if(e.isError())return u.error("VoiceRecorder: Server reports error on get clip info: "+e.getStatusErrorString());var n=e.message.get_clip_info_re.clip_item,a=t.getFrame(parseInt(n.media_info.properties.audio_length,10)/parseInt(n.media_info.properties.rate,10)),l=t.getTrackCount(),c=r({type:"AUDIO",subtype:"voice-over",name:"Voice",selected:!0,audioChannel:1,audioTrack:1,view:{muted:!1},segment:{name:"undefined",description:o,protocol:"file",embeddedText:"",path:o,format:"mxf",totalLength:a,position:{trackIn:s,trackOut:s+a,in:0,out:a},store:{base:"00:00:00:00",adjustment:"0/1"},audioGenerator:{type:"NONE"},transition:{type:"NONE"}}},l);t.insertTrack(l,c),i(null,t)})||i("VoiceRecorder: Error getting clip info.")},S}}),n("control/Deck",["appbase/ConfigManager","util/StringUtil","play/EPlayback","play/PlaybackFrames","play/DefaultPlayback","data/Captions","data/LoadData","data/LoadDataManager","asset/AssetBuilder","asset/AssetPathUrl","timeline/Edl","timeline/Timeline","timeline/TimelineRaster","event/EventParamProgress","net/Message","util/JavascriptUtil","log/Log","util/XMLUtil","event/Event","event/EventStatus","lang/Locale","event/Dispatcher","net/SOCKET_EVENTS","util/NumberUtil","net/ModifyTimelineItem","play/PlaybackFramesOptions","timeline/TimelineGroupClip","data/Recorder","asset/Asset","asset/AssetInfo","event/ExternalDispatcher","event/ExternalInterface"],function(e,t,n,r,a,i,o,s,u,l,c,d,f,m,g,p,E,_,S,h,T,v,A,I,y,b,O,k,C,L,D,M){return function(i){function l(e){return o(e.name,e.url,I(e.url,e.type),JSON.stringify(e.relink_policy),t.parseInteger(e.frame,-2),t.parseBoolean(e.background,!1),e.force_relink)}function _(e){if(e.background||R(m(ye.INDETERMINATE,0,T.value("deckcode.loadingUrl"))),""===e.url&&""!==e.relinkPolicy)for(var n=1;n<ve.length;n++)if(ve[n].name===e.name){ve[n].loadData.relinkPolicy!==e.relinkPolicy&&(e.url=ve[n].loadData.url);break}var r;t.isEmpty(e.url)?C(e):e.type==Ie.EDL||e.type==Ie.EDL_URL?(r=c(i),r.dispatcher.addListener(c().EVENTS.LOADED,function(t){r.dispatcher.addListener(c().EVENTS.TIMELINE_READY,function(t){e.aborted||(e.url=t.params.timeline,e.type=Ie.TIMELINE,t.params.growingClipInfo&&(e.assetInfo=L(t.params.growingClipInfo.key,t.params.growingClipInfo.key,L().PRI_CATEGORY.MEDIA_FILE),e.assetInfo.setMediaInfoFromXml(t.params.growingClipInfo),e.fixedDuration=t.params.fixedDuration),A(e))}),r.prepareTimeline()}),r.dispatcher.addListener(c().EVENTS.LOAD_FAILED,function(t){D.raiseEvent(M.KEYS.DECK_LOAD,t.params,t.status),R(m(ye.DONE,0,null)),Ae.removePending(e)}),e.background||R(m(ye.INDETERMINATE,0,null)),e.type==Ie.EDL?r.generateFromEdl(e.url):r.loadEdlUrl(e.url)):A(e)}function A(t){var n=function(n){if(!t.aborted){if(null==n||n.isError())return R(m(ye.DONE,0,n.getStatusErrorString())),
b(t.name,null,null,h(h().STATUS.ERROR_FROM_SERVER,n.getStatusErrorString(),n.getStatusMessageDetails())),Ae.removePending(t),void _(o(t.name));var r=d(JSON.parse(n.message.load_timeline_url_re.timeline).timeline);N(t.name,r,function(){if(!t.aborted){if(P(t.name,r),t.timeline=r,null==t.assetInfo){var a=n.message.load_timeline_url_re.clip_item,i=null==a?r.getAssetInfo():u().createAssetFromXml(a).getInfo();r.hasVideo()||i.setFps(e.audioFrameRate),t.assetInfo=i}var o=null;n.isWarning()&&(o=h(h().STATUS.WARNING_FROM_SERVER,n.getStatusErrorString(),n.getStatusMessageDetails())),C(t,o)}})}};t.background||R(m(ye.INDETERMINATE,0,null)),i.socket().sendMsg(g.createLoadTimelineUrlMessage(t.name,t.url,t.type,t.relinkPolicy,t.forceRelink),n)||(R(m(ye.DONE,0,T.value("deckcode.sendFailed"))),b(t.name,null,null,h(h().STATUS.COMMUNICATION_ERROR,T.value("deckcode.sendFailed"))))}function I(e,n){return t.isEmpty(e)?Ie.FILE:t.isEmpty(n)||t.isEqual(n,Ie.AUTO,!1)?t.isMobId(e)?Ie.MOB_ID:t.isAbsolutePath(e)?Ie.FILE:t.isXmlTimeline(e)||t.isPerlTimeline(e)||t.isJSONTimeline(e)?Ie.TIMELINE:t.isSMIL(e)?Ie.EDL:t.isSMILURL(e)?Ie.EDL_URL:t.isMorpheusURL(e)?Ie.MORPHEUS_URL:(Te.error("Can not get type from url",e),n):n.toUpperCase()}function b(e,t,n,r){e.length&&D.raiseEvent(M.KEYS.DECK_LOAD,{name:e,title:t?t.name:"",raster:t?t.raster:"",timeline:t?t.timeline:"",mode:_e.mode,metadata:n?n.getMetadataObject():null},r)}function C(e,t){if(t=p.defaultValue(t,null),e.background||R(m(ye.INDETERMINATE,0,null)),""!=_e.name){_e.pause(!1),_e.flush();var n=_e.timeline?_e.timeline.getEditPosition():null;n&&(_e.loadData.seek=n.head,_e.timeline&&(_e.timeline.head=n.head,_e.timeline.markIn=n.markIn,_e.timeline.markOut=n.markOut))}e.timeline=B(e),Ae.removePending(e),F(),b(e.name,e.timeline,e.assetInfo,""===status?h():status),w(),Me.timeline=e.timeline,U()}function R(e){Oe.raiseEvent(S(ke.PROGRESS,{progress:e}))}function P(t,n){if(e.muteExtraAudioTracksOnLoad){for(var r,a=n.getTrackCount(),i=0,o=[],s=0;s<a;s++)r=n.getTrack(s),r.isAudioTrack()&&(i>1&&!r.muted&&o.push(new y("MODIFY","/timeline/track["+s+"]/view/muted","TRUE")),i++);ue(t,n,o,!0)}}function N(t,n,r){if(!n.hasVideo()){var a=f();if(a.parseString(n.raster),a.fps!=e.audioFrameRate){var i=e.audioFrameRate/a.fps;return a.fps=e.audioFrameRate,n.raster=a.getString(),void se(t,n,"MODIFY","/timeline/raster",a.getString(),!1,function(){for(var e=[],a=0,o=n.getAudioTrackTotal();a<o;a++)for(var s=n.getTrack(a),u=0,l=s.getSegmentCount();u<l;u++){var c=s.getSegment(u);e.push(new y("MODIFY","/timeline/track["+a+"]/segment["+u+"]/position/trackIn",Math.floor(c.trackIn*i))),e.push(new y("MODIFY","/timeline/track["+a+"]/segment["+u+"]/position/trackOut",Math.floor(c.trackOut*i))),e.push(new y("MODIFY","/timeline/track["+a+"]/segment["+u+"]/position/in",Math.floor(c.srcIn*i))),e.push(new y("MODIFY","/timeline/track["+a+"]/segment["+u+"]/position/out",Math.floor(c.srcOut*i)))}var d=n.duration*i;e.push(new y("MODIFY","/timeline/end",d)),e.push(new y("MODIFY","/timeline/duration",d)),ue(t,n,e,!1,function(e){return e.isOK()?(n.resetTimecodeTrack(),void r()):void E.error(e.getStatusMessageDetails())})})}}r()}function F(){ie()}function U(){if(null!=_e.timeline)for(var e,t=_e.timeline.getTrackCount(),n=0,r=0;r<t;r++)e=_e.timeline.getTrack(r),e.isAudioTrack()&&(D.raiseEvent(M.KEYS.DECK_AUDIO_MUTE,{track:n,mute:e.muted}),D.raiseEvent(M.KEYS.DECK_AUDIO_SOLO,{track:n,solo:e.solo}),D.raiseEvent(M.KEYS.DECK_AUDIO_VOLUME,{track:n,vol:parseFloat(e.data.audioVolume)}),D.raiseEvent(M.KEYS.DECK_AUDIO_PAN,{track:n,pan:parseFloat(e.data.audioPan)}),n++)}function w(){}function B(t){_e&&_e.detachDisplay();for(var r=_e,a=0;a<ve.length;a++)if(ve[a].name==t.name)return null==t.timeline?(Te.info("Null timeline - clear the deck."),_e=ve.splice(a,1)[0],K(_e),_e=G(t),Y(_e),X(_e),x(Se.clientWidth,Se.clientHeight),_e.seekQuality(0),null):(_e=ve[a],t.captions=_e.captions,(_e.mode!=e.playbackMode||t.assetInfo&&t.assetInfo.getMetadataObject().video_duration_received>-1&&_e.mode==n.MODES.FILE)&&(_e=ve.splice(a,1)[0],K(_e),_e=G(t),Y(_e)),X(_e),Te.info("New timeline - overwrite previous."),t.seek==-2?t.timeline.head=_e.timeline.head:t.seek>-1&&(t.timeline.head=t.seek),V(_e),_e.setLoaddata(t),x(Se.clientWidth,Se.clientHeight),_e.open(i),t.background&&(_e.detachDisplay(),_e=r,V(_e)),_e.timeline);return Te.info("New timeline."),t.seek>-1&&t.timeline&&(t.timeline.head=t.seek),_e=G(t),Re=-1,_e.setLoaddata(t),x(Se.clientWidth,Se.clientHeight),_e.open(i),Y(_e),t.background&&(_e.detachDisplay(),_e=r,x(Se.clientWidth,Se.clientHeight),V(_e)),_e.timeline}function x(t,n){var r,a,i,o,s=t,u=n;if(e.alwaysFill)i=s,o=u;else{var t=_e.width,n=_e.height;be&&n<u&&t<s?(o=n,i=t):(r=t/n,a=s/u,a>r?(i=u*r,o=u):(i=s,o=s/r))}_e.setSize(i,o),_e.captions&&_e.captions.setSize(i,o)}function V(e){e.attachToDisplay(Se)}function G(t){var o;if(t.timeline)if(t.assetInfo.getMetadataObject().video_duration_received>-1||t.assetInfo.getMetadataObject().audio_duration_received>-1)o=r(i);else switch(e.playbackMode){case n.MODES.FILE:o=r(i);break;case n.MODES.FRAME:o=r(i);break;default:var s="Unknown playback mode: "+e.playbackMode;throw Te.error(s),new Error(s)}else o=a(),o.setLoaddata(t);return V(o),o.dispatcher.addListener(n.EVENTS.PLAY_INITIATED,H),o.dispatcher.addListener(n.EVENTS.PLAY_BUFFERING,W),o.dispatcher.addListener(n.EVENTS.PLAY_START,q),Oe.redispatch(o.dispatcher,n.EVENTS.PLAY_START),o.dispatcher.addListener(n.EVENTS.PLAY_PAUSE,Q),Oe.redispatch(o.dispatcher,n.EVENTS.PLAY_PAUSE),o.dispatcher.addListener(n.EVENTS.PLAY_SPEED_CHANGE,J),o.dispatcher.addListener(n.EVENTS.AUDIO_MIXER_LEVEL,z),o.dispatcher.addListener(n.EVENTS.PREBUFFERING_PROGRESS,Z),o.dispatcher.addListener(n.EVENTS.PREBUFFERING_READY,$),Oe.redispatch(o.dispatcher,n.EVENTS.SEEK_START),o.dispatcher.addListener(n.EVENTS.SEEK_FINISHED,ee),o.dispatcher.addListener(n.EVENTS.SEEK_FAILED,ee),o.dispatcher.addListener(n.EVENTS.SEGMENT_CHANGE,ne),o.dispatcher.addListener(n.EVENTS.EWC_UPDATE_TIMELINE_LENGTH,re),o.dispatcher.addListener(n.EVENTS.MULTICAM_SELECT,ge),o.dispatcher.addListener(n.EVENTS.MULTICAM_ZOOM_IN,pe),o.dispatcher.addListener(n.EVENTS.MULTICAM_ZOOM_OUT,Ee),o}function K(e){e.dispatcher.removeListener(n.EVENTS.PLAY_INITIATED,H),e.dispatcher.removeListener(n.EVENTS.PLAY_BUFFERING,W),e.dispatcher.removeListener(n.EVENTS.PLAY_START,q),Oe.unredispatch(e.dispatcher,n.EVENTS.PLAY_START),e.dispatcher.removeListener(n.EVENTS.PLAY_PAUSE,Q),Oe.unredispatch(e.dispatcher,n.EVENTS.PLAY_PAUSE),e.dispatcher.removeListener(n.EVENTS.PLAY_SPEED_CHANGE,J),e.dispatcher.removeListener(n.EVENTS.AUDIO_MIXER_LEVEL,z),e.dispatcher.removeListener(n.EVENTS.PREBUFFERING_PROGRESS,Z),e.dispatcher.removeListener(n.EVENTS.PREBUFFERING_READY,$),Oe.unredispatch(e.dispatcher,n.EVENTS.SEEK_START),e.dispatcher.removeListener(n.EVENTS.SEEK_FINISHED,ee),e.dispatcher.removeListener(n.EVENTS.SEEK_FAILED,ee),e.dispatcher.removeListener(n.EVENTS.SEGMENT_CHANGE,ne),e.dispatcher.removeListener(n.EVENTS.EWC_UPDATE_TIMELINE_LENGTH,re),e.dispatcher.removeListener(n.EVENTS.MULTICAM_SELECT,ge),e.dispatcher.removeListener(n.EVENTS.MULTICAM_ZOOM_IN,pe),e.dispatcher.removeListener(n.EVENTS.MULTICAM_ZOOM_OUT,Ee),e.detachDisplay(),D.raiseEvent(M.KEYS.DECK_UNLOAD,{name:e.name}),e.close()}function j(e){for(var t=0;t<ve.length;t++)if(ve[t].name===e)return ve[t];return null}function Y(t){ve.push(t);var n=e.maximumPlaybackObjects;if(n++,ve.length>n){var r=ve.splice(1,1)[0];K(r)}}function X(e){var t=ve.length;Re=-1;for(var n=0;n<t;n++)if(ve[n]===e)return ve.splice(n,1),void ve.push(e)}function H(e){D.raiseEvent(M.KEYS.DECK_PLAY,{play:!0,state:"initiated"})}function W(e){D.raiseEvent(M.KEYS.DECK_PLAY,{play:!0,state:"buffering"})}function q(e){D.raiseEvent(M.KEYS.DECK_PLAY,{play:!0,state:"playing"}),Ce&&clearInterval(Ce),Ce=setInterval(te,Le)}function Q(e){D.raiseEvent(M.KEYS.DECK_PLAY,{play:!1,state:"stopped"}),Ce&&(clearInterval(Ce),Ce=null),te()}function J(e){D.raiseEvent(M.KEYS.DECK_SPEED,{speed:e.params.speed})}function z(e){D.raiseEvent(M.KEYS.DECK_MIXER_LEVEL,e.params)}function Z(e){D.raiseEvent(M.KEYS.DECK_BUFFER,{progress:e.params.progress,ready:!1})}function $(e){D.raiseEvent(M.KEYS.DECK_BUFFER,{progress:1,ready:!0})}function ee(e){R(m(ye.DONE,0,null)),te()}function te(){Re!=_e.currentFrame&&(Re=_e.currentFrame,D.raiseEvent(M.KEYS.DECK_HEAD,{frame:Re,image:_e.currentFrameBitmap()}))}function ne(e){e.params.playback==_e&&(_currentSegment=e.params.segment,_currentSegment?(_alternateSegment=Boolean(_currentSegment.index%2),he=new O(_currentSegment,_e.timeline),D.raiseEvent(M.KEYS.MULTICAM,Pe.getMulticams()),he.isGroupClip&&(D.raiseEvent(M.KEYS.MULTICAM_ANGLE,{mobID:he.getVideoSegment().selectedAngle}),D.raiseEvent(M.KEYS.MULTICAM_AUDIO,he.getAudioSelections()),D.raiseEvent(M.KEYS.MULTICAM_LAYOUT,{layout:he.layout}),D.raiseEvent(M.KEYS.MULTICAM_BANK,{bank:he.bank}))):(he=null,D.raiseEvent(M.KEYS.KEY_MULTICAM,{angles:[]})))}function re(e){function t(e){if(u){var t=j(r);t.seekQuality(0)}}var n=e.params.srcLength,r=e.params.name,a=e.params.timeline,i=a.duration;if(!(n<0&&0==i)){if(null==a)return void E.error("Can not find timeline ",a.name);for(var o=n<0?0:n,s=a.getFirstTrackWithSegments().getSegment(0).srcIn,u=0==i||n<0,l=[],c=0,d=a.getTrackCount();c<d;c++){var f=a.getTrack(c);l.push(new y("MODIFY","/timeline/track["+c+"]/segment["+(f.getSegmentCount()-1)+"]/position/trackOut",o)),l.push(new y("MODIFY","/timeline/track["+c+"]/segment["+(f.getSegmentCount()-1)+"]/position/out",s+o))}l.push(new y("MODIFY","/timeline/duration",String(o))),ue(r,a,l,!0,t),a.updateTimecodeTrackDuration(),r==_e.name&&F()}}function ae(){return _e.currentFrame}function ie(){return}function oe(e){if(_e.timeline)for(var t=_e.timeline.getTrackCount(),n=-1,r=0;r<t;r++)if(_e.timeline.getTrack(r).isAudioTrack()&&n++,n==e)return r;return-1}function se(e,t,n,r,a,i,o){i=p.defaultValue(i,!1),o=p.defaultValue(o,null);var s=[];return s.push(new y(n,r,a)),ue(e,t,s,i,o)}function ue(e,t,n,r,a){function o(e,t,n){switch(t){case"/timeline/stampTimecode":var r=j(e);r&&(r.loadData.assetInfo.startTimecode=n)}}return r=p.defaultValue(r,!1),a=p.defaultValue(a,null),null!=t&&(0!==n.length&&(i.socket().sendMsg(g.createMultipleModifyTimelineMessage(e,n),function(i){i.isOK()?(r||n.forEach(function(n){t.changeProperty(n.key,n.value),o(e,n.key,n.value)}),D.raiseEvent(M.KEYS.DECK_MODIFY,{name:e,actions:n})):D.raiseEvent(M.KEYS.DECK_MODIFY,{},i.getStatusEvent());var s=j(e);s&&s.timelineModified(),null!=a&&a(i)})?(r&&n.forEach(function(n){t.changeProperty(n.key,n.value),o(e,n.key,n.value)}),!0):(a(null),!1)))}function le(e){return e.isOK()?(me(),D.raiseEvent(M.KEYS.MULTICAM_ANGLE,{mobID:he.getVideoSegment().selectedAngle}),void("1x1"!=he.layout&&_e.drawMulticamOverlay())):void Te.error(e.getStatusMessageDetails())}function ce(e){return e.isOK()?(me(!1),void D.raiseEvent(M.KEYS.MULTICAM_AUDIO,he.getAudioSelections())):void Te.error(e.getStatusMessageDetails())}function de(e){return e.isOK()?(me(),D.raiseEvent(M.KEYS.MULTICAM_LAYOUT,{layout:he.layout}),void D.raiseEvent(M.KEYS.MULTICAM_BANK,{bank:he.bank})):void Te.error(e.getStatusMessageDetails())}function fe(e){return e.isOK()?(me(),void D.raiseEvent(M.KEYS.MULTICAM_BANK,{bank:he.bank})):void Te.error(e.getStatusMessageDetails())}function me(e){e=p.defaultValue(e,!0),_e.isPlaying()||(_e.flush(),e&&Pe.seek(_e.currentFrame,!0,!1,!1))}function ge(e){Pe.setMulticamAngle(e.params)}function pe(e){Pe.setMulticamAngle(e.params),Pe.setMulticamLayout({layout:"1x1"})}function Ee(e){Pe.setMulticamLayout({layout:De})}var _e,Se,he,Te=E.getLogLine("Deck"),ve=[],Ae=s(),Ie={AUTO:"AUTO",FILE:"FILE",MOB_ID:"MOB_ID",TIMELINE:"TIMELINE",EDL:"EDL",EDL_URL:"EDL_URL",MORPHEUS_URL:"MORPHEUS_URL"},ye=m().STATES,be=!1,Oe=v(),ke={PROGRESS:"PROGRESS"},Ce=null,Le=20,De="3x3",Me=k(i),Re=-1;_e=a(null),_e.setLoaddata(o("")),_e.seekQuality(0),Y(_e);var Pe={dispatcher:Oe,EVENTS:ke,load:function(e){var t=l(e);Ae.addPending(t),_(t)},switchPlayback:function(e){var t=l(e),n=d();n.name=t.name,t.timeline=n;var r=j(e.name);if(null!=r)if(r.isConnected()){var a=r.loadData;a.seek=t.seek,C(a)}else A(r.loadData);else b(e.name,null,null,h(h().STATUS.SWITCH_TO_INVALID_PLAYBACK,"Switch to invalid playback","Trying to switch to playback object that hasn't been loaded: "+e.name))},onReconnect:function(){""!=_e.name&&(Pe.setMulticamRenderLayout(De),_(_e.loadData))},getUrlType:I,get playback(){return _e},setContainer:function(e){Se=e},resize:x,get currentFrame(){return playback.currentFrame},seek:function(e,t,n,r){n=p.defaultValue(n,!1),r=p.defaultValue(r,!1),_e.seek(e,t,n,r)},seekQuality:function(e,t,n,r){_e.seekQuality(e,t,n,r)},pause:function(){_e.pause()},play:function(t,n){if(!_e.isPlaying()){var r=t;r===-1&&(r=_e.currentFrame),""!=_e.name&&_e.timeline&&r>=_e.timeline.getTimelineTrackOut()-1?_e.playSpeed<0?_e.play(t,n):e.loopPlayback&&(_e.seekQuality(0,!1,!0,!0),_e.play(t,n)):_e.play(t,n)}},setPlaybackSpeed:function(e){_e.playSpeed=e},getPlaybackSpeed:function(){return _e.playSpeed},togglePlay:function(){_e.isPlaying()?this.pause():this.play()},showProgress:R,closePlaybacks:function(e){for(var t,n;ve.length;)t=ve.splice(0,1)[0],""==t.name?n=t:t.close();ve.push(n),e||(_e=n)},getCurrentFrame:ae,setAudioVolume:function(e,t){var n=oe(e);return n<0?(_e.setAudioVolume(e,t),void D.raiseEvent(M.KEYS.DECK_AUDIO_VOLUME,{track:e,vol:t})):void se(_e.name,_e.timeline,"MODIFY","/timeline/track["+n+"]/audioVolume",t,!1,function(n){return n.isOK()?(_e.setAudioVolume(e,t),void D.raiseEvent(M.KEYS.DECK_AUDIO_VOLUME,{track:e,vol:t})):void Te.error(n.getStatusMessageDetails())})},getAudioVolume:function(e){return _e.getAudioVolume(e)},setAudioPan:function(e,t){var n=oe(e);return n<0?(_e.setAudioPan(e,t),void D.raiseEvent(M.KEYS.DECK_AUDIO_PAN,{track:e,pan:t})):void se(_e.name,_e.timeline,"MODIFY","/timeline/track["+n+"]/audioPan",String(t),!1,function(n){return n.isOK()?(_e.setAudioPan(e,t),void D.raiseEvent(M.KEYS.DECK_AUDIO_PAN,{track:e,pan:t})):void Te.error(n.getStatusMessageDetails())})},getAudioPan:function(e){return _e.getAudioPan(e)},setAudioMute:function(e,t){var n=oe(e);return n<0?(_e.setAudioMute(e,t),void D.raiseEvent(M.KEYS.DECK_AUDIO_MUTE,{track:e,mute:t})):void se(_e.name,_e.timeline,"MODIFY","/timeline/track["+n+"]/view/muted",t?"TRUE":"FALSE",!1,function(n){return n.isOK()?(_e.setAudioMute(e,t),void D.raiseEvent(M.KEYS.DECK_AUDIO_MUTE,{track:e,mute:t})):void Te.error(n.getStatusMessageDetails())})},getAudioMute:function(e){return _e.getAudioMute(e)},setAudioSolo:function(e,t){var n=oe(e);return n<0?(_e.setAudioSolo(e,t),void D.raiseEvent(M.KEYS.DECK_AUDIO_SOLO,{track:e,solo:t})):void se(_e.name,_e.timeline,"MODIFY","/timeline/track["+n+"]/audioSolo",t?"TRUE":"FALSE",!1,function(n){return n.isOK()?(_e.setAudioSolo(e,t),void D.raiseEvent(M.KEYS.DECK_AUDIO_SOLO,{track:e,solo:t})):void Te.error(n.getStatusMessageDetails())})},getAudioSolo:function(e){return _e.getAudioSolo(e)}};return Pe.multipleModifyTimelineByName=function(e,t){var n=j(e);return!(!n||!n.timeline)&&ue(e,n.timeline,t)},Pe.enableMic=function(e){return Me.enable(e)},Pe.isMicEnabled=function(){return Me.isMicEnabled()},Pe.startRecording=function(e,t,n,r,a){i.socket().sendMsg(g.createRecordStartMessage(e,t,n,r,_e.timeline.timelineRaster.fps,_e.timeline.isDropTimecode()),function(e){e.isOK()?(Pe.play(),Me.startRecording(e.message.record_start_re.path,_e.currentFrame,a),D.raiseEvent(M.KEYS.RECORDER_START,null)):D.raiseEvent(M.KEYS.RECORDER_START,null,e.getStatusErrorString())})||Te.info("Couldn't start recording")},Pe.stopRecording=function(n,r){Me.stopRecording(),Pe.pause(),i.socket().sendMsg(g.createRecordStopMessage(Me.getRecorderPath(),n,!n,r),function(n){if(n.isOK()){var a=n.message.record_stop_re.clip_item;if(null==a)return void D.raiseEvent(M.KEYS.RECORDER_STOP,{path:"",duration:0,metadata:null,mxf_info:""});var i,o=Number(a.media_info.properties.audio_length)/Number(a.media_info.properties.rate),s=Math.round(_e.timeline.getFrame(o)),l=n.message.record_stop_re.path,c=n.message.record_stop_re.final_path;t.isEmpty(r)||(i=n.message.record_stop_re.mxf_info);var d=u().createAssetFromXml(a).getInfo();e.addRecordVoiceTrack&&Me.addRecordFileToTimeline(_e.timeline,l,function(e,t){return e?Te.error(e):(_e.loadData.type=Ie.TIMELINE,_e.loadData.url=t.timeline,void _(_e.loadData))});var f={path:c,duration:s,metadata:d.getMetadataObject(),mxf_info:i};D.raiseEvent(M.KEYS.RECORDER_STOP,f)}else Te.error("Couldn't stop recording properly: "+n.getStatusErrorString()),D.raiseEvent(M.KEYS.RECORDER_STOP,{path:"",duration:0,metadata:null,mxf_info:""},n.getStatusErrorString())})||Te.error("Couldn't stop recording.")},Pe.confirmRecording=function(e,t){i.socket().sendMsg(g.createRecordConfimMessage(Me.getRecorderPath(),e,t),function(e){D.raiseEvent(M.KEYS.RECORDER_CONFIRM,{},e.getStatusErrorString())})||Te.error("Couldn't confirm recording.")},Pe.showAudioInSourceSelectionBox=function(e){e?(_deck.micPanel.visible=!0,_deck.micPanel.select=Me.micIndex,_deck.micPanel.addEventListener(S.CHANGE,function(e){Me.setAudioIn(_deck.micPanel.selectedLabel)?D.raiseEvent(M.KEYS.RECORDER_SOURCE,{name:_deck.micPanel.selectedLabel}):Te.info("DeckMain.showAudioInSourceSelect: Couldn't set microphone index")})):_deck.micPanel.visible=!1},Pe.getMicGain=function(){return Me.getGain()},Pe.setMicGain=function(e){Me.setGain(e)},Pe.getMulticams=function(e){var t=he.angles,n=[];if(null==t)return{angles:null};for(var r=0,a=t.length;r<a;r++)n.push({name:t[r].name,mobID:t[r].mobID,offset:t[r].offset,duration:t[r].duration,timecode:t[r].timecode,video:t[r].video,audio:t[r].getAudioTracks()});return{angles:n}},Pe.setMulticamAngle=function(e){if(he){if(!e.hasOwnProperty("mobID")||!t.isMobId(e.mobID))return void Te.error("Invalid angle selection.");if(e.mobID==_currentSegment.selectedAngle)return;se(_e.name,_e.timeline,"MODIFY","/timeline"+_currentSegment.getXPath()+"/groupClipMob/selected",e.mobID,!1,le)||Te.error("Couldn't select multicam angle.")}else Te.error("Trying to set video selection for a segment that isn't a group clip: "+e)},Pe.getMulticamAngle=function(e){return he?{mobID:he.getVideoSegment().selectedAngle}:null},Pe.getMulticamAudio=function(e){return he.getAudioSelections()},Pe.setMulticamAudio=function(e){if(he){var n=[];for(var r in e)t.isNumeric(r)&&t.isMobId(e[r])?n.push(new y("MODIFY","/timeline"+he.getAudioSegment(parseInt(r)).getXPath()+"/groupClipMob/selected",e[r])):Te.error("Invalid audio track or mob id for audio selections on group clip: "+r+": "+e[r]);ue(_e.name,_e.timeline,n,!1,ce)||Te.error("Failed to set selections for audio in group clip: "+e)}else Te.error("Trying to set audio selection for a segment that isn't a group clip: "+e)},Pe.setMulticamLayout=function(e){he?("1x1"!=e.layout&&e.layout!=De&&Pe.setMulticamRenderLayout(e.layout),se(_e.name,_e.timeline,"MODIFY","/timeline"+_currentSegment.getXPath()+"/groupClipMob/layout",e.layout,!1,de)||Te.error("Couldn't select multicam angle.")):Te.error("Trying to set multicam layout for a segment that isn't a group clip: "+e.layout)},Pe.getMulticamLayout=function(e){return he?{layout:he.layout}:null},Pe.setMulticamBank=function(e){he?(_currentSegment.data.groupClipMob.hasOwnProperty("bank")||(_currentSegment.data.groupClipMob.bank=0),se(_e.name,_e.timeline,"MODIFY","/timeline"+_currentSegment.getXPath()+"/groupClipMob/bank",e.bank,!1,fe)||Te.error("Couldn't select multicam bank.")):Te.error("Trying to set multicam bank for a segment that isn't a group clip: "+e.bank)},Pe.getMulticamBank=function(e){return{bank:he.bank}},Pe.setMulticamRenderLayout=function(e){De=e,i.socket().sendMsg(g.createSetUserOptionMessage(De),function(e){e.isOK()||Te.error("Couldn't set default multicam layout:  "+e.getStatusErrorString())})},Pe.setMulticamClick=function(e){var t;t=e.name?j(e.name):_e,t?t.enableMulticamClicks(e.enabled):Te.error("Couldn't find playback object: "+e.name)},Pe.getMulticamClick=function(e){var t;return t=e.name?j(e.name):_e,t?{enabled:t.areMulticamClicksEnabled()}:(Te.error("Couldn't find playback object: "+e.name),{})},Pe.renderToCache=function(e){i.socket().sendMsg(g.createRenderToCacheMessage(_e.name,e.in,e.out,e.threshold,_e.playbackFramesOptions))||Te.error("Couldn't start render to cache: "+JSON.stringify(e))},Pe.getImage=function(e){var n=j(e.name);if(null==n)return D.raiseEvent(M.KEYS.DECK_IMAGE,{name:e.name,frame:e.frame,key:null,data:null},h(h().STATUS.BAD_REQUEST,"No such playback","Trying to get an image from a playback object that isn't loaded: "+e.name)),Te.error("Couldn't load playback object:  "+e.name);var r=n.playbackFramesOptions.copy();r.frame=e.frame,r.width=e.width,t.isEmpty(e.height)?r.height=e.width/n.videoWidth*n.videoHeight:r.height=e.height,r.compressionQuality=e.compression,r.rasterWidth=n.videoWidth,r.rasterHeight=n.videoHeight,i.socket().sendMsg(g.createTimelineImageMessage(e.name,r,!1),function(t){if(!t.isOK())return D.raiseEvent(M.KEYS.DECK_IMAGE,{name:e.name,frame:int(t.message.get_timeline_image_re.frame),key:r,data:null},h(h().STATUS.MPS_STATUS_ERROR_FROM_SERVER,t.getStatusErrorString(),t.getStatusMessageDetails())),Te.error("Couldn't get image from timeline:  "+e.name,t.getStatusErrorString(),t.getStatusMessageDetails());var r;r=he&&he.isGroupClip?he.getVideoSegment().selectedAngle:n.loadData.url;var a;switch(e.type){case"ByteArray":a=t.data;break;default:a="data:image/jpeg;base64,\n"+t.data.toBase64()}D.raiseEvent(M.KEYS.DECK_IMAGE,{name:e.name,frame:parseInt(t.message.get_timeline_image_re.frame,10),key:r,data:a})})},Pe.getAudio=function(e){var t=j(e.name);return null==t?(D.raiseEvent(M.KEYS.DECK_AUDIO,e,h(h().STATUS.BAD_REQUEST,"No such playback","Trying to get an image from a playback object that isn't loaded: "+e.name)),Te.error("Couldn't load playback object:  "+e.name)):void i.socket().sendMsg(g.createTimelineAudioMessage(t.name,4294967295,e.in_frame,e.length,e.bit_per_sample,e.frame_per_second,!1,!1),function(t){return null==t||t.isError()?void _ll.error(t.getStatusMessageDetails()):t.data?(e.data=t.data.slice().buffer,void D.raiseEvent(M.KEYS.DECK_AUDIO,e)):void _ll.error("No data for audio")})},Pe}}),n("util/Extensions",["util/JavascriptUtil"],function(e){"undefined"==typeof Uint8Array.prototype.slice&&(Uint8Array.prototype.slice=function(t,n){var r=e.defaultValue(t,0),a=e.defaultValue(n,this.length-r),i=new Uint8Array(a);return i.set(this.subarray(r,r+a)),i}),Uint8Array.prototype.toString=function(){var e,t="";for(e=0;e<this.length;e++)t+=this[e]<=127?37===this[e]?"%25":String.fromCharCode(this[e]):"%"+this[e].toString(16).toUpperCase();return decodeURIComponent(t)},Uint8Array.prototype.toHexString=function(){var e,t="";for(e=0;e<this.length;e++)t+=this[e].toString(16);return t},Uint8Array.prototype.toInt=function(){var e,t=0;for(e=0;e<this.length;e++)t+=this[e],e<this.length-1&&(t<<=8);return t},Uint8Array.prototype.concat=function(e){var t=new Uint8Array(this.length+e.length);return t.set(this),t.set(e,this.length),t},Uint8Array.prototype.toBase64=function(){return btoa(String.fromCharCode.apply(null,this))},Uint8Array.prototype.toBlob=function(e){return new Blob([this.buffer],{type:e})},"undefined"==typeof Uint8Array.prototype.fill&&(Uint8Array.prototype.fill=function(e){for(var t=0,n=this.length;t<n;t++)this[t]=e}),String.prototype.toUint8Array=function(){var e,t,n,r=new Uint8Array(this.length);for(t=0;t<this.length;t++)if(this.charCodeAt(t)<=127)r[t]=this.charCodeAt(t);else for(e=encodeURIComponent(this.charAt(t)).substr(1).split("%"),n=0;n<e.length;n++)r[t]=parseInt(e[n],16);return r},Number.prototype.toUint8Array=function(){var e=new Uint8Array(4);return e[0]=this>>24&255,e[1]=this>>16&255,e[2]=this>>8&255,e[3]=this>>0&255,e},DataView.prototype.setUInt8array=function(t,n){var r=e.defaultValue(n,0),a=new Uint8Array(this.buffer);a.set(t,r)}}),n("main",["appbase/App","appbase/ConfigManager","event/Event","view/View","log/Log","util/StringUtil","net/CommConf","net/SOCKET_EVENTS","appbase/Version","control/Deck","event/EventParamProgress","event/EventStatus","util/JavascriptUtil","asset/AssetBuilder","util/NumberUtil","lang/Locale","net/Message","event/ExternalDispatcher","event/ExternalInterface","net/ModifyTimelineItem","util/Extensions"],function(e,t,n,r,a,i,o,s,u,l,c,d,f,m,g,p,E,_,S,h){return function(f,T,v,A,I,y){function b(e){return M.dispatcher.removeListener(s.LOGIN,b),e.status.hasError()?(R.error(p.value("maxplayercode.loginFailed")),N.showProgress(c(P.DONE,0,p.value("maxplayercode.loginFailed"))),void _.raiseEvent(S.KEYS.USER_LOGIN,{user_session:0},e.status)):(e.status.hasWarning()&&R.warn(e.status.message,e.status.getDetails()),o.setSession(e.params.message.login_user_re.session_id),R.info("Socket connected."),N.showProgress(c(P.DONE,0,null)),_.raiseEvent(S.KEYS.USER_LOGIN,{user_session:o.userSession}),void O())}function O(){null==U&&(U=window.setInterval(function(){e.comm().ping(C),k()},12e4),e.comm().ping(C),k())}function k(){t.socketKeepAlive&&(e.socket().sendMsg(E.createPingMsg(p.langCode),function(e){return e.isError()?R.error("Socket keep alive error: "+e.getStatusErrorString()):void R.info("Socket keep alive successful")})||R.error("Couldn't send socket keep alive"))}function C(e,t){return e?R.error("HTTP keep alive failed: "+e):void R.info("HTTP keep alive successful")}var L,D,M,R=a.getLogLine("Main"),P=c().STATES,N=l(e),F={head:0,peak_left:0,peak_right:0,peak_in:0,playing:!1,buffer_progress:0,buffer_ready:!1},U=null;S.addGetter(S.KEYS.USER_LOGIN,function(t){return{authenticated:e.socket().authenticated,host:e.socket().host,node:e.socket().node,scheme:o.schemeName,login:o.userName,session:o.userSession}}),S.addSetter(S.KEYS.USER_LOGIN,function(t){R.info("logging in "+t.user_name),N.closePlaybacks(t.host_name==o.hostName),N.showProgress(c(P.INDETERMINATE,0,p.value("maxplayercode.loggingIn"))),o.setLoginConf(t.scheme_name,t.host_name,t.user_name,t.user_password,t.user_session),e.comm(o),M=e.socket(o),M.dispatcher.addListener(s.LOGIN,b),M.dispatcher.hasListener(s.LOGIN,N.onReconnect)||M.dispatcher.addListener(s.LOGIN,N.onReconnect),M.connect()}),S.addSetter(S.KEYS.DECK_PLAY,function(e){e.play?N.play(e.frameIn,e.frameOut,-1):N.pause()}),S.addGetter(S.KEYS.DECK_PLAY,function(e){return{play:N.playback.isPlaying()}}),S.addSetter(S.KEYS.DECK_SPEED,function(e){return g.isNumeric(e.speed)?void N.setPlaybackSpeed(e.speed):R.error("Invalid speed provided for deck.speed")}),S.addGetter(S.KEYS.DECK_SPEED,function(e){return{speed:N.getPlaybackSpeed()}}),S.addGetter(S.KEYS.APP_VERSION,function(e){return{client:u.getVersionString(),server:o.serverVersionNumber}}),S.addSetter(S.KEYS.DECK_LOAD,function(e){N.load(e)}),S.addSetter(S.KEYS.DECK_SWITCH,function(e){N.switchPlayback(e)}),S.addGetter(S.KEYS.DECK_AUDIO_TOTAL_TRACKS,function(e){return{tracks:N.playback.timeline.getAudioTrackTotal()}}),S.addSetter(S.KEYS.DECK_AUDIO_VOLUME,function(e){return g.isNumeric(e.track)?g.isNumeric(e.volume)?void N.setAudioVolume(e.track,e.volume):void R.error("Invalid volume provided for deck.audio.volume"):void R.error("Invalid track number provided for deck.audio.volume")}),S.addGetter(S.KEYS.DECK_AUDIO_VOLUME,function(e){return g.isNumeric(e.track)?{volume:N.getAudioVolume(e.track)}:(R.error("Invalid track number provided for deck.audio.volume"),null)}),S.addGetter(S.KEYS.DECK_AUDIO_MUTE,function(e){return g.isNumeric(e.track)?{mute:N.getAudioMute(e.track)}:(R.error("Invalid track number provided for deck.audio.mute"),null)}),S.addSetter(S.KEYS.DECK_AUDIO_MUTE,function(e){return g.isNumeric(e.track)?void N.setAudioMute(e.track,e.mute):void R.error("Invalid track number provided for deck.audio.mute")}),S.addGetter(S.KEYS.DECK_AUDIO_SOLO,function(e){return g.isNumeric(e.track)?{solo:N.getAudioSolo(e.track)}:(R.error("Invalid track number provided for deck.audio.solo"),null)}),S.addSetter(S.KEYS.DECK_AUDIO_SOLO,function(e){return g.isNumeric(e.track)?void N.setAudioSolo(e.track,e.solo):void R.error("Invalid track number provided for deck.audio.solo")}),S.addGetter(S.KEYS.DECK_AUDIO_PAN,function(e){return g.isNumeric(e.track)?{pan:N.getAudioPan(e.track)}:(R.error("Invalid track number provided for deck.audio.pan"),null)}),S.addSetter(S.KEYS.DECK_AUDIO_PAN,function(e){return g.isNumeric(e.track)?g.isNumeric(e.pan)?void N.setAudioPan(e.track,e.pan):void R.error("Invalid pan provided for deck.audio.pan"):void R.error("Invalid track number provided for deck.audio.pan")}),S.addGetter(S.KEYS.DECK_STATE,function(e){return F}),_.addEventListener(S.KEYS.DECK_HEAD,function(e){F.head=e.params.frame}),_.addEventListener(S.KEYS.DECK_MIXER_LEVEL,function(e){F.peak_left=e.params.peak_left,F.peak_right=e.params.peak_right}),_.addEventListener(S.KEYS.RECORDER_LEVEL,function(e){F.peak_in=e.params.peak}),_.addEventListener(S.KEYS.DECK_PLAY,function(e){F.playing=e.params.play,F.playState=e.params.playState}),_.addEventListener(S.KEYS.DECK_BUFFER,function(e){F.buffer_progress=e.params.progress,F.buffer_ready=e.params.ready}),S.addGetter(S.KEYS.MULTICAM,N.getMulticams),S.addSetter(S.KEYS.MULTICAM_ANGLE,N.setMulticamAngle),S.addGetter(S.KEYS.MULTICAM_ANGLE,N.getMulticamAngle),S.addSetter(S.KEYS.MULTICAM_BANK,N.setMulticamBank),S.addGetter(S.KEYS.MULTICAM_BANK,N.getMulticamBank),S.addSetter(S.KEYS.MULTICAM_LAYOUT,N.setMulticamLayout),S.addGetter(S.KEYS.MULTICAM_LAYOUT,N.getMulticamLayout),S.addSetter(S.KEYS.MULTICAM_AUDIO,N.setMulticamAudio),S.addGetter(S.KEYS.MULTICAM_AUDIO,N.getMulticamAudio),S.addSetter(S.KEYS.MULITICAM_LAYOUT_RENDER,N.setMulticamRenderLayout),S.addGetter(S.KEYS.MULTICAM_CLICK_ENABLED,N.getMulticamClick),S.addSetter(S.KEYS.MULTICAM_CLICK_ENABLED,N.setMulticamClick),S.addSetter(S.KEYS.DECK_RENDER,N.renderToCache),S.addGetter(S.KEYS.DECK_IMAGE,N.getImage),S.addGetter(S.KEYS.DECK_AUDIO,N.getAudio),S.addGetter(S.KEYS.DECK_CONFIG,function(e){return{value:t.getConfig(e.key)}}),S.addSetter(S.KEYS.DECK_CONFIG,function(e){return{success:t.setConfig(e.key,e.value)}}),S.addSetter(S.KEYS.DECK_HEAD,function(e){return g.isNumeric(e.frame)?void N.playback.seekQuality(e.frame,e.audible,e.highQuality,e.preparePlayback):R.error("Invalid frame number provided for seek")}),S.addGetter(S.KEYS.DECK_HEAD,function(e){return{frame:N.getCurrentFrame()}}),S.addGetter(S.KEYS.DECK_IMAGE_CURRENT,function(e){return{image:"data:image/jpeg;base64,"+N.playback.currentFrameBitmap().toBase64()}}),S.addSetter(S.KEYS.RECORDER_ENABLE,function(e){return{success:N.enableMic(e.enable)}}),S.addGetter(S.KEYS.RECORDER_ENABLE,function(e){return{enabled:N.isMicEnabled()}}),S.addSetter(S.KEYS.RECORDER_START,function(e){N.startRecording(e.workspace,e.user_name,e.sequence_name,e.interplay_server,i.parseInteger(e.audio_bit_depth,16))}),S.addSetter(S.KEYS.RECORDER_STOP,function(e){N.stopRecording(e.cancel,e.interplay_server)}),S.addSetter(S.KEYS.RECORDER_CONFIRM,function(e){N.confirmRecording(e.cancel,e.interplay_server)}),S.addGetter(S.KEYS.RECORDER_GAIN,function(e){return{gain:N.getMicGain()}}),S.addSetter(S.KEYS.RECORDER_GAIN,function(e){N.setMicGain(e.gain)}),S.addGetter(S.KEYS.RECORDER_SOURCES,function(e){return{names:[]}}),S.addSetter(S.KEYS.RECORDER_SOURCE,function(e){return!0}),S.addGetter(S.KEYS.RECORDER_SOURCE,function(e){return{name:"(Not applicable to html5 player)"}}),S.addSetter(S.KEYS.DECK_UI_AUDIO_SOURCE_SELECTION,function(e){}),S.addSetter(S.KEYS.DECK_UI_STATISTICS,function(e){L.showPlaybackStatistics(e.show)}),S.addGetter(S.KEYS.DECK_UI_STATISTICS,function(e){return{show:L.isPlaybackStatisticsShowing()}}),S.addSetter(S.KEYS.APP_SETTINGS_DIALOG,function(e){L.showDebugPanel(e.show)}),S.addGetter(S.KEYS.APP_SETTINGS_DIALOG,function(e){return{show:L.isDebugPanelShowing()}}),S.addGetter(S.KEYS.ASSET_METADATA,function(t){return i.isEmpty(t.url)?R.error("Empty url provided for get metadata"):e.socket().isConnected()?void(e.socket().sendMsg(E.createGetClipInfoMessage(t.url,t.type),function(e){return e.isOK()?void _.raiseEvent(S.KEYS.ASSET_METADATA,{url:t.url,metadata:m().createAssetFromXml(e.message.get_clip_info_re.clip_item).getInfo().getMetadataObject()
}):void _.raiseEvent(S.KEYS.ASSET_METADATA,{url:t.url,metadata:null},new d(e.isError()?d().STATUS.ERROR_FROM_SERVER:d().STATUS.WARNING_FROM_SERVER,e.getStatusErrorString(),e.getStatusMessageDetails()))})||_.dispatchEciCommError(S.KEYS.ASSET_METADATA)):R.error("Can't call get asset metadata - player not connected")}),S.addGetter(S.KEYS.DECK_TIMELINE,function(e){return{timeline:N.playback.timeline.timeline}}),S.addSetter(S.KEYS.DECK_MODIFY,function(e){for(var t=[],n=0,r=e.actions.length;n<r;n++)t.push(new h(e.actions[n].action,e.actions[n].xpath,e.actions[n].value));N.multipleModifyTimelineByName(e.name,t)}),S.addSetter(S.KEYS.EXEC_XCORE_COMMAND,function(t){return e.socket().sendMsg(E.createExecXcoreCommandMessage(t.command),function(e){e.isOK()?_.raiseEvent(S.KEYS.EXEC_XCORE_COMMAND,{command:t.command,result:e.message.exec_xcore_command_re.result}):_.raiseEvent(S.KEYS.EXEC_XCORE_COMMAND,{},e.getStatusEvent())})||_.raiseEvent(S.KEYS.EXEC_XCORE_COMMAND,{},d(d().STATUS.COMMUNICATION_ERROR,"Communication error","Can't send xcore command")),null}),p.load(I,function(){t.load(A,function(){o.hostXmdPort=t.xmdPort,o.autoReconnection=t.xmdAutoReconnection,o.useCluster=t.xmdUseCluster,D=document.createElement("div"),D.id=T,D.call=S.callFunc,D.addEventListener=_.addEventListener,D.removeEventListener=_.removeEventListener,document.getElementById(f).appendChild(D),L=r(e,D,N,y),window[v](n(S.KEYS.APP_LOADED,{DOMID:T}))})})}}),t("main")});